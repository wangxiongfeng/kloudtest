var TXTools=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function n(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function o(){for(var t="",e=1;e<=32;e++){t+=Math.floor(16*Math.random()).toString(16),8!=e&&12!=e&&16!=e&&20!=e||(t+="-")}return t}function r(t){return document.getElementById(t)}function s(t){if(null==t)return null;var e=t.match(/^\s*(\S+(\s+\S+)*)\s*$/);return null==e?"":e[1]}function a(t,e){var i=t.length;if(0==i)return-1;for(var n=0;n<i;n++)if(t[n]==e)return n;return-1}Object.defineProperty(e,"__esModule",{value:!0});setTimeout;var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function h(t){var e,i,n,o,r,s;for(n=t.length,i=0,e="";i<n;){if(o=255&t.charCodeAt(i++),i==n){e+=l.charAt(o>>2),e+=l.charAt((3&o)<<4),e+="==";break}if(r=t.charCodeAt(i++),i==n){e+=l.charAt(o>>2),e+=l.charAt((3&o)<<4|(240&r)>>4),e+=l.charAt((15&r)<<2),e+="=";break}s=t.charCodeAt(i++),e+=l.charAt(o>>2),e+=l.charAt((3&o)<<4|(240&r)>>4),e+=l.charAt((15&r)<<2|(192&s)>>6),e+=l.charAt(63&s)}return e}function c(t){if(null==t||void 0===t||""==t)return"";var e,i,n,o,r,s,a;for(s=t.length,r=0,a="";r<s;){do{e=d[255&t.charCodeAt(r++)]}while(r<s&&-1==e);if(-1==e)break;do{i=d[255&t.charCodeAt(r++)]}while(r<s&&-1==i);if(-1==i)break;a+=String.fromCharCode(e<<2|(48&i)>>4);do{if(61==(n=255&t.charCodeAt(r++)))return a;n=d[n]}while(r<s&&-1==n);if(-1==n)break;a+=String.fromCharCode((15&i)<<4|(60&n)>>2);do{if(61==(o=255&t.charCodeAt(r++)))return a;o=d[o]}while(r<s&&-1==o);if(-1==o)break;a+=String.fromCharCode((3&n)<<6|o)}return a}function p(t){var e,i,n,o;for(e="",n=t.length,i=0;i<n;i++)(o=t.charCodeAt(i))>=1&&o<=127?e+=t.charAt(i):o>2047?(e+=String.fromCharCode(224|o>>12&15),e+=String.fromCharCode(128|o>>6&63),e+=String.fromCharCode(128|o>>0&63)):(e+=String.fromCharCode(192|o>>6&31),e+=String.fromCharCode(128|o>>0&63));return e}function u(t){var e,i,n,o,r,s;for(e="",n=t.length,i=0;i<n;)switch((o=t.charCodeAt(i++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=t.charAt(i-1);break;case 12:case 13:r=t.charCodeAt(i++),e+=String.fromCharCode((31&o)<<6|63&r);break;case 14:r=t.charCodeAt(i++),s=t.charCodeAt(i++),e+=String.fromCharCode((15&o)<<12|(63&r)<<6|(63&s)<<0)}return e}function g(){this.container={},this.set=function(t,e){try{return null!=t&&""!=t&&(this.container[t]=e),!0}catch(t){return!1}},this.get=function(t){try{return this.container[t]}catch(t){return null}},this.containsKey=function(t){try{for(var e in this.container)if(e==t)return!0;return!1}catch(t){return!1}},this.containsValue=function(t){try{for(var e in this.container)if(this.container[e]===t)return!0;return!1}catch(t){return!1}},this.remove=function(t){try{return delete this.container[t],!0}catch(t){return!1}},this.clear=function(){try{return delete this.container,this.container={},!0}catch(t){return!1}},this.isEmpty=function(){return 0==this.keySet().length},this.size=function(){return this.keySet().length},this.keySet=function(){var t=new Array;for(var e in this.container)t.push(e);return t},this.values=function(){for(var t=new Array,e=this.keySet(),i=0;i<e.length;i++)t.push(this.container[e[i]]);return t},this.entrySet=function(){for(var t=new Array,e=this.keySet(),i=0;i<e.length;i++)t.push(e[i],this.container[e[i]]);return t},this.sumValues=function(){for(var t=this.values(),e=0,i=0;i<t.length;i++)e+=Number(t[i]);return e}}function v(){this.HistoryGroup=new g,this.PointGroup=new g,this.RedoPointGroup=new g,this.RedoHistoryGroup=new g,this.Clear=function(t){this.HistoryGroup.remove(t),this.PointGroup.remove(t),this.RedoPointGroup.remove(t)},this.ClearRedo=function(t){this.RedoPointGroup.remove(t)},this.AddHistory=function(t,e){var i=this.HistoryGroup.get(t);if(null==i){var n=new Array;n.push(e),this.HistoryGroup.set(t,n)}else i.push(e),this.HistoryGroup.set(t,i)},this.Undo=function(t){var e=this.HistoryGroup.get(t);if(null==e)return null;var i=e.pop();return this.HistoryGroup.set(t,e),i},this.AddPoints=function(t,e){var i=this.PointGroup.get(t);if(null==i){var n=new Array;n.push(e),this.PointGroup.set(t,n)}else i.push(e),this.PointGroup.set(t,i)},this.UndoPoints=function(t){var e=this.PointGroup.get(t);if(null==e)return null;var i=e.pop();return this.PointGroup.set(t,e),i},this.AddRedoPoints=function(t,e){var i=this.RedoPointGroup.get(t);if(null==i){var n=new Array;n.push(e),this.RedoPointGroup.set(t,n)}else i.push(e),this.RedoPointGroup.set(t,i)},this.RedoPoints=function(t){var e=this.RedoPointGroup.get(t);if(null==e)return null;var i=e.pop();return this.RedoPointGroup.set(t,e),i},this.AddRedoHistory=function(t,e){var i=this.RedoHistoryGroup.get(t);if(null==i){var n=new Array;n.push(e),this.RedoHistoryGroup.set(t,n)}else i.push(e),this.RedoHistoryGroup.set(t,i)},this.RedoHistory=function(t){var e=this.RedoHistoryGroup.get(t);if(null==e)return null;var i=e.pop();return this.RedoHistoryGroup.set(t,e),i}}function f(t,e){this.name=t,this.data=e,this.target=null,this.container=null,this.main=null,this.pagenumber=0,this.canEdit=!0,this.EVENTSTART="mousedown",this.EVENTMOVE="mousemove",this.EVENTEND="mouseup",this.EVENTCLICK="click",this.ImagePath="/static/images/",this.deviceType=0,this.SetParamter=function(t,e,i,n,o){this.target=t,this.container=e,this.main=i,this.pagenumber=n,this.deviceType=o,0!=this.deviceType&&(this.EVENTSTART="touchstart",this.EVENTMOVE="touchmove",this.EVENTEND="touchend",this.EVENTCLICK="click",this.EVENTRESIZE="ontouchstart",-1==location.href.toLowerCase().indexOf("http")&&(this.ImagePath="img/"))},this.SetCanEdit=function(t){this.canEdit=t},this.Play=function(){console.log(this.name+":Play not done")},this.getContainerWidth=function(){var t=this.container.width();return 0==t&&(t=this.main.width()),t},this.getContainerHeight=function(){var t=this.container.height();return 0==t&&(t=this.main.height()),t},this.getViewHeight=function(){return this.main.height()},this.getViewWidth=function(){return this.main.width()},this.GetFixedPageNumber=function(t){return(t+"").replace(".","\\.")},this.FixPoz=function(t,e,i){var n=parseFloat((t*i/e).toFixed(1));return isNaN(n)?t:n},this.FixLinePoz=function(t,e,i,n,o){for(var r=t.split(" "),a=-1,l=0,d=0,h="",c=0,p=r.length;c<p;c++)""!=s(r[c])&&(a=r[c].indexOf(","),l=parseFloat(r[c].substr(1,a)),d=parseFloat(r[c].substring(a+1)),isNaN(l)||isNaN(d)?(console.error("x:"+l+",y:"+d),h+=r[c][0]+r[c].substr(1,a)+","+r[c].substring(a+1)):h+=r[c][0]+this.FixPoz(l,e,n)+","+this.FixPoz(d,e,n),c<p-1&&(h+=" "));return h},this.FixArrayPoz=function(t,e,i,n,o){for(var r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="",a=0,l=t.length;a<l;a++)s+=0==a&&r?"M"+this.FixPoz(t[a][0],e,n)+","+this.FixPoz(t[a][1],e,n):" L"+this.FixPoz(t[a][0],e,n)+","+this.FixPoz(t[a][1],e,n);return s},this.FixLinePozEx=function(t,e,i,n,o){for(var r,s=/\d+\.?\d*/gi,a=0,l=0,d="";null!=(r=s.exec(t));){var h=parseFloat(r[0]),c=0;c=this.FixPoz(h,e,n),d+=0==a?t.substr(0,r.index)+c:t.substring(l,r.index)+c,l=r.index+r[0].length,a++}return a>=1&&(d+=t.substr(l)),d},this.GetNumberRange=function(t,e,i){return Math.min(Math.max(t,e),i)},this.Append=function(t,e){if(this.target=e||this.target,this.target[0].firstChild){var i=this.target.find(">path");0==i.length?this.target[0].insertBefore(t,this.target[0].firstChild):i.last().after($(t))}else this.target[0].appendChild(t)},this.CreateEle=function(t,e){var i=n(t);if(e)for(var o in e)i.setAttribute(o,e[o]);return i},this.ShowArrow=function(t){var e,i,n,o,r=$("#g_"+t.attr("id")),s=r.find(">line"),a=r.find(">rect"),l=parseInt(t.attr("x")),d=parseInt(t.attr("y")),h=parseInt(t.attr("width")),c=parseInt(t.attr("height")),p=parseInt(a.attr("x")),u=parseInt(a.attr("y")),g=parseInt(a.attr("width")),v=parseInt(a.attr("height"));d>u+v?(e=l+h/2,i=d,n=p+g/2,o=u+v):u>d+c?(e=l+h/2,i=d+c,n=p+g/2,o=u):p+g/2>l+h/2?l>p?(e=l,i=d+c/2,n=p,o=u+v/2):(e=l+h,i=d+c/2,n=p,o=u+v/2):l>p+g?(e=l,i=d+c/2,n=p+g,o=u+v/2):(e=l+h,i=d+c/2,n=p+g,o=u+v/2),s.attr("x1",e),s.attr("y1",i),s.attr("x2",n),s.attr("y2",o);var f=r.find(">circle");f.attr("cx",e),f.attr("cy",i)},this.SplitText=function(t,e){new Array;return function(t){for(var e=new Array;t.indexOf("\r\n")>-1||t.indexOf("\n")>-1;)t.indexOf("\r\n")>-1?(e.push(t.substring(0,t.indexOf("\r\n")+1)),t=t.substr(t.indexOf("\r\n")+1)):t.indexOf("\n")>-1&&(e.push(t.substring(0,t.indexOf("\n")+1)),t=t.substr(t.indexOf("\n")+1));return""!=t&&e.push(t),e}(t)},this.SplitTextEx=function(t,e,i,n){var o=new Array;if(!t||""==t)return o;var r=$("#divforwhiteboardgetlines"),s=Math.round(1.2*i);if(0==r.length){var a="<div id='divforwhiteboardgetlines' style=\"width:"+e+"px;font-family:"+n+";word-wrap:break-word;word-break:break-all;padding:0px;margin:0px;line-height:"+s+"px;font-size:"+i+'px;position:absolute;top:-550px;left:-550px;"></div>';$(document.body).append(a),r=$("#divforwhiteboardgetlines")}else r.css({width:e+"px","font-size":i+"px","line-height":s+"px","font-family":n});for(var l=function(t){r.html("");for(var e="",i="",n=new Array;t.length>0;)e+=t[0],r.html(e),r.height()>=2*s?(e="",n.push(i),i=""):(t=t.substr(1),i=e);return""!=e&&n.push(e),n},d=function(t){for(var e=new Array;t.indexOf("\r\n")>-1||t.indexOf("\n")>-1;)t.indexOf("\r\n")>-1?(e.push(t.substring(0,t.indexOf("\r\n")+1)),t=t.substr(t.indexOf("\r\n")+1)):t.indexOf("\n")>-1&&(e.push(t.substring(0,t.indexOf("\n")+1)),t=t.substr(t.indexOf("\n")+1));return""!=t&&e.push(t),e}(t),h=0;h<d.length;h++)for(var c=l(d[h]),p=0;p<c.length;p++)o.push(c[p]);return o},this.isInsideRect=function(t,e,i,n,o){return o.x>=t&&o.y>=e&&o.x+o.width<=t+i&&o.y+o.height<=e+n}}function y(t){f.call(this,"PlayPen",t);var e=t;this.Play=function(){if(r(e.id))e.d.indexOf("C")>-1?r(e.id).setAttribute("d",this.FixLinePozEx(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())):(r(e.id).setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.w&&r(e.id).setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),.5,50)));else{var t=n("path");t.setAttribute("tp","line"),t.setAttribute("isdraw","true"),t.setAttribute("id",e.id),e.w?t.setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),.5,50)):t.setAttribute("stroke-width",1),e.d.indexOf("C")>-1?t.setAttribute("d",this.FixLinePozEx(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())):t.setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.color?t.setAttribute("stroke",e.color):t.setAttribute("stroke","red"),e.op&&t.setAttribute("stroke-opacity",e.op),t.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),e.tar&&""!=e.tar&&"main"!=e.tar&&"body"!=e.tar&&"app"!=e.tar?$("#"+e.tar).find(">svg")[0]&&this.Append(t,$("#"+e.tar).find(">svg")):this.target&&this.Append(t)}}}function x(t){f.call(this,"PlayPen",t);var e=t;this.Play=function(){if(r(e.id))r(e.id).setAttribute("d",r(e.id).getAttributeNode("d").nodeValue+this.FixArrayPoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight(),!1)),e.w&&r(e.id).setAttribute("stroke-width",this.FixPoz(e.w,e.CW,this.getContainerWidth()));else{var t=n("path");t.setAttribute("tp","line"),t.setAttribute("isdraw","true"),t.setAttribute("id",e.id),e.w?t.setAttribute("stroke-width",this.FixPoz(e.w,e.CW,this.getContainerWidth())):t.setAttribute("stroke-width",1),t.setAttribute("d",this.FixArrayPoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.color?t.setAttribute("stroke",e.color):t.setAttribute("stroke","red"),e.op&&t.setAttribute("stroke-opacity",e.op),t.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),e.tar&&""!=e.tar&&"main"!=e.tar&&"body"!=e.tar&&"app"!=e.tar?$("#"+e.tar).find(">svg")[0]&&this.Append(t,$("#"+e.tar).find(">svg")):this.target&&this.Append(t)}}}function b(t){f.call(this,"PlayDotPan",t);var e=t,i=null,s=null;this.SetOnClick=function(t){s=t},this.Play=function(){if(r(e.id))e.d.indexOf("C")>-1?r(e.id).setAttribute("d",this.FixLinePozEx(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())):(r(e.id).setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.w&&r(e.id).setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),.5,50)));else{var t=n("path");t.setAttribute("tp","dotpan"),t.setAttribute("isdraw","true"),t.setAttribute("id",e.id),e.w?t.setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),.5,50)):t.setAttribute("stroke-width",1),e.d.indexOf("C")>-1?t.setAttribute("d",this.FixLinePozEx(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())):t.setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.color?t.setAttribute("stroke",e.color):t.setAttribute("stroke","black"),e.op&&t.setAttribute("stroke-opacity",e.op),t.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),this.target&&this.Append(t)}},this.PlayLines=function(){var t=this;if(e.Lines&&!(e.Lines.length<1)){var r=new Array;if(s)this.target.find(">rect[tp='linkarea']").each(function(t){var e=new Object;e.id=$(this).attr("id"),e.x=parseFloat($(this).attr("x")),e.y=parseFloat($(this).attr("y")),e.width=parseFloat($(this).attr("width")),e.height=parseFloat($(this).attr("height")),r.push(e)});for(var a=function(i){for(var n=0,o=0,s=0,a=r.length;s<a;s++){for(var l=!0,d=0,h=i.length;d<h;d++)if(n=t.FixPoz(i[d][0],e.Width,t.getContainerWidth()),o=t.FixPoz(i[d][1],e.Width,t.getContainerWidth()),!t.isInsideRect(r[s].x,r[s].y,r[s].width,r[s].height,{x:n,y:o,width:0,height:0})){l=!1;break}if(l)return r[s].id}return""},l=0,d=e.Lines.length;l<d;l++){var h=n("path");h.setAttribute("tp","dotpan"),h.setAttribute("isdraw","true"),h.setAttribute("id",o()),h.setAttribute("stroke","black"),h.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),h.setAttribute("stroke-width",this.FixPoz(5,e.Width,this.getContainerWidth()));for(var p="",u=0,g=e.Lines[l].points.length;u<g;u++)0==u?(p+="M"+this.FixPoz(e.Lines[l].points[u][0],e.Width,this.getContainerWidth()),p+=","+this.FixPoz(e.Lines[l].points[u][1],e.Width,this.getContainerWidth())):(p+=" L"+this.FixPoz(e.Lines[l].points[u][0],e.Width,this.getContainerWidth()),p+=","+this.FixPoz(e.Lines[l].points[u][1],e.Width,this.getContainerWidth())),1==g&&(p+=" L"+this.FixPoz(e.Lines[l].points[u][0],e.Width,this.getContainerWidth()),p+=","+this.FixPoz(e.Lines[l].points[u][1],e.Width,this.getContainerWidth()));if(h.setAttribute("d",p),this.target&&this.target[0].appendChild(h),l==d-1&&(i=h),s&&r.length>0&&e.Lines[l].points.length>0&&e.Lines[l].points.length<10){var v=a(e.Lines[l].points);if(""!=v){var f=JSON.parse(c($("#"+v).attr("info")));f&&s&&s(f)}}}}},this.PlayLinesEx=function(){var t=this;if(e.Lines&&!(e.Lines.length<1)){var r=new Array;if(s)this.target.find(">rect[tp='linkarea']").each(function(t){var e=new Object;e.id=$(this).attr("id"),e.x=parseFloat($(this).attr("x")),e.y=parseFloat($(this).attr("y")),e.width=parseFloat($(this).attr("width")),e.height=parseFloat($(this).attr("height")),r.push(e)});for(var a=function(i){for(var n=0,o=0,s=0,a=r.length;s<a;s++){for(var l=!0,d=0,h=i.length;d<h;d++)if(n=t.FixPoz(i[d][0],e.Width,t.getContainerWidth()),o=t.FixPoz(i[d][1],e.Width,t.getContainerWidth()),!t.isInsideRect(r[s].x,r[s].y,r[s].width,r[s].height,{x:n,y:o,width:0,height:0})){l=!1;break}if(l)return r[s].id}return""},l=0,d=e.Lines.length;l<d;l++){for(var h=0,p=e.Lines[l].points.length;h<p&&!(h>0&&h==p-1);h++){var u=n("path");u.setAttribute("tp","dotpan"),u.setAttribute("isdraw","true"),u.setAttribute("id",(e.Lines[l].id?e.Lines[l].id:o())+"_"+h),u.setAttribute("stroke","black"),u.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;");var g=e.Lines[l].points[h][2]/100;g=this.FixPoz(g,e.Width,this.getContainerWidth()),g=Math.max(g,.2),g=Math.min(g,20),u.setAttribute("stroke-width",g);var v="M";for(v+=this.FixPoz(e.Lines[l].points[h][0],e.Width,this.getContainerWidth()),v+=","+this.FixPoz(e.Lines[l].points[h][1],e.Width,this.getContainerWidth());h+1<p&&e.Lines[l].points[h][2]==e.Lines[l].points[h+1][2];)v+=" L"+this.FixPoz(e.Lines[l].points[h+1][0],e.Width,this.getContainerWidth()),v+=","+this.FixPoz(e.Lines[l].points[h+1][1],e.Width,this.getContainerWidth()),h++;h==p-1?(v+=" L"+this.FixPoz(e.Lines[l].points[h][0],e.Width,this.getContainerWidth()),v+=","+this.FixPoz(e.Lines[l].points[h][1],e.Width,this.getContainerWidth())):(v+=" L"+this.FixPoz(e.Lines[l].points[h+1][0],e.Width,this.getContainerWidth()),v+=","+this.FixPoz(e.Lines[l].points[h+1][1],e.Width,this.getContainerWidth())),u.setAttribute("d",v),this.target&&this.Append(u)}if(l==d-1&&(i=u),s&&r.length>0&&e.Lines[l].points.length>0&&e.Lines[l].points.length<10){var f=a(e.Lines[l].points);if(""!=f){var y=JSON.parse(c($("#"+f).attr("info")));y&&s&&s(y)}}}}},this.PlayLinesSync=function(t,s){if(e.Lines&&!(e.Lines.length<1))for(var a=0,l=e.Lines.length;a<l;a++)if(e.Lines[a].points&&!(e.Lines[a].points.length<1))if(e.Lines[a].points[0][3]>s||e.Lines[a].points[e.Lines[a].points.length-1][3]<t){if(e.Lines[a].points[e.Lines[a].points.length-1][3]>s)break}else{var d=r(e.Lines[a].id),h="",c=!1;d?(h=d.getAttributeNode("d").nodeValue,c=!0):((d=n("path")).setAttribute("tp","dotpan"),d.setAttribute("isdraw","true"),d.setAttribute("id",e.Lines[a].id?e.Lines[a].id:o()),d.setAttribute("stroke","black"),d.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),d.setAttribute("stroke-width",this.FixPoz(3,e.Width,this.getContainerWidth())));for(var p=!1,u=0,g=e.Lines[a].points.length;u<g;u++)e.Lines[a].points[u][3]>s||e.Lines[a].points[u][3]<t?e.Lines[a].points[u][3]>s&&(p=!0):(""==h?(h+="M"+this.FixPoz(e.Lines[a].points[u][0],e.Width,this.getContainerWidth()),h+=","+this.FixPoz(e.Lines[a].points[u][1],e.Width,this.getContainerWidth())):(h+=" L"+this.FixPoz(e.Lines[a].points[u][0],e.Width,this.getContainerWidth()),h+=","+this.FixPoz(e.Lines[a].points[u][1],e.Width,this.getContainerWidth())),1==g&&(h+=" L"+this.FixPoz(e.Lines[a].points[u][0],e.Width,this.getContainerWidth()),h+=","+this.FixPoz(e.Lines[a].points[u][1],e.Width,this.getContainerWidth())));if(d.setAttribute("d",h),!c&&this.target&&this.target[0].appendChild(d),a==l-1&&(i=d),p)break}},this.Sleep=function(t){return new Promise(function(e,i){setTimeout(function(){e(!0)},t)})},this.GetLastLine=function(){return i}}function w(t){f.call(this,"PlayLinkArea",t);var e=t,i=null;this.SetOnClick=function(t){i=t},this.Play=function(){if(e.id||(e.id=o()),r(e.id))r(e.id).setAttribute("x",this.FixPoz(e.x,e.CW,this.getContainerWidth())),r(e.id).setAttribute("y",this.FixPoz(e.y,e.CW,this.getContainerWidth())),r(e.id).setAttribute("width",this.FixPoz(e.width,e.CW,this.getContainerWidth())),r(e.id).setAttribute("height",this.FixPoz(e.height,e.CW,this.getContainerWidth()));else{var t=this.CreateEle("rect",{id:e.id,isdraw:"true",tp:"linkarea",style:"fill:blue;stroke:blue;stroke-width:2;opacity:0.5;fill-opacity:0.1;cursor:pointer;","stroke-dasharray":"4",rx:"10",ry:"10"});t.setAttribute("x",this.FixPoz(e.x,e.CW,this.getContainerWidth())),t.setAttribute("y",this.FixPoz(e.y,e.CW,this.getContainerWidth())),t.setAttribute("width",this.FixPoz(e.width,e.CW,this.getContainerWidth())),t.setAttribute("height",this.FixPoz(e.height,e.CW,this.getContainerWidth())),e.info&&t.setAttribute("info",h(JSON.stringify(e.info))),this.Append(t),$(t).bind(this.EVENTCLICK,function(t){i&&i(e.info)})}}}function C(t){f.call(this,"PlayLine",t);var e=t;this.Play=function(){if(r(e.id))e.d.indexOf("C")>-1?r(e.id).setAttribute("d",this.FixLinePozEx(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())):(r(e.id).setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.w&&r(e.id).setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),.5,50)));else{var t=this.CreateEle("path",{tp:"line",isdraw:"true",id:e.id});e.w?t.setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),.5,50)):t.setAttribute("stroke-width",1),e.d.indexOf("C")>-1?t.setAttribute("d",this.FixLinePozEx(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())):t.setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.color?t.setAttribute("stroke",e.color):t.setAttribute("stroke","red"),e.op&&t.setAttribute("stroke-opacity",e.op),t.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),e.tar&&""!=e.tar&&"main"!=e.tar&&"body"!=e.tar&&"app"!=e.tar?$("#"+e.tar).find(">svg")[0]&&this.Append(t,$("#"+e.tar).find(">svg")[0]):this.target&&this.Append(t)}}}function S(t){f.call(this,"PlayBrush",t),this.Play=function(){var e=t;if(r(e.id))r(e.id).setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),e.w&&r(e.id).setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),1,200));else{var i=this.CreateEle("path",{tp:"brush",isdraw:"true",id:e.id});i.setAttribute("d",this.FixLinePoz(e.d,e.CW,e.CH,this.getContainerWidth(),this.getContainerHeight())),i.setAttribute("style","fill-opacity:0;stroke-opacity:0.5;stroke-linecap:round;"),e.w?i.setAttribute("stroke-width",this.GetNumberRange(this.FixPoz(e.w,e.CW,this.getContainerWidth()),1,200)):i.setAttribute("stroke-width",30),e.color?i.setAttribute("stroke",e.color):i.setAttribute("stroke","yellow"),this.Append(i)}}}function m(t){f.call(this,"PlayText",t);var e=t,i=null;function n(t,e){if("sans-serif"==e)return t>=26?-2:-1;var i=2;if(t>=20)switch(e){case"consolas":i=2;break;case"monospace":i=4;break;case"sans-serif":i=-2;break;case"serif":case"cursive":i=4}else switch(e){case"consolas":i=1;break;case"monospace":i=2;break;case"sans-serif":i=0;break;case"serif":case"cursive":i=2}return i}this.SetOnEdit=function(t){i=t},this.Play=function(){var t=this,o=function(){var i=t.CreateEle("g",{id:"g_"+e.id,isdraw:"true"});t.Append(i);var o=t.FixPoz(e.x,e.CW,t.getContainerWidth()),s=t.FixPoz(e.y,e.CW,t.getContainerWidth()),a=e.Rect&&e.Rect.size?t.FixPoz(e.Rect.size,e.CW,t.getContainerWidth()):14,l=e.Rect&&e.Rect.font?e.Rect.font:"consolas",d=t.CreateEle("text",{x:o+1,y:s+1,style:"fill:"+(e.Rect&&e.Rect.color?e.Rect.color:"red")+";font-size:"+a+"px;font-family:"+l+";"});d.innerHTML="",i.appendChild(d),""!=e.Rect.text&&r(e.id).setAttribute("style","fill:blue;stroke:blue;stroke-width:0;fill-opacity:0;");for(var h=t.SplitTextEx(u(c(e.Rect.text)),t.FixPoz(e.width,e.CW,t.getContainerWidth()),a,l),p=n(a,l),g=Math.round(1.2*a),v=0;v<h.length;v++){var f=t.CreateEle("tspan",{x:o-.5,y:s+a-p+g*v});f.innerHTML=h[v],d.appendChild(f)}};if(r(e.id)){if((x=r(e.id)).setAttribute("style","fill:blue;stroke:blue;stroke-width:1;fill-opacity:0.1;"),x.setAttribute("x",this.FixPoz(e.x,e.CW,this.getContainerWidth())),x.setAttribute("y",this.FixPoz(e.y,e.CW,this.getContainerWidth())),x.setAttribute("width",this.FixPoz(e.width,e.CW,this.getContainerWidth())),x.setAttribute("height",this.FixPoz(e.height,e.CW,this.getContainerWidth())),e.Rect){if(!r("g_"+e.id))return void o();var s=this.FixPoz(e.x,e.CW,this.getContainerWidth()),a=this.FixPoz(e.y,e.CW,this.getContainerWidth()),l=$("#g_"+e.id).find(">text")[0];e.Rect&&e.Rect.color&&$(l).css("fill",e.Rect.color),e.Rect&&e.Rect.font&&$(l).css("font-family",e.Rect.font),l.setAttribute("x",s+1),l.setAttribute("y",a+1),l.innerHTML="",""!=e.Rect.text&&r(e.id).setAttribute("style","fill:blue;stroke:blue;stroke-width:0;fill-opacity:0;");var d=e.Rect&&e.Rect.size?this.FixPoz(e.Rect.size,e.CW,this.getContainerWidth()):14,h=e.Rect&&e.Rect.font?e.Rect.font:"consolas",p=n(d,h),g=Math.round(1.2*d),v=this.SplitTextEx(u(c(e.Rect.text)),this.FixPoz(e.width,e.CW,this.getContainerWidth()),d,h);$(l).css("font-size",d+"px");for(var f=0;f<v.length;f++){var y=this.CreateEle("tspan",{x:s-.5,y:a+d-p+g*f});y.innerHTML=v[f],l.appendChild(y)}}}else{var x;(x=this.CreateEle("rect",{id:e.id,isdraw:"true",tp:"text",style:"fill:blue;stroke:blue;stroke-width:1;fill-opacity:0.1;"})).setAttribute("x",this.FixPoz(e.x,e.CW,this.getContainerWidth())),x.setAttribute("y",this.FixPoz(e.y,e.CW,this.getContainerWidth())),x.setAttribute("width",this.FixPoz(e.width,e.CW,this.getContainerWidth())),x.setAttribute("height",this.FixPoz(e.height,e.CW,this.getContainerWidth())),this.Append(x),e.Rect&&o();var b=$("#"+e.id);$("#"+e.id+",#g_"+e.id).bind(this.EVENTCLICK,function(t){i&&i(b,!1)})}}}function T(t){f.call(this,"PlayNote",t);var e=t,i=null;function n(t,e){if("sans-serif"==e)return t>=26?-2:-1;var i=2;if(t>=20)switch(e){case"consolas":i=2;break;case"monospace":i=4;break;case"sans-serif":i=-2;break;case"serif":case"cursive":i=4}else switch(e){case"consolas":i=1;break;case"monospace":i=2;break;case"sans-serif":i=0;break;case"serif":case"cursive":i=2}return i}this.SetOnEdit=function(t){i=t};var o=null;this.SetOnRecord=function(t){o=t},this.Play=function(){var t,s=this,a=function(){var t=s.CreateEle("g",{id:"g_"+e.id,isdraw:"true",tp:"note"});s.Append(t);var i=s.FixPoz(e.Rect.x,e.CW,s.getContainerWidth()),o=s.FixPoz(e.Rect.y,e.CW,s.getContainerWidth()),r=e.Rect&&e.Rect.size?s.FixPoz(e.Rect.size,e.CW,s.getContainerWidth()):14,a=e.Rect&&e.Rect.font?e.Rect.font:"consolas",l=s.CreateEle("rect",{style:"fill:white;stroke:#FFC107;stroke-width:1;fill-opacity:0.9;",x:i,y:o});l.setAttribute("width",s.FixPoz(e.Rect.width,e.CW,s.getContainerWidth())),l.setAttribute("height",s.FixPoz(e.Rect.height,e.CW,s.getContainerWidth())),t.appendChild(l);var d=s.CreateEle("text",{x:i+5,y:o+15,style:"fill:"+(e.Rect&&e.Rect.color?e.Rect.color:"black")+";font-size:"+r+"px;font-family:"+a+";"});d.innerHTML="",t.appendChild(d);for(var h=s.SplitTextEx(u(c(e.Rect.text)),s.FixPoz(e.Rect.width,e.CW,s.getContainerWidth()),r,a),p=n(r,a),g=Math.round(1.2*r),v=0;v<h.length;v++){var f=s.CreateEle("tspan",{x:i-.5,y:o+r-p+g*v});f.innerHTML=h[v],d.appendChild(f)}var y=s.FixPoz(e.Rect.x1,e.CW,s.getContainerWidth()),x=s.FixPoz(e.Rect.y1,e.CW,s.getContainerWidth()),b=s.CreateEle("line",{style:"stroke-width:1; stroke:#FFC107;"});b.setAttribute("x1",y),b.setAttribute("y1",x),b.setAttribute("x2",s.FixPoz(e.Rect.x2,e.CW,s.getContainerWidth())),b.setAttribute("y2",s.FixPoz(e.Rect.y2,e.CW,s.getContainerWidth())),t.appendChild(b);var w=s.CreateEle("circle");w.setAttribute("cx",y),w.setAttribute("cy",x),w.setAttribute("r",5),w.setAttribute("fill","#FFC107"),t.appendChild(w),1==e.Rect.show?($(t).show(),$("#"+e.id).hide()):($(t).hide(),$("#"+e.id).show())};if(r(e.id)){if((t=r(e.id)).setAttribute("x",this.FixPoz(e.x,e.CW,this.getContainerWidth())),t.setAttribute("y",this.FixPoz(e.y,e.CW,this.getContainerWidth())),t.setAttribute("width",this.FixPoz(e.width,e.CW,this.getContainerWidth())),t.setAttribute("height",this.FixPoz(e.height,e.CW,this.getContainerWidth())),e.Rect){if(!r("g_"+e.id))return void a();var l=$("#g_"+e.id).find(">rect")[0],d=this.FixPoz(e.Rect.x,e.CW,this.getContainerWidth()),h=this.FixPoz(e.Rect.y,e.CW,this.getContainerWidth());l.setAttribute("x",d),l.setAttribute("y",h),l.setAttribute("width",this.FixPoz(e.Rect.width,e.CW,this.getContainerWidth())),l.setAttribute("height",this.FixPoz(e.Rect.height,e.CW,this.getContainerWidth()));var p=$("#g_"+e.id).find(">text")[0];e.Rect&&e.Rect.color&&$(p).css("fill",e.Rect.color),e.Rect&&e.Rect.font&&$(p).css("font-family",e.Rect.font),p.setAttribute("x",d+5),p.setAttribute("y",h+15),p.innerHTML="";var g=e.Rect&&e.Rect.size?this.FixPoz(e.Rect.size,e.CW,this.getContainerWidth()):14,v=e.Rect&&e.Rect.font?e.Rect.font:"consolas",f=n(g,v),y=Math.round(1.2*g),x=this.SplitTextEx(u(c(e.Rect.text)),this.FixPoz(e.Rect.width,e.CW,this.getContainerWidth()),g,v);$(p).css("font-size",g+"px");for(var b=0;b<x.length;b++){var w=this.CreateEle("tspan",{x:d-.5,y:h+g-f+y*b});w.innerHTML=x[b],p.appendChild(w)}var C=this.FixPoz(e.Rect.x1,e.CW,this.getContainerWidth()),S=this.FixPoz(e.Rect.y1,e.CW,this.getContainerWidth()),m=$("#g_"+e.id).find(">line")[0];m.setAttribute("x1",C),m.setAttribute("y1",S),m.setAttribute("x2",this.FixPoz(e.Rect.x2,e.CW,this.getContainerWidth())),m.setAttribute("y2",this.FixPoz(e.Rect.y2,e.CW,this.getContainerWidth())),m.setAttribute("style","stroke-width:1; stroke:#FFC107;");var T=$("#g_"+e.id).find(">circle")[0];T.setAttribute("cx",C),T.setAttribute("cy",S),T.setAttribute("r",5),T.setAttribute("fill","#FFC107"),1==e.Rect.show?($("#g_"+e.id).show(),$("#"+e.id).hide()):($("#g_"+e.id).hide(),$("#"+e.id).show())}}else(t=this.CreateEle("image",{id:e.id,isdraw:"true",tp:"note",href:this.ImagePath+"note-mark2.svg"})).setAttribute("x",this.FixPoz(e.x,e.CW,this.getContainerWidth())),t.setAttribute("y",this.FixPoz(e.y,e.CW,this.getContainerWidth())),t.setAttribute("width",this.FixPoz(e.width,e.CW,this.getContainerWidth())),t.setAttribute("height",this.FixPoz(e.height,e.CW,this.getContainerWidth())),this.Append(t),e.Rect&&a(),$("#"+e.id).bind(this.EVENTCLICK,function(t){$("#g_"+e.id).show(),$("#"+e.id).hide(),o&&o(r(e.id)),0==s.deviceType&&s.target&&s.target.css({cursor:"default"})}),$("#"+e.id).on("STRINK",function(t){0==$("#edit_"+e.id).length&&($("#g_"+e.id).hide(),$("#"+e.id).show(),o&&o(r(e.id)),0==s.deviceType&&s.target&&s.target.css({cursor:"default"}))}),$("#g_"+e.id).bind(this.EVENTCLICK,function(t){i&&i(e.id,!1)})}}function A(t){f.call(this,"PlayBoard",t);var e=t,i=null;this.SetOnEdit=function(t){i=t};var o=null;this.SetOnRecord=function(t){o=t},this.Play=function(){var t=this,s=function(){if(0!=e.mode)if(1==e.mode)i&&i(r(e.id),e.id,!0);else if(2==e.mode)$("#edit_"+e.id).hide()};if(r(e.id)){var a=r(e.id);if(e.x&&e.CW&&(a.setAttribute("x",t.FixPoz(e.x,e.CW,t.getContainerWidth())),a.setAttribute("y",t.FixPoz(e.y,e.CW,t.getContainerWidth())),a.setAttribute("width",t.FixPoz(e.width,e.CW,t.getContainerWidth())),a.setAttribute("height",t.FixPoz(e.height,e.CW,t.getContainerWidth()))),s(),e.Rect){if(!r("g_"+e.id))return void function(){var i=n("g");i.setAttribute("id","g_"+e.id),i.setAttribute("isdraw","true"),t.Append(i);var o="<div id='div_"+e.id+"' isdraw='true' tabindex='41' style='box-sizing:border-box;border:solid 1px #FFC107; background-color:white; z-index:100; position: absolute; top: "+t.FixPoz(e.Rect.y,e.CW,t.getContainerWidth())+"px; left: "+t.FixPoz(e.Rect.x,e.CW,t.getContainerWidth())+"px; width: "+t.FixPoz(e.Rect.width,e.CW,t.getContainerWidth())+"px; height: "+t.FixPoz(e.Rect.height,e.CW,t.getContainerWidth())+"px; '>";o+="<svg id='svg_"+e.id+"' width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg >",o+="</div>",this.target.parent().append(o);var r=t.FixPoz(e.Rect.x1,e.CW,t.getContainerWidth()),s=t.FixPoz(e.Rect.y1,e.CW,t.getContainerWidth()),a=n("line");a.setAttribute("x1",r),a.setAttribute("y1",s),a.setAttribute("x2",t.FixPoz(e.Rect.x2,e.CW,t.getContainerWidth())),a.setAttribute("y2",t.FixPoz(e.Rect.y2,e.CW,t.getContainerWidth())),a.setAttribute("style","stroke-width:1; stroke:#FFC107;"),i.appendChild(a);var l=n("circle");l.setAttribute("cx",r),l.setAttribute("cy",s),l.setAttribute("r",5),l.setAttribute("fill","#FFC107"),i.appendChild(l),1==e.Rect.show?($(i).show(),$("#div_"+e.id).show()):($(i).hide(),$("#div_"+e.id).hide())}();var l=t.FixPoz(e.Rect.x,e.CW,t.getContainerWidth()),d=t.FixPoz(e.Rect.y,e.CW,t.getContainerWidth());$("#div_"+e.id).css({top:d,left:l,width:t.FixPoz(e.Rect.width,e.CW,t.getContainerWidth()),height:t.FixPoz(e.Rect.height,e.CW,t.getContainerWidth())});var h=t.FixPoz(e.Rect.x1,e.CW,t.getContainerWidth()),c=t.FixPoz(e.Rect.y1,e.CW,t.getContainerWidth()),p=$("#g_"+e.id).find(">line")[0];p.setAttribute("x1",h),p.setAttribute("y1",c),p.setAttribute("x2",t.FixPoz(e.Rect.x2,e.CW,t.getContainerWidth())),p.setAttribute("y2",t.FixPoz(e.Rect.y2,e.CW,t.getContainerWidth())),p.setAttribute("style","stroke-width:1; stroke:#FFC107;");var u=$("#g_"+e.id).find(">circle")[0];u.setAttribute("cx",h),u.setAttribute("cy",c),u.setAttribute("r",5),u.setAttribute("fill","#FFC107"),1==e.Rect.show?($("#g_"+e.id).show(),$("#div_"+e.id).show()):($("#g_"+e.id).hide(),$("#div_"+e.id).hide())}}else{(a=n("rect")).setAttribute("id",e.id),a.setAttribute("isdraw","true"),a.setAttribute("tp","board"),a.setAttribute("style","fill:blue;stroke:blue;stroke-width:1;fill-opacity:0.1;"),e.x&&e.CW&&(a.setAttribute("x",t.FixPoz(e.x,e.CW,t.getContainerWidth())),a.setAttribute("y",t.FixPoz(e.y,e.CW,t.getContainerWidth())),a.setAttribute("width",t.FixPoz(e.width,e.CW,t.getContainerWidth())),a.setAttribute("height",t.FixPoz(e.height,e.CW,t.getContainerWidth()))),this.Append(a),s(),t.container.append(t.GetWBContainer(e.id)),$("#"+e.id).bind(t.EVENTCLICK,function(n){t.canEdit&&(o&&o(r(e.id),!0,1),i&&i(r(e.id),e.id,!0))})}},this.GetWBContainer=function(t){this.getViewWidth(),this.getViewHeight();var e=this.getContainerHeight(),i="<div id='edit_"+t+"' class='boardcontainer' tabindex='11' style='position: absolute;box-sizing:border-box;  z-index:103;top:0px; left:0px;width:100%;height:100%;";return i+="background-color:white; border:1px solid #d3d3d3; border-radius:10px; box-shadow: 5px 5px 3px #d3d3d3;display:none;'>",i+="<div class='boardhead' style='height:50px;border-bottom:1px solid #d3d3d3;border-left:1px solid #d3d3d3;border-right:1px solid #d3d3d3;width:100%; z-index:102;background-color:white;position: fixed;display: inline-block;top: 0px;left:0px;'><div style='float:left;height:100%;line-height:50px;padding-top:3px;'><span id='WBTool_Hand_"+t+"' class='WBTool_btn'><img width='20px;' title='Hand' src='"+this.ImagePath+"wb_hand.png' /></span>",i+="<span id='WBTool_Pen_"+t+"' class='WBTool_btn selected'><img width='20px;' title='Pen' src='"+this.ImagePath+"wb_pen.png' /></span><span id='WBTool_Brush_"+t+"' class='WBTool_btn'><img width='20px;' title='Brush' src='"+this.ImagePath+"wb_brush.png' /></span>",i+="<span id='WBTool_Del_"+t+"' class='WBTool_btn'><img width='20px;' title='Delete' src='"+this.ImagePath+"wb_delete.png' /></span>",i+="<span id='WBTool_Undo_"+t+"' class='WBTool_btn'><img width='20px;' title='Undo' src='"+this.ImagePath+"wb_undo.png' /></span><span id='WBTool_Redo_"+t+"' class='WBTool_btn'><img width='20px;' title='Redo' src='"+this.ImagePath+"wb_redo.png' /></span>",i+="</div>",i+="<div style='float:left;height:100%;line-height:50px;padding:2px 0px 0px 10px;'><span id='WBTool_Close_"+t+"' style='cursor:pointer; padding-right:10px;'><img width='20px;' title='Close' src='"+this.ImagePath+"wb_close.png' /></span></div></div><div style='height: 50px;'></div>",i+="<div id='div_"+t+"' style='height:calc(100% - 50px);width:100%;overflow:hidden;position:relative;padding-top:0px;'>",i+="<svg id='svg_"+t+"' width='100%' height='"+3*e+"px' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>",i+="</div></div>"}}function E(t){f.call(this,"PlayVideo",t);var e=t,i=null;this.SetOnEdit=function(t){i=t},this.Play=function(){i(e.id,this.FixPoz(e.Left,e.CW,this.getContainerWidth()),this.FixPoz(e.Top,e.CW,this.getContainerWidth()),e.Info?JSON.stringify(e.Info):"")}}function _(t){f.call(this,"PlayBooksNote",t);var e=t,i=null;this.SetOnEdit=function(t){i=t},this.Play=function(){i(e)}}function R(t){f.call(this,"PlayVideoLink",t);var e=t,i=null;this.SetOnEdit=function(t){i=t},this.Play=function(){i(e.id,this.FixPoz(e.Left,e.CW,this.getContainerWidth()),this.FixPoz(e.Top,e.CW,this.getContainerWidth()),e.Info?JSON.stringify(e.Info):"")}}function P(t){f.call(this,"PlaySync",t);var e=t,i=null;this.SetOnEdit=function(t){i=t},this.Play=function(){i(e.id,this.FixPoz(e.Left,e.CW,this.getContainerWidth()),this.FixPoz(e.Top,e.CW,this.getContainerWidth()),e.Info?JSON.stringify(e.Info):"")}}function I(t){var e=this;f.call(this,"PlayMouseMove",t);var i=null,n=t;this.Play=function(){if(i&&(clearTimeout(i),i=null),0!=n.show){if(0==this.container.find("div.liveMouse").length){this.container.append('<div class="liveMouse" style="position: absolute; left: 0px; top: 0px; z-index: 112; margin: -8px 0px 0px -3px; opacity: 0.6; display: none;"><i class="ivu-icon ivu-icon-mouse" style="font-size: 20px; color: red;"></i></div>')}if(this.container.find("div.liveMouse").show(),0==n.delay)this.PlayOnePointer(this.target,n,n.poz.length-1);else for(var t=0;t<n.poz.length;t++)window.setTimeoutEx(this.PlayOnePointer,n.sleep*t,this.target,n,t)}else this.container.find("div.liveMouse").hide()},this.PlayOnePointer=function(t,n,o){if(o<n.poz.length){var r=e.container[0],s=0,a=0;1==n.bd?(s=e.FixPoz(n.poz[o][1]-50,n.CW,e.getContainerWidth())+50,a=e.FixPoz(n.poz[o][0],n.CW,e.getContainerWidth())):(s=e.FixPoz(n.poz[o][1],n.CW,e.getContainerWidth()),a=e.FixPoz(n.poz[o][0],n.CW,e.getContainerWidth())),s>e.getViewHeight()+r.scrollTop?r.scrollTop=s-e.getViewHeight()+100:s<r.scrollTop&&(r.scrollTop=Math.max(0,s-100)),0==n.delay?(e.container.find("div.liveMouse").stop().css({top:s,left:a,opacity:0}),e.container.find("div.liveMouse").animate({opacity:.6},300)):e.container.find("div.liveMouse").animate({top:s,left:a,opacity:.6},.95*n.sleep)}else i=setTimeout(function(){e.container.find("div.liveMouse").fadeOut("slow")},1e3)}}function k(t){f.call(this,"PlayMouseClick",t);var e=null,i=t;this.Play=function(){var t=this,n=this.main[0],o=0,r=0;if(1==i.bd?(o=this.FixPoz(i.poz[1]-50,i.CW,this.getContainerWidth())+50,r=this.FixPoz(i.poz[0],i.VW,this.getContainerWidth())):(o=this.FixPoz(i.poz[1],i.CW,this.getContainerWidth()),r=this.FixPoz(i.poz[0],i.CW,this.getContainerWidth())),o>this.getViewHeight()+n.scrollTop?n.scrollTop=o-this.getViewHeight()+100:o<n.scrollTop&&(n.scrollTop=Math.max(0,o-100)),e&&(clearTimeout(e),e=null),this.container.find("div.liveMouse").stop().css({top:o,left:r,opacity:.6}),0==this.container.find("div.liveMouseClick").length){this.container.append('<div class="liveMouseClick" style="position:absolute; left: 0px; top: 0px;z-index:113;"><div class="liveMouseContainer"></div></div>')}this.container.find("div.liveMouseClick").css({display:"block",top:o,left:r}),this.container.find("div.liveMouseContainer").removeClass("liveMouseShowAnimation").addClass("liveMouseShowAnimation"),e=setTimeout(function(){t.container.find("div.liveMouseContainer").removeClass("liveMouseShowAnimation"),t.container.find("div.liveMouseClick").hide()},200)}}function W(t,e,i){f.call(this,"PlayChangeView",t);var n=t,o=null;this.SetOnZoom=function(t){o=t},this.Play=function(){var t=this,r=new Object;r.CW=this.getContainerWidth(),r.CH=this.getContainerHeight(),r.VW=this.getViewWidth(),r.VH=this.getViewHeight(),r.ST=0|this.main.scrollTop(),r.SL=0|this.main.scrollLeft();var s=function(t,e,i){var n=Object();0==i?(n.Zoom=t.CW/t.VW,t.ST>0?n.Top=t.ST*e.CW/t.CW:n.Top=0,t.SL>0?n.Left=t.SL*e.CH/t.CH:n.Left=0):(n.Zoom=t.CH/t.VH,t.ST>0?n.Top=t.ST*e.CW/t.CW:n.Top=0,t.SL>0?n.Left=t.SL*e.CH/t.CH:n.Left=0);return n}(n,r,i);Math.abs(s.Zoom-e)<.01?(s.Left>=0&&this.main.scrollLeft(s.Left),s.Top>=0&&this.main.scrollTop(s.Top)):o(s.Zoom,function(){s.Left>=0&&t.main.scrollLeft(s.Left),s.Top>=0&&t.main.scrollTop(s.Top)})}}function O(t){f.call(this,"PlayHide",t);var e=t;this.Play=function(){$("#"+this.GetFixedPageNumber(e.id)).hide()}}function z(t){f.call(this,"PlayDelete",t),this.Play=function(){$("#"+this.GetFixedPageNumber(t.id)).remove(),$("#g_"+this.GetFixedPageNumber(t.id)).remove()}}function L(t){f.call(this,"PlayClear",t);var e=t;this.Play=function(){$("#"+this.GetFixedPageNumber(e.id)).find("path,g,circle").remove(),$("#"+this.GetFixedPageNumber(e.id)).find("rect").each(function(t){"board"==$(this).attr("tp")&&$("#edit_"+$(this).attr("id")).remove(),$(this).remove()}),this.container.find("div.live-video-tool-container").remove(),this.container.find("div.live-booknote-tool-container").remove(),this.container.find("div.live-video-link-tool-container").remove(),this.container.find("div.live-sync-tool-container").remove()}}function N(t){f.call(this,"PlaySelect",t);var e=t;this.Play=function(){if(1==e.stat){var t=$("#"+e.id),i=r(e.id).getBoundingClientRect();i.width+i.height<10?t.attr("class","WB_SelectPathSmall"):t.attr("class","WB_SelectPath")}else $("#"+e.id).removeAttr("class")}}function V(t){f.call(this,"PlayResize",t);var e=t;this.Play=function(){var t=$("#"+this.GetFixedPageNumber(e.id));if(1==e.size)t.height(t.height()+.5*t.parent().height());else if(-1==e.size){if(t.height()<t.parent().height())return;t.height(t.height()-.5*t.parent().height())}}}function F(t){f.call(this,"PlayScroll",t),this.Play=function(){var e=r(t.id);e.scrollTop=t.poz*parseFloat($(e).width())}}function B(t){this.name=t,this.onReocrd=null,this.onSetTool=null,this.onSetActiveTool=null,this.onRecordHistory=null,this.target=null,this.container=null,this.main=null,this.pagenumber=null,this.ele=null,this.canEdit=!0,this.getCanEdit=null,this.onError=null,this.onToolSetting=null,this.deviceType=0,this.EVENTSTART="mousedown pointerdown",this.EVENTMOVE="mousemove pointermove",this.EVENTEND="mouseup pointerup",this.EVENTRESIZE="onpointerdown",this.EVENTCLICK="click",this.EVENTOUT="pointerleave",this.EVENTCHANGE="change",this.ImagePath="/static/images/";var e=t,i=[0,0];this.Text={Delete:"Delete",Edit:"Edit",Cancel:"Cancel",Save:"Save"},this.SetParamter=function(t,e,i,n,o,r,s,a,l){this.onReocrd=t,this.target=e,this.container=i,this.main=n,this.pagenumber=o,this.deviceType=r,this.onSetTool=s,this.onSetActiveTool=a,this.onRecordHistory=l,0!=this.deviceType&&(this.EVENTSTART="touchstart",this.EVENTMOVE="touchmove",this.EVENTEND="touchend",this.EVENTCLICK="click",this.EVENTCHANGE="change",this.EVENTRESIZE="ontouchstart",this.EVENTOUT="touchcancel",-1==location.href.toLowerCase().indexOf("http")&&(this.ImagePath="img/")),this.Init()},this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"default"})},this.Destroy=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"default"}),this.SetTool(""),this.SetActiveTool(null)},this.SetCanEdit=function(t){this.canEdit=t},this.SetCanEditFun=function(t){this.getCanEdit=t},this.SetOnError=function(t){this.onError=t},this.SetEle=function(t){this.ele=t},this.SetTool=function(t){this.onSetTool&&this.onSetTool(t)},this.SetActiveTool=function(t){this.onSetActiveTool&&this.onSetActiveTool(t)},this.SetOption=function(t){},this.SetOnToolSetting=function(t){this.onToolSetting=t},this.onStart=function(t,e){console.log(this.name+":onStart not done")},this.onMove=function(t,e){console.log(this.name+":onMove not done")},this.onEnd=function(t,i){console.log(e+":onEnd not done")},this.onClick=function(t,e){return!1},this.Record=function(t){console.log(e+":Record not done")},this.Delete=function(){return!1},this.Record_delete=function(t,e){var i=new Object;return i.type=102,i.page=this.pagenumber,i.save=1,i.id=t,this.RecordHandle(i),i},this.Record_clear=function(t,e){var i=new Object;return i.type=103,i.page=this.pagenumber,i.save=1,i.id=t,this.RecordHandle(i),i},this.Record_resize=function(t,e){var i=new Object;return i.type=201,i.page=this.pagenumber,i.id=t,i.size=e,i.CW=this.getContainerWidth(),i.CH=this.getContainerHeight(),this.RecordHandle(i),i},this.Record_scroll=function(t){var e=new Object;return e.type=202,e.page=this.pagenumber,e.id=t,e.poz=r(t).scrollTop/$("#"+t).width(),e.CW=this.getContainerWidth(),e.CH=this.getContainerHeight(),this.RecordHandle(e),e},this.Record_select=function(t,e){var i=new Object;return i.type=104,i.id=t,i.page=this.pagenumber,i.stat=e,this.RecordHandle(i),i},this.RecordHistory_delete=function(t,e){var i=new Object;return i.type=102,i.page=this.pagenumber,i.save=1,i.id=t,i},this.Append=function(){if(this.target[0].firstChild){var t=this.target.find(">path");0==t.length?this.target[0].insertBefore(this.ele,this.target[0].firstChild):t.last().after($(this.ele))}else this.target[0].appendChild(this.ele)},this.getContainerWidth=function(){return this.container.width()},this.getContainerHeight=function(){return this.container.height()},this.getViewHeight=function(){return this.main.height()},this.getViewWidth=function(){return this.main.width()},this.GetFixedPageNumber=function(t){return(t+"").replace(".","\\.")},this.getLastNode=function(t){return t.substr(t.lastIndexOf("L")+1)},this.isIntersectRect=function(t,e,i,n,o){return!(o.y+o.height<e||e+n<o.y||t>o.x+o.width||o.x>t+i)},this.isInsideRect=function(t,e,i,n,o){return o.x>=t&&o.y>=e&&o.x+o.width<=t+i&&o.y+o.height<=e+n},this.isIntersectLine=function(t,e){var i=function(t,e,i,n){return t*n-e*i},n=t.x1,o=t.y1,r=t.x2,s=t.y2,a=e.x1,l=e.y1,d=e.x2,h=e.y2,c=d-a,p=h-l,u=n-a,g=o-l,v=d-r,f=h-s,y=n-r,x=o-s,b=a-r,w=l-s;return i(r-a,s-l,c,p)*i(c,p,u,g)>0&&i(v,f,y,x)*i(y,x,b,w)>0},this._drawGetTop=function(){return $(document).scrollTop()+this.main.scrollTop()-this._drawGetBoundingTop()},this._drawGetLeft=function(){return $(document).scrollLeft()+this.main.scrollLeft()-this._drawGetBoundingLeft()},this._drawGetBoundingLeft=function(){var t=this.container[0].getBoundingClientRect().left;return t=Math.max(t,0)},this._drawGetBoundingTop=function(){var t=this.container[0].getBoundingClientRect().top;return t=Math.max(t,0)},this.CheckRecordStep=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=Math.abs(t-i[0])+Math.abs(e-i[1])>=n;return o&&(i=[t,e]),o},this.ShowArrow=function(t){var e,i,n,o,r=$("#g_"+t.attr("id")),s=r.find(">line"),a=r.find(">rect"),l=parseInt(t.attr("x")),d=parseInt(t.attr("y")),h=parseInt(t.attr("width")),c=parseInt(t.attr("height")),p=parseInt(a.attr("x")),u=parseInt(a.attr("y")),g=parseInt(a.attr("width")),v=parseInt(a.attr("height"));d>u+v?(e=l+h/2,i=d,n=p+g/2,o=u+v):u>d+c?(e=l+h/2,i=d+c,n=p+g/2,o=u):p+g/2>l+h/2?l>p?(e=l,i=d+c/2,n=p,o=u+v/2):(e=l+h,i=d+c/2,n=p,o=u+v/2):l>p+g?(e=l,i=d+c/2,n=p+g,o=u+v/2):(e=l+h,i=d+c/2,n=p+g,o=u+v/2),s.attr("x1",e),s.attr("y1",i),s.attr("x2",n),s.attr("y2",o);var f=r.find(">circle");f.attr("cx",e),f.attr("cy",i)},this.SplitText=function(t,e){for(var i=e/8|0,n=new Array,o=function(t){for(var e=new Array,n="";t.length>0;)n+=t[0],t=t.substr(1),n.replace(/[^\x00-\xff]/g,"**").length>=i&&(e.push(n),n="");return""!=n&&e.push(n),e},r=function(t){for(var e=new Array;t.indexOf("\r\n")>-1||t.indexOf("\n")>-1;)t.indexOf("\r\n")>-1?(e.push(t.substring(0,t.indexOf("\r\n")+1)),t=t.substr(t.indexOf("\r\n")+1)):t.indexOf("\n")>-1&&(e.push(t.substring(0,t.indexOf("\n")+1)),t=t.substr(t.indexOf("\n")+1));return""!=t&&e.push(t),e}(t),s=0;s<r.length;s++)for(var a=o(r[s]),l=0;l<a.length;l++)n.push(a[l]);return n},this.SplitTextEx=function(t,e,i,n){var o=new Array;if(!t||""==t)return o;var r=$("#divforwhiteboardgetlines"),s=Math.round(1.2*i);if(0==r.length){var a="<div id='divforwhiteboardgetlines' style=\"width:"+e+"px;font-family:"+n+";word-wrap:break-word;word-break:break-all;padding:0px;margin:0px;line-height:"+s+"px;font-size:"+i+'px;position:absolute;top:-550px;left:-550px;"></div>';$(document.body).append(a),r=$("#divforwhiteboardgetlines")}else r.css({width:e+"px","font-size":i+"px","line-height":s+"px","font-family":n});for(var l=function(t){r.html("");for(var e="",i="",n=new Array;t.length>0;)e+=t[0],r.html(e),r.height()>=2*s?(e="",n.push(i),i=""):(t=t.substr(1),i=e);return""!=e&&n.push(e),n},d=function(t){for(var e=new Array;t.indexOf("\r\n")>-1||t.indexOf("\n")>-1;)t.indexOf("\r\n")>-1?(e.push(t.substring(0,t.indexOf("\r\n")+1)),t=t.substr(t.indexOf("\r\n")+1)):t.indexOf("\n")>-1&&(e.push(t.substring(0,t.indexOf("\n")+1)),t=t.substr(t.indexOf("\n")+1));return""!=t&&e.push(t),e}(t),h=0;h<d.length;h++)for(var c=l(d[h]),p=0;p<c.length;p++)o.push(c[p]);return o},this.RecordHandle=function(t){this.onReocrd&&this.onReocrd(t)},this.CreateRecordBaseInfo=function(t,e,i){i=i||this.ele;var n=new Object;if(n.type=t,n.page=this.pagenumber,n.CW=this.getContainerWidth(),n.CH=this.getContainerHeight(),n.VW=this.getViewWidth(),n.VH=this.getViewHeight(),i&&(n.id=i.getAttributeNode("id").nodeValue),e&&i)for(var o in e)i.getAttributeNode(e[o])&&(n[o]=i.getAttributeNode(e[o]).nodeValue);return n},this.CreateEle=function(t,e){var i=n(t);if(i.setAttribute("id",o()),e)for(var r in e)i.setAttribute(r,e[r]);return i},this.ShowSetting=function(t){},this.ShowColorSizeSetting=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5;if(i){var a='<div id="WBTool_Setting" tabindex="100" class="WBTool_Setting">\n            <div tabindex="100" class="WBTool_closecontainer">\n                <div style="cursor:pointer; float:right;padding-right:10px;" class="WBTool_Close"><span class="icon icon-close" style="font-size:20px; color:#9DA6B7"></span></div>\n            </div>\n            <div style="clear:both;"></div>';a+=""!=r?'<div id="WBTool_Setting_Font" class="WBTool_settingfont" title="Select Font">\n                <span tabindex="100" class="WBTool_selectfontcontainer" val="consolas" ><span class="WBTool_selectfont" style="font-family:Consolas;">Consolas</span></span>\n                <span tabindex="100" class="WBTool_selectfontcontainer" val="monospace" ><span class="WBTool_selectfont" style="font-family:monospace;">Mono</span></span>\n                <span tabindex="100" class="WBTool_selectfontcontainer" val="sans-serif" ><span class="WBTool_selectfont" style="font-family:sans-serif;">Sans</span></span>\n                <span tabindex="100" class="WBTool_selectfontcontainer" val="serif" ><span class="WBTool_selectfont" style="font-family:sans-serif;">Serif</span></span>\n                <span tabindex="100" class="WBTool_selectfontcontainer" val="cursive" ><span class="WBTool_selectfont" style="font-family:cursive;">Cursive</span></span>\n            </div>\n            <div tabindex="100" id="WBTool_Setting_Size" class="WBTool_selectsizeinputcontainer">\n                <p>Size</p>\n                <input type="range" class="WBTool_selectsizeinput" style="width: 160px;" min="10" max="40" value="14">\n                <span class="WBTool_selectsizespan">3</span>\n            </div>':'<div tabindex="100" id="WBTool_Setting_Size" class="WBTool_selectsizeinputcontainer">\n                <p>Thickness</p>\n                <input type="range" class="WBTool_selectsizeinput" style="width: 160px;" min="1" max="10" value="2">\n                <span class="WBTool_selectsizespan">3</span>\n            </div>',a+='<div id="WBTool_Setting_Color" tabindex="100" style="widTth:100%; margin-bottom:15px;" title="Select Color">\n                <div tabindex="100" class="WBTool_selectcolorline">\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#FFF966" ><span class="WBTool_selectcolor" style="background-color:#FFF966;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#FFD200" ><span class="WBTool_selectcolor" style="background-color:#FFD200;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#FF9500" ><span class="WBTool_selectcolor" style="background-color:#FF9500;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#FF5B5B" ><span class="WBTool_selectcolor" style="background-color:#FF5B5B;"></span></span>\n                </div>\n                <div tabindex="100" class="WBTool_selectcolorline">\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#5DF7E5" ><span class="WBTool_selectcolor" style="background-color:#5DF7E5;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#94ED32" ><span class="WBTool_selectcolor" style="background-color:#94ED32;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#E844AD" ><span class="WBTool_selectcolor" style="background-color:#E844AD;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#FF3314" ><span class="WBTool_selectcolor" style="background-color:#FF3314;"></span></span>\n                </div>\n                <div tabindex="100" class="WBTool_selectcolorline">\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#84B9FD" ><span class="WBTool_selectcolor" style="background-color:#84B9FD;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#3DA4FB" ><span class="WBTool_selectcolor" style="background-color:#3DA4FB;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#5846D6" ><span class="WBTool_selectcolor" style="background-color:#5846D6;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#7939D1" ><span class="WBTool_selectcolor" style="background-color:#7939D1;"></span></span>\n                </div>\n                <div tabindex="100" class="WBTool_selectcolorline">\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#FFFFFF" ><span class="WBTool_selectcolor" style="background-color:#FFFFFF;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#B9D1D3" ><span class="WBTool_selectcolor" style="background-color:#B9D1D3;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#757486" ><span class="WBTool_selectcolor" style="background-color:#757486;"></span></span>\n                    <span tabindex="100" class="WBTool_selectcolorcontainer" val="#000000" ><span class="WBTool_selectcolor" style="background-color:#000000;"></span></span>\n                </div>\n\n            </div>',a+="</div>",$("#WBTool_Setting").length>0&&$("#WBTool_Setting").remove(),this.main.append(a),0==this.deviceType?n?$("#WBTool_Setting").css({left:"50px",top:"50px",position:"absolute"}):$("#WBTool_Setting").css({left:"auto",right:s+"px",position:"absolute",top:this.main.scrollTop()+32+"px"}):n?$("#WBTool_Setting").css({left:"5px",top:"50px"}):$("#WBTool_Setting").css({left:"auto",right:s+"px",top:"0px"}),$("#WBTool_Setting").show(),""!=r&&$("#WBTool_Setting_Font").find("span[val='"+r+"']").addClass("selected"),$("#WBTool_Setting_Size").find("span[val='"+t+"']").addClass("selected"),$("#WBTool_Setting_Size").find(".WBTool_selectsizeinput").val(t),$("#WBTool_Setting_Size").find(".WBTool_selectsizespan").text(t),$("#WBTool_Setting_Color").find("span[val='"+e+"']").addClass("selected"),$("#WBTool_Setting").bind(this.EVENTCLICK,function(t){t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}),$("#WBTool_Setting").find("div.WBTool_Close").bind(this.EVENTCLICK,function(t){$("#WBTool_Setting").remove(),o.AfterCloseColorSizeSetting(),t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}),$("#WBTool_Setting").find("span.WBTool_selectsizecontainer").bind(this.EVENTCLICK,function(t){var e=$(t.currentTarget);e.parent().find("span.selected").removeClass("selected"),e.addClass("selected");var i=parseFloat(e.attr("val"));o.AfterSelectSizeSetting(i),t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}),$("#WBTool_Setting").find("div.WBTool_selectsizeinputcontainer").bind(this.EVENTCLICK,function(t){t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}),$("#WBTool_Setting").find("input.WBTool_selectsizeinput").bind(this.EVENTCHANGE,function(t){var e=$(t.currentTarget),i=parseFloat(e.val());$("#WBTool_Setting .WBTool_selectsizespan").text(i),o.AfterSelectSizeSetting(i),t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}),$("#WBTool_Setting").find("span.WBTool_selectcolorcontainer").bind(this.EVENTCLICK,function(t){var e=$(t.currentTarget);e.parent().parent().find("span.selected").removeClass("selected"),e.addClass("selected");var i=e.attr("val");o.AfterSelectColorSetting(i),t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}),$("#WBTool_Setting").find("span.WBTool_selectfontcontainer").bind(this.EVENTCLICK,function(t){var e=$(t.currentTarget);e.parent().parent().find("span.selected").removeClass("selected"),e.addClass("selected");var i=e.attr("val");o.AfterSelectFontSetting(i),t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()})}else $("#WBTool_Setting").remove()},this.AfterSelectSizeSetting=function(t){console.log(this.name+":AfterSelectSizeSetting not done")},this.AfterSelectColorSetting=function(t){console.log(this.name+":AfterSelectSizeSetting not done")},this.AfterSelectFontSetting=function(t){console.log(this.name+":AfterSelectFontSetting not done")},this.AfterCloseColorSizeSetting=function(){console.log(this.name+":AfterCloseColorSizeSetting not done")}}function H(){B.call(this,"ToolPenEx");var t=1,e="#ff0000",i=[0,0],n=[];this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"pencil.cur'),default"})},this.onStart=function(o,r){this.ele=this.CreateEle("path",{isdraw:"true",tp:"line",style:"fill:white;fill-opacity:0;stroke-linecap:round;","stroke-width":t,stroke:e}),this.ele.setAttribute("d","M"+o+","+r),i=[o,r],n=[[o,r]],this.Append(),this.CheckRecordStep(o,r),this.Record()},this.onMove=function(t,e){if(i[0]==t&&i[1]==e)return!0;i=[t,e],n.push([t,e]);var o=this.ele.getAttributeNode("d").nodeValue;return this.ele.setAttribute("d",o+" L"+t+","+e),this.CheckRecordStep(t,e)&&this.Record(),!0},this.onEnd=function(t,e){var i=this.ele.getAttributeNode("d").nodeValue;-1==i.indexOf("L")&&(n.push([t,e]),this.ele.setAttribute("d",i+" L"+i.substr(i.indexOf("M")+1)));var o=this.Record(!0);return this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(o.id),o),n=[],!0},this.Record=function(t){var e=null;return t||0==n.length?e=this.CreateRecordBaseInfo(21,{d:"d",w:"stroke-width",color:"stroke",op:"stroke-opacity"}):((e=this.CreateRecordBaseInfo(22,{w:"stroke-width",color:"stroke",op:"stroke-opacity"})).d=n,n=[]),t&&(e.save=1),e.tar="",this.RecordHandle(e),e},this.SetOption=function(i){i&&(i.Size&&(t=i.Size),i.Color&&(e=i.Color))},this.ShowSetting=function(i,n){this.ShowColorSizeSetting(t,e,i,!1,"",n)},this.AfterSelectSizeSetting=function(e){t=e,this.onToolSetting&&this.onToolSetting({SettingID:5001,Text:e+""})},this.AfterSelectColorSetting=function(t){e=t,this.onToolSetting&&this.onToolSetting({SettingID:5002,Text:t})}}function D(){B.call(this,"ToolDotPan"),this.Record=function(t){return this.CreateRecordBaseInfo(39,{d:"d",w:"stroke-width",color:"stroke",op:"stroke-opacity"})}}function M(){B.call(this,"ToolLine");var t="#ff0000",e=1;this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"line.cur'),default"})},this.onStart=function(i,n){this.ele=this.CreateEle("path",{isdraw:"true",tp:"sline",style:"fill:white;fill-opacity:0;","stroke-width":e,stroke:t}),this.ele.setAttribute("d","M"+i+","+n),this.Append(),this.Record()},this.onMove=function(t,e){var i=this.ele.getAttributeNode("d").nodeValue;return i.indexOf("L")>-1&&(i=i.substr(0,i.indexOf("L")-1)),this.ele.setAttribute("d",i+" L"+t+","+e),this.CheckRecordStep(t,e)&&this.Record(),!0},this.onEnd=function(t,e){var i=this.ele.getAttributeNode("d").nodeValue;-1==i.indexOf("L")&&this.ele.setAttribute("d",i+" L"+i.substr(i.indexOf("M")+1));var n=this.Record(!0);return this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(n.id),n),!0},this.Record=function(t){var e=this.CreateRecordBaseInfo(24,{d:"d",w:"stroke-width",color:"stroke"});return t&&(e.save=1),this.RecordHandle(e),e},this.SetOption=function(i){i&&(i.Size&&(e=i.Size),i.Color&&(t=i.Color))},this.ShowSetting=function(i,n){this.ShowColorSizeSetting(e,t,i,!1,"",n)},this.AfterSelectSizeSetting=function(t){e=t,this.onToolSetting&&this.onToolSetting({SettingID:5003,Text:t+""})},this.AfterSelectColorSetting=function(e){t=e,this.onToolSetting&&this.onToolSetting({SettingID:5004,Text:e})}}function G(){B.call(this,"ToolBrush");var t=6,e="#ffff00",i=[0,0];this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"brush.cur'),default"})},this.onStart=function(n,o){i=[n,o],this.ele=this.CreateEle("path",{isdraw:"true",tp:"brush",style:"fill-opacity:0;stroke-opacity:0.5;stroke-linecap:round;","stroke-width":1+4*t,stroke:e}),this.ele.setAttribute("d","M"+n+","+o),this.Append(),this.Record()},this.onMove=function(n,o){if(i[0]==n&&i[1]==o)return!0;i=[n,o];var r=this.ele.getAttributeNode("d").nodeValue;if(r.length>7870){var s=this.Record(!0);this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(s.id),s),this.ele=this.CreateEle("path",{isdraw:"true",tp:"brush",style:"fill-opacity:0;stroke-opacity:0.5;stroke-linecap:round;","stroke-width":1+4*t,stroke:e}),this.ele.setAttribute("d","M"+this.getLastNode(r)+" L"+n+","+o),this.Append(),this.Record()}else this.ele.setAttribute("d",r+" L"+n+","+o);return this.CheckRecordStep(n,o)&&this.Record(),!0},this.onEnd=function(t,e){var i=this.ele.getAttributeNode("d").nodeValue;-1==i.indexOf("L")&&this.ele.setAttribute("d",i+" L"+i.substr(i.indexOf("M")+1));var n=this.Record(!0);return this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(n.id),n),!0},this.Record=function(t){var e=this.CreateRecordBaseInfo(25,{d:"d",w:"stroke-width",color:"stroke"});return t&&(e.save=1),e.tar="",this.RecordHandle(e),e},this.SetOption=function(i){i&&(i.Size&&(t=i.Size),i.Color&&(e=i.Color))},this.ShowSetting=function(i,n){this.ShowColorSizeSetting(t,e,i,!1,"",n)},this.AfterSelectSizeSetting=function(e){t=e,this.onToolSetting&&this.onToolSetting({SettingID:5005,Text:e+""})},this.AfterSelectColorSetting=function(t){e=t,this.onToolSetting&&this.onToolSetting({SettingID:5006,Text:t})}}function U(){B.call(this,"ToolText");var t=2,e="#ff0000",i="consolas",n=null,o=null;function a(t,e){if("sans-serif"==e)return t>=26?-2:-1;var i=2;if(t>=20)switch(e){case"consolas":i=2;break;case"monospace":i=4;break;case"sans-serif":i=-2;break;case"serif":case"cursive":i=4}else switch(e){case"consolas":i=1;break;case"monospace":i=2;break;case"sans-serif":i=0;break;case"serif":case"cursive":i=2}return i}this.getFontSize=function(){return t<10?"10px":t>40?"40px":t+"px"},this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"text.cur'),text"})},this.onClick=function(t,e){var i=this;if(this.getCanEdit&&0==this.getCanEdit())return!1;this.SetTool("");var n=this.getFontSize(),o=Math.round(1.2*parseFloat(n));this.ele=this.CreateEle("rect",{isdraw:"true",tp:"text",style:"fill:blue;stroke:blue;stroke-width:0;fill-opacity:0;"}),this.ele.setAttribute("x",t),this.ele.setAttribute("y",e),this.ele.setAttribute("width",200),this.ele.setAttribute("height",o),this.Append();var r=this.ele.getAttributeNode("id").nodeValue;this.addNote(t,e,200,o,r);$("#"+r);return $("#"+r+",#g_"+r).bind(this.EVENTCLICK,function(t){i.ToEditMode(r)}),this.Record(),this.ToInputText(r,t,e,200,o),!0},this.onStart=function(t,e){this.ele=this.CreateEle("rect",{isdraw:"true",tp:"text",style:"fill:blue;stroke:blue;stroke-width:1;fill-opacity:0.1;",width:0,height:0}),this.ele.setAttribute("x",t),this.ele.setAttribute("y",e),this.ele.setAttribute("sx",t),this.ele.setAttribute("sy",e),this.Append(),this.Record()},this.onMove=function(t,e){var i=parseInt(this.ele.getAttributeNode("sx").nodeValue),n=parseInt(this.ele.getAttributeNode("sy").nodeValue),o=t-i,r=e-n;return o>=0&&r>=0?(this.ele.setAttribute("width",o),this.ele.setAttribute("height",r)):o<0&&r<0?(this.ele.setAttribute("x",i+o),this.ele.setAttribute("y",n+r),this.ele.setAttribute("width",-o),this.ele.setAttribute("height",-r)):o>=0&&r<0?(this.ele.setAttribute("y",n+r),this.ele.setAttribute("width",o),this.ele.setAttribute("height",-r)):o<0&&r>=0&&(this.ele.setAttribute("x",i+o),this.ele.setAttribute("width",-o),this.ele.setAttribute("height",r)),!0},this.onEnd=function(t,e){var i=this;this.ele.setAttribute("style","fill:blue;stroke:blue;stroke-width:0;fill-opacity:0;");t=parseInt(this.ele.getAttributeNode("x").nodeValue),e=parseInt(this.ele.getAttributeNode("y").nodeValue);var n=parseInt(this.ele.getAttributeNode("width").nodeValue),o=parseInt(this.ele.getAttributeNode("height").nodeValue),r=this.getFontSize(),s=Math.round(1.2*parseFloat(r));if(n<20&&o<20)return $(this.ele).remove(),!1;var a=this.ele.getAttributeNode("id").nodeValue;this.addNote(t,e,n,s,a);$("#"+a);return $("#"+a+",#g_"+a).bind(this.EVENTCLICK,function(t){i.ToEditMode(a)}),this.SetTool(""),this.Record(),this.ToInputText(a,t,e,n,s),!0},this.SaveInputText=function(t){var e=this.Record(!0,!1),i=$("#textarea-"+t).css("font-size").replace("px",""),n=$("#textarea-"+t).val();if(""==s(n))return $("#edit_"+t).remove(),$("#g_"+t+",#"+t).show(),void this.Delete();var o=this.SplitTextEx(n,$("#textarea-"+t).width(),parseFloat(i),$("#textarea-"+t).css("font-family"));this.SaveText(o,t),$("#edit_"+t).remove(),$("#g_"+t+",#"+t).show();var r=this.Record(!0);null!=e&&(this.onRecordHistory(e,r),e=null),this.SetActiveTool(null)},this.ToInputText=function(t,e,i,n,s){var a=this;$("#g_"+t+",#"+t).hide();var l=$("#g_"+t).find("text"),d=parseFloat(l.prop("style").fontSize.replace("px","")),h=l.css("fill"),c=l.css("font-family"),p=Math.round(1.2*parseFloat(d)),u=l.find("tspan").text(),g="<div id='edit_"+t+"' tabindex='21' style='position: absolute;background-color:white;border:dashed 2px #7d7b7b;touch-action: none;padding:1px; z-index:100; box-sizing:border-box; top: "+(i-3)+"px; left: "+(e-3)+"px; width: "+(n+6)+"px;'>";g+="<textarea id='textarea-"+t+"' rows='1' placeholder='input text...' style='outline: none;overflow: hidden;resize: none;width:100%;box-sizing:border-box;font-family: "+c+";color:"+h+";font-size:"+d+"px;line-height:"+p+"px;border:0px;'>"+u+"</textarea>",g+="</div>",this.container.append(g);var v=this.SplitTextEx($("#textarea-"+t).val(),$("#textarea-"+t).width(),parseFloat(d),c);r("textarea-"+t).rows=Math.max(v.length,1),$("#textarea-"+t).focus(),function(t){t.focus();var e=t.value.length;if(document.selection){var i=t.createTextRange();i.moveStart("character",e),i.collapse(),i.select()}else"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&(t.selectionStart=t.selectionEnd=e)}(r("textarea-"+t));var f=0,y=0,x=this;$("#textarea-"+t).bind("input",function(){try{(y=r("textarea-"+t).value.length)<f&&(r("textarea-"+t).rows=Math.max(r("textarea-"+t).rows-1,1)),f=y,r("textarea-"+t).scrollHeight>r("textarea-"+t).clientHeight?r("textarea-"+t).rows+=1:r("textarea-"+t).scrollHeight<r("textarea-"+t).clientHeight&&(r("textarea-"+t).rows-=1)}catch(t){console.log(t)}}).bind("blur",function(){o&&clearTimeout(o),o=setTimeout(function(){a.SaveInputText(t)},300)}).bind("focus",function(){o&&clearTimeout(o)}).bind("select",function(){x.ShowSetting(!0)}),this.SetActiveTool(this),this.ShowSetting(!0)},this.ToEditMode=function(i){var o=this;if(this.getCanEdit&&0==this.getCanEdit())return!1;var s=$("#g_"+i),l=$("#g_"+i).find("text"),d=$("#"+i),h=parseInt(d.attr("x")),c=parseInt(d.attr("y")),p=parseInt(d.attr("width")),u=(parseInt(d.attr("height")),parseFloat(l.prop("style").fontSize.replace("px",""))),g=l.css("fill"),v=l.css("font-family");!function(i,n){switch(t=i<10?10:i>40?40:i,n){case"rgb(149, 226, 124)":e="#95e27c"}var o=/rgb\((\d*),\s?(\d*),\s(\d*)\)/gi.exec(n);e=o.length>=4?"#"+("0"==o[1]?"00":parseInt(o[1]).toString(16))+("0"==o[2]?"00":parseInt(o[2]).toString(16))+("0"==o[3]?"00":parseInt(o[3]).toString(16)):n}(u,g);var f=Math.round(1.2*u),y=l.find("tspan").text().replace(/\n/gi,"<br>").replace(/\r\n/gi,"<br>"),x="<div id='move_"+i+"' tabindex='21' style='position: absolute;border:solid 2px blue;touch-action: none;background-color: white;padding:1px; z-index:100; box-sizing:border-box; top: "+(c-3)+"px; left: "+(h-3)+"px; width: "+(p+6)+"px;'>";x+="<div "+this.EVENTRESIZE+"=\"Resize(document.getElementById('move_"+i+"'), event, 'w', 80, 80);\" style='position: absolute;cursor:w-resize;left: -5px;top: calc(50% - 4px);background-color: blue;width: 8px;height: 8px;padding:0px;border:0px;display: inline-block;border-radius: 50%;'></div>",x+=" <div "+this.EVENTRESIZE+"=\"Resize(document.getElementById('move_"+i+"'), event, 'e', 80, 80);\" style='position: absolute;cursor:e-resize;right: -5px;top: calc(50% - 4px);background-color: blue;width: 8px;height: 8px;padding:0px;border:0px;display: inline-block;border-radius: 50%;'></div>",x+="<div id='text_"+i+"' style='cursor:move;text-align:left;width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;font-family: "+v+";color:"+g+";font-size:"+u+"px;line-height:"+f+"px;border:0px;'>"+y+"</div>",x+="</div>",this.container.append(x),d.hide(),$("#g_"+i).hide();var b=r("move_"+i);Drag.init(r("text_"+i),b,5,null,5,null);var w=null,C=!1;b.onDrag=function(){C=!0,null==w&&(w=o.Record(!0,!1))},b.onDragEnd=function(){var t=parseInt(b.style.left)+3,e=parseInt(b.style.top)+3;d.attr("x",t),d.attr("y",e),l.attr("x",t),l.attr("y",e);var i=parseFloat(l.prop("style").fontSize.replace("px","")),n=l.css("font-family"),r=a(i,n),h=Math.round(1.2*i);s.find("tspan").each(function(n){$(this).attr("x",t-.5),$(this).attr("y",e+i-r+h*n)});var c=o.Record(!0);null!=w&&(o.onRecordHistory(w,c),w=null)},b.onSizeChanging=function(){C=!0,null==w&&(w=o.Record(!0,!1))},b.onSizeChanged=function(){var t=parseInt(b.style.left)+3,e=parseInt(b.style.top)+3,n=parseInt(b.style.width)-6,r=$("#text_"+i).height();d.attr("x",t),d.attr("y",e),d.attr("width",n),d.attr("height",r),l.attr("x",t),l.attr("y",e);var s=$("#text_"+i).css("font-size").replace("px",""),a=$("#text_"+i).css("font-family"),h=$("#text_"+i).html().replace(/<br>/gi,"\n").replace(/<br \/>/gi,"\n"),c=o.SplitTextEx(h,$("#text_"+i).width(),parseFloat(s),a);o.SaveText(c,i);var p=o.Record(!0);null!=w&&(o.onRecordHistory(w,p),w=null)};var S=function(){$("#move_"+i).remove(),$("#g_"+i+",#"+i).show(),o.SetActiveTool(null),o.ShowSetting(!1)};$(b).bind("blur",function(){n&&clearTimeout(n),n=setTimeout(S,300)}).bind("focus",function(){n&&clearTimeout(n)}).bind(this.EVENTCLICK,function(){if(0==C){$("#move_"+i).remove();var t=parseInt(b.style.left)+3,e=parseInt(b.style.top)+3,n=$(b).width()-6,r=$(b).height()-6;o.ToInputText(i,t,e,n,r)}C=!1}),$(b).focus(),this.SetActiveTool(this)},this.SaveText=function(t,e){var i=$("#g_"+e).find("text"),n=$("#"+e);i.html("");var o=i.attr("x"),r=i.attr("y"),s=parseFloat(i.prop("style").fontSize.replace("px","")),l=a(s,i.css("font-family")),d=Math.round(1.2*s);n[0].setAttribute("height",d*t.length);for(var h=0;h<t.length;h++){var c=this.CreateEle("tspan");c.setAttribute("x",parseInt(o,10)-.5),c.setAttribute("y",parseInt(r,10)+s-l+d*h),c.innerHTML=t[h],i.append(c)}},this.SaveColor=function(t){var e=this.Record(!0,!1),i=$(this.ele).attr("id");$("#g_"+i).find("text").css("fill",t),$("#text_"+i).css("color",t);var n=this.Record(!0);this.onRecordHistory(e,n)},this.SaveSize=function(t){var e=this.Record(!0,!1),i=$(this.ele).attr("id"),n=$("#g_"+i).find("text"),o=this.getFontSize();n.css("font-size",o);var r=parseFloat(o.replace("px","")),s=n.css("font-family"),a=Math.round(1.2*r);$("#text_"+i).css({"font-size":o,"line-height":a+"px"});var l=n.find("tspan").text(),d=this.SplitTextEx(l,$("#"+i).width(),r,s);this.SaveText(d,i);var h=this.Record(!0);null!=e&&(this.onRecordHistory(e,h),e=null)},this.SaveFont=function(t){var e=this.Record(!0,!1),i=$(this.ele).attr("id"),n=$("#g_"+i).find("text"),o=this.getFontSize();n.css("font-family",t);var r=parseFloat(o.replace("px",""));Math.round(1.2*r);$("#text_"+i).css({"font-family":t});var s=n.find("tspan").text(),a=this.SplitTextEx(s,$("#"+i).width(),r,t);this.SaveText(a,i);var l=this.Record(!0);null!=e&&(this.onRecordHistory(e,l),e=null)},this.Delete=function(){if(this.SetActiveTool(null),!this.ele)return!1;var t=this.Record(!0,!1);if(this.onRecordHistory){var e=new Array;e.push(this.RecordHistory_delete(t.id)),e.push(this.RecordHistory_delete("g_"+t.id)),this.onRecordHistory(t,e)}var i=this.ele.id;return this.Record_delete(i),this.Record_delete("g_"+i),$("#"+i).remove(),$("#edit_"+i).remove(),$("#g_"+i).remove(),$("#editnote").hide(),!0},this.addNote=function(t,n,o,r,s){var a=this.CreateEle("g",{isdraw:"true",id:"g_"+s});this.target.append(a);var l=this.CreateEle("text",{x:t,y:n,style:"fill:"+e+";font-size:"+this.getFontSize()+";font-family:"+i+";"});l.innerHTML="",a.appendChild(l)},this.EditText=function(t,e){var i=this,n=12;0!=this.deviceType&&(n=25);var o=$("#g_"+$(t).attr("id")).find("text"),r=$(t),a=parseInt(r.attr("x")),l=parseInt(r.attr("y")),d=parseInt(r.attr("width")),h=parseInt(r.attr("height")),c='<div id="editnote" style="position:absolute; left:10px; top:10px; float:left; z-index:201;">\n        <div class="editnotemenu" style="background-color:black;border-radius:5px; color:white; height:24px;">\n          <ul>\n            <li id="editnote_delete">'+this.Text.Delete+'</li>\n            <li id="editnote_edit">'+this.Text.Edit+'</li>\n          </ul>\n        </div>\n        <div style="padding:8px 0px 0px 20px; text-align:left;">\n          <span style="width:0;height:0;border-left: 5px solid transparent;border-right: 5px solid transparent;border-top: 10px solid black;"></span>\n        </div>\n      </div>';$("#editnote").length>0&&$("#editnote").remove(),this.main.append(c),$("#editnote").attr("tar",t.attr("id")).attr("tp","text").css({left:a-this._drawGetLeft()+"px",top:l-this._drawGetTop()-50+this.main.scrollTop()+"px"}).show();var p="<div id='edit_"+$(t).attr("ID")+"' tabindex='21' style='position: absolute;touch-action: none; z-index:100; box-sizing:border-box; top: "+(l-n)+"px; left: "+(a-n)+"px; width: "+(d+2*n)+"px; height: "+(h+2*n)+"px; '><table style='width:100%;height:100%;' cellspacing='0' cellpadding='0' border='0'><tr style='height:"+n+"px;'><td "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'nw', 80, 80);\" style='width:"+n+"px;' class='resizebg_nw'></td><td></td><td style='width:"+n+"px;' class='resizebg_ne' "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'ne', 80, 80);\"></td></tr><tr><td></td><td style='height:100%;'><div style=\"cursor:move;width:100%;height:100%;border:1px solid #FFC107; text-align:left; padding:0px 0px 0px 2px;background-color:white;box-sizing:border-box;word-break:break-all; font-size:14px;font-family: 'Consolas';\" class='container'>";p+=o.text().replace(/\r\n/gi,"<br />").replace(/\n/gi,"<br />"),p+="</div>",p+="</td><td></td></tr><tr style='height:"+n+"px;'><td "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'sw', 80, 80);\" style='width:"+n+"px;' class='resizebg_sw'></td><td></td><td style='width:"+n+"px;' class='resizebg_se' "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'se', 80, 80);\"></td></tr><table></div></div>",this.container.append(p);var u=$("#edit_"+$(t).attr("ID"));Drag.init(u.find("div.container")[0],u[0],-n,null,-n,null);var g=null;u[0].onDrag=function(){null==g&&(g=i.Record(!0,!1)),$("#editnote").hide();var t=parseInt(u[0].style.left)+n,e=parseInt(u[0].style.top)+n,o=parseInt(u[0].style.width)-2*n,s=parseInt(u[0].style.height)-2*n;r.attr("x",t),r.attr("y",e),r.attr("width",o),r.attr("height",s)},u[0].onDragEnd=function(){var t=parseInt(u[0].style.left)+n,e=parseInt(u[0].style.top)+n,s=parseInt(u[0].style.width)-2*n,a=parseInt(u[0].style.height)-2*n;r.attr("x",t),r.attr("y",e),r.attr("width",s),r.attr("height",a),o.attr("x",t+1),o.attr("y",e+1),o.find("tspan").each(function(i){$(this).attr("x",t+1),$(this).attr("y",e+10+20*i)}),$("#editnote").css({left:t-i._drawGetLeft()+"px",top:e-50-i._drawGetTop()+i.main.scrollTop()+"px"}).show();var l=i.Record(!0);null!=g&&(i.onRecordHistory(g,l),g=null)},u[0].onSizeChange=function(){null==g&&(g=i.Record(!0,!1)),$("#editnote").hide(),h=parseInt(u[0].style.height),u.find("div.editor").height(h-43)},u[0].onSizeChanged=function(){null==g&&(g=i.Record(!0,!1)),$("#editnote").hide();var e=parseInt(u[0].style.left),o=parseInt(u[0].style.top),s=parseInt(u[0].style.width),a=parseInt(u[0].style.height);r.attr("x",e+n),r.attr("y",o+n),r.attr("width",s-2*n),r.attr("height",a-2*n),$("#editnote").css({left:e+n-i._drawGetLeft()+"px",top:o+n-50-i._drawGetTop()+i.main.scrollTop()+"px"}).show(),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")));var l=i.Record(!0);null!=g&&(i.onRecordHistory(g,l),g=null)},$("#g_"+$(t).attr("id")).hide(),$(t).hide();var v=function(){var e=o.text();if(""!=s(e)){a=r.attr("x"),l=r.attr("y");var n=parseInt(r.attr("width")),d=i.SplitText(e,n);o.html("");for(var h=0;h<d.length;h++){var c=i.CreateEle("tspan");c.setAttribute("x",parseInt(a,10)+1),c.setAttribute("y",parseInt(l,10)+10+20*h),c.innerHTML=d[h],o.append(c)}u.remove(),t.show(),$("#g_"+$(t).attr("id")).show(),$("#editnote").hide();i.Record(!0);i.SetActiveTool(null)}else f()},f=function(){var e=i.Record(!0,!1);if(i.onRecordHistory){var n=new Array;n.push(i.RecordHistory_delete(e.id)),n.push(i.RecordHistory_delete("g_"+e.id)),i.onRecordHistory(e,n)}x&&clearTimeout(x),i.Record_delete($(t).attr("id")),i.Record_delete("g_"+$(t).attr("id")),u.remove(),t.remove(),$("#g_"+$(t).attr("id")).remove(),$("#editnote").hide(),i.SetActiveTool(null)},y=function(t){var e=i.Record(!0,!1);$("#editnotetext").hide();var n=$("#editnote_content").val(),o=$("#editnote").attr("tar"),r=($("#editnote").attr("tp"),$("#"+o)),s=parseInt(r.attr("width")),a=i.SplitText(n,s),l=$("#g_"+o).find("text"),d=l.attr("x"),h=l.attr("y");l.html("");for(var c=0;c<a.length;c++){var p=i.CreateEle("tspan");p.setAttribute("x",parseInt(d,10)+5),p.setAttribute("y",parseInt(h,10)+5+20*c),p.innerHTML=a[c],l.append(p)}var u=i.Record(!0);i.onRecordHistory(e,u),$("#editnotetext").remove(),i.SetActiveTool(null)},x=null;u.bind("blur",function(){x&&clearTimeout(x),x=setTimeout(v,300)}).bind("focus",function(){x&&clearTimeout(x)}),$("#editnote").unbind().bind("click",function(e){switch($(e.originalEvent.target).attr("id")){case"editnote_delete":f();break;case"editnote_edit":!function(e){x&&clearTimeout(x),u.remove(),t.show(),$("#g_"+$(t).attr("id")).show(),$("#editnote").hide();var n='<div id="editnotetext" tabindex="51" style="position:absolute; z-index:20000; left:0px; top:0px; width:500px; height:400px; padding:2px; background-color:white; border:solid 1px #000;">\n                <div style="width:100%; height:100%;">\n                <div style="height:40px; width:100%; text-align:left;">\n                    <span style="border:1px solid #ccc;border-radius: 4px;cursor:pointer;display:inline-block;padding:5px;" id="btnCancelNote">'+i.Text.Cancel+'</span>\n                    <span style=" float:right;border:1px solid #ccc;border-radius:4px;cursor:pointer;display:inline-block;padding:5px;" id="btnSaveNote">'+i.Text.Save+'</span>\n                </div>\n                <div style="width:100%;">\n                    <textarea style="width:100%; height:360px;resize:none;overflow-y:auto;font-family: \'Consolas\';" rows="10" id="editnote_content"></textarea>\n                </div>\n                </div>\n            </div>';$("#editnotetext").length>0&&$("#editnotetext").remove(),i.main.append(n);var r=a,s=-i._drawGetTop()+l;r=Math.max(0,r),s=Math.max(0,s),r=Math.min(i.getViewWidth()-510,r),s=Math.min(i.getViewHeight()-410,s),$("#editnotetext").show().css({left:r+"px",top:s+"px"}),0!=i.deviceType&&$("#editnotetext").css({left:"0px",top:"0px",width:"calc(100% - 8px)",height:"100%"}),$("#editnote_content").val(o.text()).focus(),$("#btnSaveNote").bind(i.EVENTCLICK,y),$("#btnCancelNote").bind(i.EVENTCLICK,function(t){$("#editnotetext").remove()}),i.SetActiveTool(null)}();break;case"editnote_color":case"editnote_fontsize":break;default:x&&clearTimeout(x)}}),u.focus(),this.SetActiveTool(this)},this.Record=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.CreateRecordBaseInfo(28,{x:"x",y:"y",width:"width",height:"height"});if(r("g_"+i.id)){var n=$("#g_"+i.id),o=n.find("text");i.Rect=new Object,i.Rect.x=parseInt(o.attr("x")),i.Rect.y=parseInt(o.attr("y")),i.Rect.text=h(p(n.find("text").text())),i.Rect.color=n.find("text").css("fill"),i.Rect.size=parseFloat(n.find(">text").prop("style").fontSize.replace("px","")),i.Rect.font=n.find("text").css("font-family")}return t&&(i.save=1),i.tar="",e&&this.RecordHandle(i),i},this.SetOption=function(n){n&&(n.Size&&(t=n.Size),n.Color&&(e=n.Color),n.Font&&(i=n.Font))},this.ShowSetting=function(n,o){this.ShowColorSizeSetting(t,e,n,!1,i,o)},this.SetActive=function(){if(n&&clearTimeout(n),n=null,o&&(clearTimeout(o),o=null,this.ele)){var t=$(this.ele).attr("id");$("#edit_"+t).length>0&&(this.SaveInputText(t),this.ToEditMode(t))}$("#move_"+$(this.ele).attr("id")).focus()},this.AfterSelectSizeSetting=function(e){t=e,this.ele&&(this.SetActive(),this.SaveSize(e)),this.onToolSetting&&this.onToolSetting({SettingID:5007,Text:e+""})},this.AfterSelectColorSetting=function(t){e=t,this.ele&&(this.SetActive(),this.SaveColor(t)),this.onToolSetting&&this.onToolSetting({SettingID:5008,Text:t})},this.AfterSelectFontSetting=function(t){i=t,this.ele&&(this.SetActive(),this.SaveFont(t)),this.onToolSetting&&this.onToolSetting({SettingID:5009,Text:t})}}function j(){B.call(this,"ToolNote");var t=14,e="#000000",i="consolas",n=null,o=null;this.getFontSize=function(){return t<10?"10px":t>40?"40px":t+"px"},this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"note.cur'), default"})},this.onClick=function(t,e){var i=this;this.SetTool("");var n=this.getFontSize();Math.round(1.2*parseFloat(n));this.ele=this.CreateEle("image",{isdraw:"true",tp:"note",href:this.ImagePath+"note-mark2.svg"}),this.ele.setAttribute("x",t-12),this.ele.setAttribute("y",e-12),this.ele.setAttribute("width",24),this.ele.setAttribute("height",24),this.Append();var o=this.ele.getAttributeNode("id").nodeValue;$("#"+o).hide(),this.addNote(t-12,e-12,24,24,o);var r=$("#g_"+o);$("#"+o).bind(this.EVENTCLICK,function(t){$("#g_"+o).show(),$("#"+o).hide(),i.Record(!0),i.SetTool("")}),$("#"+o).on("STRINK",function(t){0==$("#edit_"+o).length&&($("#g_"+o).hide(),$("#"+o).show(),i.Record(!0)),i.SetTool("")}),$(r).bind(this.EVENTCLICK,function(t){i.EditAnnotation(r,!1)});var s=this.Record(!0);return this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(s.id),s),this.EditAnnotation($("#g_"+o),!0),this.SetTool(""),!0},this.onStart=function(t,e){},this.onMove=function(t,e){},this.onEnd=function(t,e){},this.Delete=function(){if(this.SetActiveTool(null),!this.ele)return!1;var t=this.Record(!0,!1);this.onRecordHistory&&this.onRecordHistory(t,this.RecordHistory_delete(t.id));var e=this.ele.id;return this.Record_delete(e),$("#"+e).remove(),$("#orp_"+e).remove(),$("#or_"+e).remove(),$("#g_"+e).remove(),$("#eidt_"+e).remove(),$("#editnote").hide(),!0},this.addNote=function(t,n,o,r,s){var a,l,d,h,c=0,p=0,u=this.getContainerWidth();n-0>=270?(t+o/2-0>u/2?((c=t+o-0-200)<10&&(c=10),p=n-120-50):((c=t+o/2)+200+10>u&&(c=u-200-10),p=n-120-50),d=c+100,h=p+120,a=t+o/2,l=n):(t+o/2-0>u/2?((c=t+o-0-200)<10&&(c=10),p=n+r+50):((c=t+o/2)+200+10>u&&(c=u-200-10),p=n+r+50),d=c+100,h=p,a=t+o/2,l=n+r);var g=this.CreateEle("g");g.setAttribute("id","g_"+s),g.setAttribute("isdraw","true"),g.setAttribute("tp","note"),this.target.append(g);var v=this.CreateEle("rect");v.setAttribute("style","fill:white;stroke:#FFC107;stroke-width:1;fill-opacity:0.9;"),v.setAttribute("x",c),v.setAttribute("y",p),v.setAttribute("width",200),v.setAttribute("height",120),g.appendChild(v);var f=this.CreateEle("text");f.setAttribute("x",c),f.setAttribute("y",p),f.setAttribute("style","fill:"+e+";font-size:"+this.getFontSize()+";font-family:"+i+";"),f.innerHTML="",g.appendChild(f);for(var y=this.SplitText("",200),x=0;x<y.length;x++){var b=this.CreateEle("tspan");b.setAttribute("x",c),b.setAttribute("y",p+20*x),b.innerHTML=y[x],f.appendChild(b)}var w=this.CreateEle("line");w.setAttribute("x1",a),w.setAttribute("y1",l),w.setAttribute("x2",d),w.setAttribute("y2",h),w.setAttribute("style","stroke-width:1; stroke:#FFC107;"),g.appendChild(w);var C=this.CreateEle("circle");C.setAttribute("cx",a),C.setAttribute("cy",l),C.setAttribute("r",5),C.setAttribute("fill","#FFC107"),g.appendChild(C)},this.ToInputText=function(t,e,i,n,s){var a=this;$("#g_"+t).find("rect").hide();var l=$("#g_"+t).find("text"),d=parseFloat(l.prop("style").fontSize.replace("px","")),h=l.css("fill"),c=l.css("font-family"),p=Math.round(1.2*parseFloat(d)),u=l.find("tspan").text(),g="<div id='edit_"+t+"' tabindex='21' style='position: absolute;background-color:white;border:dashed 2px #7d7b7b;touch-action: none;padding:1px; z-index:100; box-sizing:border-box; top: "+(i-0)+"px; left: "+(e-0)+"px; width: "+(n+6)+"px;height: "+(s+6)+"px;'>";g+="<textarea id='textarea-"+t+"' placeholder='input text...' style='outline: none;overflow: hidden;resize: none;width:100%;height:100%;box-sizing:border-box;font-family: "+c+";color:"+h+";font-size:"+d+"px;line-height:"+p+"px;border:0px;'>"+u+"</textarea>",g+="</div>",this.container.append(g);this.SplitTextEx($("#textarea-"+t).val(),$("#textarea-"+t).width(),parseFloat(d),c);$("#textarea-"+t).focus(),function(t){t.focus();var e=t.value.length;if(document.selection){var i=t.createTextRange();i.moveStart("character",e),i.collapse(),i.select()}else"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&(t.selectionStart=t.selectionEnd=e)}(r("textarea-"+t));var v=this;$("#textarea-"+t).bind("input",function(){}).bind("blur",function(){o&&clearTimeout(o),o=setTimeout(function(){a.SaveInputText(t)},300)}).bind("focus",function(){o&&clearTimeout(o)}).bind("select",function(){v.ShowSetting(!0)}),this.SetActiveTool(this),this.ShowSetting(!0)},this.SaveInputText=function(t){if(0==$("#textarea-"+t).length)return this.SetActiveTool(null),$("#edit_"+t).remove(),void $("#g_"+t).find("rect").show();var e=this.Record(!0,!1),i=$("#textarea-"+t).css("font-size").replace("px",""),n=$("#textarea-"+t).val(),o=this.SplitTextEx(n,$("#textarea-"+t).width(),parseFloat(i),$("#textarea-"+t).css("font-family"));this.SaveText(o,t),$("#edit_"+t).remove(),$("#g_"+t).find("rect,circle").show(),$("#"+t).hide();var r=this.Record(!0);null!=e&&(this.onRecordHistory(e,r),e=null),this.SetActiveTool(null)},this.SaveText=function(t,e){var i=$("#g_"+e).find("text"),n=$("#g_"+e).find("rect");i.html("");var o=i.attr("x"),r=i.attr("y"),s=parseFloat(i.prop("style").fontSize.replace("px","")),a=function(t,e){if("sans-serif"==e)return t>=26?-2:-1;var i=2;if(t>=20)switch(e){case"consolas":i=2;break;case"monospace":i=4;break;case"sans-serif":i=-2;break;case"serif":case"cursive":i=4}else switch(e){case"consolas":i=1;break;case"monospace":i=2;break;case"sans-serif":i=0;break;case"serif":case"cursive":i=2}return i}(s,i.css("font-family")),l=Math.round(1.2*s);n.height()<l*t.length&&(n[0].setAttribute("height",l*t.length),$("#edit_"+e).length>0&&$("#edit_"+e).height(l*t.length));for(var d=0;d<t.length;d++){var h=this.CreateEle("tspan");h.setAttribute("x",parseInt(o,10)+2),h.setAttribute("y",parseInt(r,10)+2+s-a+l*d),h.innerHTML=t[d],i.append(h)}},this.SaveColor=function(t){var e=this.Record(!0,!1),i=$(this.ele).attr("id");$("#g_"+i).find("text").css("fill",t),$("#text_"+i).css("color",t);var n=this.Record(!0);this.onRecordHistory(e,n)},this.SaveSize=function(t){var e=this.Record(!0,!1),i=$(this.ele).attr("id"),n=$("#g_"+i).find("text"),o=this.getFontSize();n.css("font-size",o);var r=parseFloat(o.replace("px","")),s=n.css("font-family"),a=Math.round(1.2*r);$("#text_"+i).css({"font-size":o,"line-height":a+"px"});var l=n.find("tspan").text(),d=this.SplitTextEx(l,$("#g_"+i).find("rect").width(),r,s);this.SaveText(d,i);var h=this.Record(!0);null!=e&&(this.onRecordHistory(e,h),e=null)},this.SaveFont=function(t){var e=this.Record(!0,!1),i=$(this.ele).attr("id"),n=$("#g_"+i).find("text"),o=this.getFontSize();n.css("font-family",t);var r=parseFloat(o.replace("px",""));Math.round(1.2*r);$("#text_"+i).css({"font-family":t});var s=n.find("tspan").text(),a=this.SplitTextEx(s,$("#g_"+i).find("rect").width(),r,t);this.SaveText(a,i);var l=this.Record(!0);null!=e&&(this.onRecordHistory(e,l),e=null)},this.EditAnnotation=function(i,o){var s=this,a=$(i).find("rect"),l=$(i).find("text"),d=$(i).attr("ID").replace("g_",""),h=parseInt(a.attr("x")),c=parseInt(a.attr("y")),p=parseInt(a.attr("width")),u=parseInt(a.attr("height")),g=parseFloat(l.prop("style").fontSize.replace("px","")),v=l.css("fill"),f=l.css("font-family");!function(i,n){switch(t=i<10?10:i>40?40:i,n){case"rgb(149, 226, 124)":e="#95e27c"}var o=/rgb\((\d*),\s?(\d*),\s(\d*)\)/gi.exec(n);e=o.length>=4?"#"+("0"==o[1]?"00":parseInt(o[1]).toString(16))+("0"==o[2]?"00":parseInt(o[2]).toString(16))+("0"==o[3]?"00":parseInt(o[3]).toString(16)):n}(g,v);var y=Math.round(1.2*g),x=l.find("tspan").text().replace(/\n/gi,"<br>").replace(/\r\n/gi,"<br>"),b="<div id='edit_"+d+"' tabindex='21' style='position: absolute;border:solid 2px #FFC107;touch-action: none;background-color: white;padding:1px; z-index:100; box-sizing:border-box; top: "+(c-2)+"px; left: "+(h-2)+"px; width: "+(p+4)+"px;height: "+(u+4)+"px;'>";b+="<div "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+d+"'), event, 'nw', 40, 40);\" style='position: absolute;cursor:nw-resize;left: -4px;top: -4px;background-color: #FFC107;width: 6px;height: 6px;padding:0px;border:0px;display: inline-block;border-radius: 50%;'></div>",b+="<div "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+d+"'), event, 'ne', 40, 40);\" style='position: absolute;cursor:ne-resize;right: -4px;top:-4px;background-color: #FFC107;width: 6px;height: 6px;padding:0px;border:0px;display: inline-block;border-radius: 50%;'></div>",b+="<div "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+d+"'), event, 'se', 40, 40);\" style='position: absolute;cursor:se-resize;right: -4px;top: calc(100% - 2px);background-color: #FFC107;width: 6px;height: 6px;padding:0px;border:0px;display: inline-block;border-radius: 50%;'></div>",b+=" <div "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+d+"'), event, 'sw', 40, 40);\" style='position: absolute;cursor:sw-resize;left: -4px;top: calc(100% - 2px);background-color: #FFC107;width: 6px;height: 6px;padding:0px;border:0px;display: inline-block;border-radius: 50%;'></div>",b+="<div id='text_"+d+"' style='cursor:move;text-align:left;width:100%;height:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;font-family: "+f+";color:"+v+";font-size:"+g+"px;line-height:"+y+"px;border:0px;'>"+x+"</div>",b+="</div>",this.container.append(b);var w=$("#edit_"+d),C=!1;Drag.init(r("text_"+d),r("edit_"+d),-2,null,-2,null);var S=null;w[0].onDrag=function(){C=!0,null==S&&(S=s.Record(!0,!1)),$("#editnote").hide();var t=parseInt(w[0].style.left)+2,e=parseInt(w[0].style.top)+2,n=parseInt(w[0].style.width)-4,o=parseInt(w[0].style.height)-4;a.attr("x",t),a.attr("y",e),a.attr("width",n),a.attr("height",o),s.ShowArrow($("#"+$(i).attr("ID").replace("g_","")))},w[0].onDragEnd=function(){var t=parseInt(w[0].style.left)+2,e=parseInt(w[0].style.top)+2,n=parseInt(w[0].style.width)-4,o=parseInt(w[0].style.height)-4;if(a.attr("x",t),a.attr("y",e),a.attr("width",n),a.attr("height",o),l.attr("x",t),l.attr("y",e),0!=$("#text_"+d).length){var r=$("#text_"+d).css("font-size").replace("px",""),h=$("#text_"+d).css("font-family"),c=$("#text_"+d).html().replace(/<br>/gi,"\n").replace(/<br \/>/gi,"\n"),p=s.SplitTextEx(c,$("#text_"+d).width(),parseFloat(r),h);s.SaveText(p,d),s.ShowArrow($("#"+$(i).attr("ID").replace("g_","")));var u=s.Record(!0);null!=S&&(s.onRecordHistory(S,u),S=null)}},w[0].onSizeChange=function(){C=!0,null==S&&(S=s.Record(!0,!1)),$("#editnote").hide(),u=parseInt(w[0].style.height),w.find("div.editor").height(u-43)},w[0].onSizeChanged=function(){C=!0,null==S&&(S=s.Record(!0,!1)),$("#editnote").hide();var t=parseInt(w[0].style.left),e=parseInt(w[0].style.top),n=parseInt(w[0].style.width),o=parseInt(w[0].style.height);a.attr("x",t+2),a.attr("y",e+2),a.attr("width",n-4),a.attr("height",o-4),l.attr("x",t+2),l.attr("y",e+2);var r=$("#text_"+d).css("font-size").replace("px",""),h=$("#text_"+d).css("font-family"),c=$("#text_"+d).html().replace(/<br>/gi,"\n").replace(/<br \/>/gi,"\n"),p=s.SplitTextEx(c,$("#text_"+d).width(),parseFloat(r),h);s.SaveText(p,d),s.ShowArrow($("#"+$(i).attr("ID").replace("g_","")));var u=s.Record(!0);null!=S&&(s.onRecordHistory(S,u),S=null)};w.find("#cancel").bind(this.EVENTCLICK,function(){w.remove(),$(i).find("rect,text,circle").show()}),$(i).find("rect,text,circle").hide();var m=$("#"+$(i).attr("ID").replace("g_","")),T=m.attr("x"),A=m.attr("y"),E=parseInt(m.attr("width")),_=parseInt(m.attr("height")),R="<div id='orp_"+d+"' tabindex='21' style='position: absolute;border:solid 1px #FFC107;touch-action: none;background-color: transparent;padding:1px; z-index:100; box-sizing:border-box; top: "+(A-2)+"px; left: "+(T-2)+"px; width: "+(E+4)+"px;height: "+(_+4)+"px;'>";R+="<img src='"+this.ImagePath+"note-mark2.svg'  height='100%' width='100%'></img>",R+="<div id='or_"+d+"' style='position: absolute; left: 0; top: 0; opacity: 0; cursor:move;text-align:left;width:100%;height:100%;box-sizing:border-box;border:0px;background-color:#FFC107;'></div>",R+="</div>",this.container.append(R);var P=$("#or_"+$(m).attr("ID")),I=$("#orp_"+$(m).attr("ID"));Drag.init(P[0],I[0],-2,null,-2,null);var k=null;I[0].onSizeChange=function(){null==k&&(k=s.Record(!0,!1))},I[0].onSizeChanged=function(){null==k&&(k=s.Record(!0,!1));var t=parseInt(I[0].style.left),e=parseInt(I[0].style.top),n=parseInt(I[0].style.width),o=parseInt(I[0].style.height);m.attr("x",t+2),m.attr("y",e+2),m.attr("width",n-4),m.attr("height",o-4),s.ShowArrow($("#"+$(i).attr("ID").replace("g_","")));var r=s.Record(!0);null!=k&&(s.onRecordHistory(k,r),k=null)},I[0].onDrag=function(){null==k&&(k=s.Record(!0,!1));var t=parseInt(I[0].style.left)+2,e=parseInt(I[0].style.top)+2,n=parseInt(I[0].style.width)-4,o=parseInt(I[0].style.height)-4;m.attr("x",t),m.attr("y",e),m.attr("width",n),m.attr("height",o),s.ShowArrow($("#"+$(i).attr("ID").replace("g_","")))},I[0].onDragEnd=function(){var t=parseInt(I[0].style.left)+2,e=parseInt(I[0].style.top)+2,n=parseInt(I[0].style.width)-4,o=parseInt(I[0].style.height)-4;m.attr("x",t),m.attr("y",e),m.attr("width",n),m.attr("height",o),s.ShowArrow($("#"+$(i).attr("ID").replace("g_","")));var r=s.Record(!0);null!=k&&(s.onRecordHistory(k,r),k=null)},m.hide();var W=function(){$("#orp_"+d+",#edit_"+d).remove(),I.remove(),m.hide(),$(i).find("rect,text,circle").show(),s.ShowArrow($("#"+$(i).attr("ID").replace("g_",""))),s.Record(),s.SetActiveTool(null),s.ShowSetting(!1)};w.focus(),w.bind("blur",function(){n&&clearTimeout(n),n=setTimeout(W,300)}).bind("focus",function(){n&&clearTimeout(n)}).bind(this.EVENTCLICK,function(){if(0==C){var t=parseInt(w[0].style.left)+2,e=parseInt(w[0].style.top)+2,n=$(w).width()-4,o=$(w).height()-4;$("#edit_"+d+",#orp_"+d).remove(),m.show(),$(i).find("rect,text").show(),s.ToInputText(d,t,e,n,o)}C=!1}),I.bind("blur",function(){n&&clearTimeout(n),n=setTimeout(W,300)}).bind("focus",function(){n&&clearTimeout(n)}),this.SetActiveTool(this)},this.EditAnnotation2=function(t,e){var i=this,n=12;0!=this.deviceType&&(n=25);var o=$(t).find("rect"),r=$(t).find("text"),s=parseInt(o.attr("x")),a=parseInt(o.attr("y")),l=parseInt(o.attr("width")),d=parseInt(o.attr("height")),h='<div id="editnote" style="position:absolute; left:10px; top:10px; float:left; z-index:201;">\n            <div class="editnotemenu" style="background-color:black;border-radius:5px; color:white; height:24px;">\n            <ul>\n                <li id="editnote_delete">'+this.Text.Delete+'</li>\n                <li id="editnote_edit">'+this.Text.Edit+'</li>\n            </ul>\n            </div>\n            <div style="padding:8px 0px 0px 20px; text-align:left;">\n            <span style="width:0;height:0;border-left: 5px solid transparent;border-right: 5px solid transparent;border-top: 10px solid black;"></span>\n            </div>\n        </div>';this.main.append(h),$("#editnote").length>0&&$("#editnote").remove(),$("#editnote").attr("tar",t.attr("id").replace("g_","")).attr("tp","note").css({left:s-this._drawGetLeft()+"px",top:Math.max(0,a-0-40-this._drawGetTop()+this.main.scrollTop())+"px"}).show();var c="<div id='edit_"+$(t).attr("ID")+"' tabindex='21' style='position: absolute;touch-action: none;z-index:100;box-sizing:border-box; top: "+(a-n)+"px; left: "+(s-n)+"px; width: "+(l+2*n)+"px; height: "+(d+2*n)+"px; '><table style='width:100%;height:100%;' cellspacing='0' cellpadding='0' border='0'><tr style='height:"+n+"px;'><td "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'nw', 50, 50);\" style='width:"+n+"px;' class='resizebg_nw'></td><td></td><td style='width:"+n+"px;' class='resizebg_ne' "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'ne', 50, 50);\"></td></tr><tr><td></td><td style='height:100%;'><div style=\"width:100%;height:100%;border:1px solid #FFC107; text-align:left; padding:5px;background-color:white;box-sizing:border-box;font-family: 'Consolas';font-size:14px;opacity:0.5;\" class='container'>";c+=r.text().replace(/\r\n/gi,"<br />").replace(/\n/gi,"<br />"),c+="</div>",c+="</td><td></td></tr><tr style='height:"+n+"px;'><td "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'sw', 50, 50);\" style='width:"+n+"px;' class='resizebg_sw'></td><td></td><td style='width:"+n+"px;' class='resizebg_se' "+this.EVENTRESIZE+"=\"Resize(document.getElementById('edit_"+$(t).attr("ID")+"'), event, 'se', 50, 50);\"></td></tr><table></div></div>",this.container.append(c);var p=$("#edit_"+$(t).attr("ID"));Drag.init(p.find("div.container")[0],p[0],-n,null,-n,null);var u=null;p[0].onDrag=function(){null==u&&(u=i.Record(!0,!1)),$("#editnote").hide();var e=parseInt(p[0].style.left)+n,r=parseInt(p[0].style.top)+n,s=parseInt(p[0].style.width)-2*n,a=parseInt(p[0].style.height)-2*n;o.attr("x",e),o.attr("y",r),o.attr("width",s),o.attr("height",a),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")))},p[0].onDragEnd=function(){var e=parseInt(p[0].style.left)+n,s=parseInt(p[0].style.top)+n,a=parseInt(p[0].style.width)-2*n,l=parseInt(p[0].style.height)-2*n;o.attr("x",e),o.attr("y",s),o.attr("width",a),o.attr("height",l),r.attr("x",e+5),r.attr("y",s+15),r.find("tspan").each(function(t){$(this).attr("x",e+5),$(this).attr("y",s+15+20*t)}),$("#editnote").css({left:e-i._drawGetLeft()+"px",top:Math.max(0,s-0-40-i._drawGetTop()+i.main.scrollTop())+"px"}).show(),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")));var d=i.Record(!0);null!=u&&(i.onRecordHistory(u,d),u=null)},p[0].onSizeChange=function(){null==u&&(u=i.Record(!0,!1)),$("#editnote").hide(),d=parseInt(p[0].style.height),p.find("div.editor").height(d-43)},p[0].onSizeChanged=function(){null==u&&(u=i.Record(!0,!1)),$("#editnote").hide();var e=parseInt(p[0].style.left),s=parseInt(p[0].style.top),a=parseInt(p[0].style.width),l=parseInt(p[0].style.height);o.attr("x",e+n),o.attr("y",s+n),o.attr("width",a-2*n),o.attr("height",l-2*n),r.find("tspan").each(function(t){$(this).attr("x",e+n+5),$(this).attr("y",s+n+15+20*t)}),$("#editnote").css({left:e+n-i._drawGetLeft()+"px",top:Math.max(0,s+n-0-40-i._drawGetTop()+i.main.scrollTop())+"px"}).show(),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")));var d=i.Record(!0);null!=u&&(i.onRecordHistory(u,d),u=null)};var g=function(){var e=i.Record(!0,!1),n=$("#editnote_content").val();s=o.attr("x"),a=o.attr("y");var l=parseInt(o.attr("width")),d=i.SplitText(n,l);r.html("");for(var h=0;h<d.length;h++){var c=i.CreateEle("tspan");c.setAttribute("x",parseInt(s,10)+5),c.setAttribute("y",parseInt(a,10)+15+20*h),c.innerHTML=d[h],r.append(c)}p.remove(),C.remove(),S.remove(),$("#editnotetext").remove(),v.show(),$(t).find("rect,text,circle").show(),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")));var u=i.Record(!0);i.onRecordHistory(e,u)};p.find("#cancel").bind(this.EVENTCLICK,function(){p.remove(),$(t).find("rect,text,circle").show()}),$(t).find("rect,text,circle").hide();var v=$("#"+$(t).attr("ID").replace("g_","")),f=v.attr("x"),y=v.attr("y"),x=parseInt(v.attr("width")),b=parseInt(v.attr("height")),w="<div id='orp_"+v.attr("ID")+"' tabindex='22' style='position: absolute;touch-action: none;z-index:101;box-sizing:border-box; top: "+(y-n)+"px; left: "+(f-n)+"px; width: "+(x+2*n)+"px; height: "+(b+2*n)+"px; '>";w+="<table style='width:100%;height:100%;' cellspacing='0' cellpadding='0' border='0'><tr style='height:"+n+"px;'><td "+this.EVENTRESIZE+"=\"Resize(document.getElementById('orp_"+v.attr("ID")+"'), event, 'nw', 50, 50);\" style='width:"+n+"px;' class='resizebg_nw'></td><td></td><td style='width:"+n+"px;' class='resizebg_ne' "+this.EVENTRESIZE+"=\"Resize(document.getElementById('orp_"+v.attr("ID")+"'), event, 'ne', 50, 50);\"></td></tr><tr><td></td><td style='height:100%;'>",w+="<div id='or_"+v.attr("ID")+"' style='width:100%;height:100%;border:1px solid #FFC107;box-sizing:border-box;'></div>",w+="</td><td></td></tr><tr style='height:"+n+"px;'><td "+this.EVENTRESIZE+"=\"Resize(document.getElementById('orp_"+v.attr("ID")+"'), event, 'sw', 50, 50);\" style='width:"+n+"px;' class='resizebg_sw'></td><td></td><td style='width:"+n+"px;' class='resizebg_se' "+this.EVENTRESIZE+"=\"Resize(document.getElementById('orp_"+v.attr("ID")+"'), event, 'se', 50, 50);\"></td></tr><table>",w+="</div>",this.container.append(w);var C=$("#or_"+$(v).attr("ID")),S=$("#orp_"+$(v).attr("ID"));Drag.init(C[0],S[0],-n,null,-n,null);var m=null;S[0].onSizeChange=function(){null==m&&(m=i.Record(!0,!1))},S[0].onSizeChanged=function(){null==m&&(m=i.Record(!0,!1));var e=parseInt(S[0].style.left),o=parseInt(S[0].style.top),r=parseInt(S[0].style.width),s=parseInt(S[0].style.height);v.attr("x",e+n),v.attr("y",o+n),v.attr("width",r-2*n),v.attr("height",s-2*n),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")));var a=i.Record(!0);null!=m&&(i.onRecordHistory(m,a),m=null)},S[0].onDrag=function(){null==m&&(m=i.Record(!0,!1));var e=parseInt(S[0].style.left)+n,o=parseInt(S[0].style.top)+n,r=parseInt(S[0].style.width)-2*n,s=parseInt(S[0].style.height)-2*n;v.attr("x",e),v.attr("y",o),v.attr("width",r),v.attr("height",s),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")))},S[0].onDragEnd=function(){var e=parseInt(S[0].style.left)+n,o=parseInt(S[0].style.top)+n,r=parseInt(S[0].style.width)-2*n,s=parseInt(S[0].style.height)-2*n;v.attr("x",e),v.attr("y",o),v.attr("width",r),v.attr("height",s),i.ShowArrow($("#"+$(t).attr("ID").replace("g_","")));var a=i.Record(!0);null!=m&&(i.onRecordHistory(m,a),m=null)},v.hide();var T=function(){s=parseInt(o.attr("x")),a=parseInt(o.attr("y"));parseInt(o.attr("width"));p.remove(),C.remove(),S.remove(),v.show(),$("#editnote").hide(),$(t).find("rect,text,circle").show(),i.ShowArrow($("#"+$(t).attr("ID").replace("g_",""))),i.Record(),i.SetActiveTool(null)};p.focus();var A=null;p.bind("blur",function(){A&&clearTimeout(A),A=setTimeout(T,300)}).bind("focus",function(){A&&clearTimeout(A)}),S.bind("blur",function(){A&&clearTimeout(A),A=setTimeout(T,300)}).bind("focus",function(){A&&clearTimeout(A)}),$("#editnote").unbind().bind("click",function(e){var n;switch($(e.originalEvent.target).attr("id")){case"editnote_delete":n=i.Record(!0,!1),i.onRecordHistory&&i.onRecordHistory(n,i.RecordHistory_delete(n.id)),A&&clearTimeout(A),i.Record_delete(t.attr("id").replace("g_","")),p.remove(),C.remove(),S.remove(),v.remove(),t.remove(),$("#editnote").hide(),i.SetActiveTool(null);break;case"editnote_edit":!function(){T();$(document.body).height();var e='<div id="editnotetext" tabindex="51" style="position:absolute; z-index:20000; left:0px; top:0px; width:500px; height:400px; padding:2px; background-color:white; border:solid 1px #000;">\n                <div style="width:100%; height:100%;">\n                <div style="height:40px; width:100%; text-align:left;">\n                    <span style="border:1px solid #ccc;border-radius: 4px;cursor:pointer;display:inline-block;padding:5px;" id="btnCancelNote">'+i.Text.Cancel+'</span>\n                    <span style=" float:right;border:1px solid #ccc;border-radius:4px;cursor:pointer;display:inline-block;padding:5px;" id="btnSaveNote">'+i.Text.Save+'</span>\n                </div>\n                <div style="width:100%;">\n                    <textarea style="width:100%; height:360px;resize:none;overflow-y:auto;font-family: \'Consolas\';" rows="10" id="editnote_content"></textarea>\n                </div>\n                </div>\n            </div>';$("#editnotetext").length>0&&$("#editnotetext").remove(),i.main.append(e);var n=s,o=-i._drawGetTop()+a;n=Math.max(0,n),o=Math.max(0,o),n=Math.min(i.getViewWidth()-510,n),o=Math.min(i.getViewHeight()-410,o),$("#editnotetext").show().css({left:n+"px",top:o+"px"}),0!=i.deviceType&&$("#editnotetext").css({left:"0px",top:"0px",width:"calc(100% - 8px)",height:"100%"}),$("#editnote_content").val(r.text()).focus(),$("#btnSaveNote").bind(i.EVENTCLICK,g),$("#btnCancelNote").bind(i.EVENTCLICK,function(e){$("#editnotetext").remove(),p.remove(),$(t).find("rect,text,circle").show()}),i.SetActiveTool(null)}();break;case"editnote_color":case"editnote_fontsize":break;default:A&&clearTimeout(A)}}),this.SetActiveTool(this)},this.Record=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.CreateRecordBaseInfo(26,{x:"x",y:"y",width:"width",height:"height"});if(r("g_"+i.id)){var n=$("#g_"+i.id),o=n.find("rect");i.Rect=new Object,i.Rect.show="none"!=n.css("display"),i.Rect.x=parseInt(o.attr("x")),i.Rect.y=parseInt(o.attr("y")),i.Rect.width=parseInt(o.attr("width")),i.Rect.height=parseInt(o.attr("height")),i.Rect.text=h(p(n.find("text").text())),i.Rect.color=n.find("text").css("fill"),i.Rect.size=parseFloat(n.find("text").prop("style").fontSize.replace("px","")),i.Rect.font=n.find("text").css("font-family");var s=n.find("line");i.Rect.x1=parseInt(s.attr("x1")),i.Rect.x2=parseInt(s.attr("x2")),i.Rect.y1=parseInt(s.attr("y1")),i.Rect.y2=parseInt(s.attr("y2"))}return t&&(i.save=1),e&&this.RecordHandle(i),i},this.SetOption=function(n){n&&(n.Size&&(t=n.Size),n.Color&&(e=n.Color),n.Font&&(i=n.Font))},this.ShowSetting=function(n,o){this.ShowColorSizeSetting(t,e,n,!1,i,o)},this.AfterSelectSizeSetting=function(e){t=e,this.ele&&(this.SetActive(),this.SaveSize(e)),this.onToolSetting&&this.onToolSetting({SettingID:5010,Text:e+""})},this.AfterSelectColorSetting=function(t){e=t,this.ele&&(this.SetActive(),this.SaveColor(t)),this.onToolSetting&&this.onToolSetting({SettingID:5011,Text:t})},this.AfterSelectFontSetting=function(t){i=t,this.ele&&(this.SetActive(),this.SaveFont(t)),this.onToolSetting&&this.onToolSetting({SettingID:5012,Text:t})},this.SetActive=function(){if(n&&clearTimeout(n),n=null,o&&(clearTimeout(o),o=null,this.ele)){var t=$(this.ele).attr("id");$("#edit_"+t).length>0&&(this.SaveInputText(t),this.EditAnnotation(r("g_"+t)))}$("#edit_"+$(this.ele).attr("id")).focus()}}function K(){B.call(this,"ToolBoard");var t=.5,e="#ff0000",i=null,o=null,s=(new Array,new Array,new Array,new v),a=new Array,l=null;function d(t){var e=$(t.originalEvent.target),i=t.originalEvent;return(void 0===i.isPrimary||0!=i.isPrimary)&&("media-header"!=e.attr("id")&&"media-panel-actions"!=e.attr("id")&&("svg"==e[0].tagName.toLowerCase()||"svg"==e.parent()[0].tagName.toLowerCase())&&(!i.pointerType||"mouse"!=i.pointerType||(void 0===i.buttons||0!=i.buttons)&&(1==i.button||0==i.button||-1==i.button)))}function h(t){t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()}function c(t){$("#svg_"+t).css({cursor:"default"})}function p(t){return t.originalEvent.touches&&t.originalEvent.touches.length>0?t.originalEvent.touches[0]:t.originalEvent}function u(t){var e=t[0].getBoundingClientRect().left;return e=Math.max(e,0)}function g(t){var e=t[0].getBoundingClientRect().top;return e=Math.max(e,0)}function f(t,e,i,n){var o=p(t),r=function(t,e){return $(document).scrollLeft()+t.scrollLeft()-u(e)}(i,n),s=function(t,e){return $(document).scrollTop()+t.scrollTop()-g(e)-50}(i,n)+$("#div_"+e).scrollTop();return{x:y((0|o.clientX)-0+r),y:y((0|o.clientY)-0+s)}}function y(t){return Math.round(t)}this.SetOnDisplayChange=function(t){l=t},this._onEventStart=function(n,r,s,l){this.ShowSetting(!1),(i=this.CreateEle("path",{isdraw:"true",tp:"line",style:"fill:white;fill-opacity:0;stroke-linecap:round;","stroke-width":t,stroke:e})).setAttribute("d","M"+n+","+r),i.setAttribute("stroke-opacity",s?.4:1),o.append(i),a.push({x:n,y:r}),this.RecordLine(!0,l)},this._onEventMove=function(n,r,l,d){var h=i.getAttributeNode("d").nodeValue;h.length>7870?(a.push({x:n,y:r}),s.AddHistory(l,{id:i.getAttributeNode("id").nodeValue,color:e,width:t,isbrush:d}),s.AddPoints(l,a),a=new Array,this.RecordLine(!0,l),(i=this.CreateEle("path",{isdraw:"true",tp:"line",style:"fill:white;fill-opacity:0;stroke-linecap:round;","stroke-width":t,stroke:e})).setAttribute("d","M"+this.getLastNode(h)+" L"+n+","+r),i.setAttribute("stroke-opacity",d?.4:1),o.append(i)):i.setAttribute("d",h+" L"+n+","+r),a.push({x:n,y:r}),this.CheckRecordStep(n,r)&&this.RecordLine(!1,l)},this._onEventEnd=function(n,o,r,l){var d=i.getAttributeNode("d").nodeValue;return-1==d.indexOf("L")&&(a.push({x:n,y:o}),i.setAttribute("d",d+" L"+d.substr(d.indexOf("M")+1))),s.ClearRedo(r),s.AddHistory(r,{id:i.getAttributeNode("id").nodeValue,color:e,width:t,isbrush:l}),s.AddPoints(r,a),a=new Array,this.RecordLine(!0,r),!0},this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"board.cur'), default"})},this.onClick=function(t,e){var i=this;this.SetTool(""),this.ele=this.CreateEle("rect",{isdraw:"true",tp:"note",style:"fill:blue;stroke:blue;stroke-width:1;fill-opacity:0.1;z-index:102;"}),this.ele.setAttribute("x",t-12),this.ele.setAttribute("y",e-12),this.ele.setAttribute("width",24),this.ele.setAttribute("height",24),this.Append();var n=this.ele.getAttributeNode("id").nodeValue;$("#"+n).bind(this.EVENTCLICK,function(t){i.Record(!0,1),i.EditWhiteBoard(n,!0)});var o=this.Record(!0,1);if(this.onRecordHistory){o.mode=0;var r=new Array;r.push(this.RecordHistory_delete(o.id)),r.push(this.RecordHistory_delete("edit_"+o.id)),this.onRecordHistory(r,o)}return this.EditWhiteBoard(n,!0),this.SetTool(""),!0},this.onStart=function(t,e){},this.onMove=function(t,e){},this.onEnd=function(t,e){},this.EditWhiteBoard=function(t,e){var i=this,o=$("#edit_"+t);0==o.length&&(this.container.append(this.GetWBContainer(t)),o=$("#edit_"+t)),o.find(">div.boardhead").css({width:this.getContainerWidth(),top:g(this.container),left:u(this.container)}),o.show(),l&&l(!0),$("#WBTool_Del_"+t).unbind().bind(this.EVENTCLICK,function(e){i.getCanEdit&&0==i.getCanEdit()||($("#svg_"+t).find(">path[isdraw='true'],>rect[isdraw='true'],>g[isdraw='true'],>circle[isdraw='true']").remove(),s.Clear(t),new Array,new Array,new Array,i.Record_clear("svg_"+t,!0),h(e))}),$("#WBTool_Close_"+t).unbind().bind(this.EVENTCLICK,function(t){i.getCanEdit&&0==i.getCanEdit()||(i.ShowSetting(!1),o.hide(),l&&l(!1),i.Record(!0,2),i.SetTool(""))}),$("#WBTool_Undo_"+t).unbind().bind(this.EVENTCLICK,function(t){if(!i.getCanEdit||0!=i.getCanEdit()){var e=$(this).attr("id").replace("WBTool_Undo_","");h(t);var n=s.Undo(e);if(!n||null==n)return!1;$("#"+n.id).remove(),i.Record_delete(n.id);var o=s.UndoPoints(e);return s.AddRedoPoints(e,o),s.AddRedoHistory(e,n),!1}}),$("#WBTool_Redo_"+t).unbind().bind(this.EVENTCLICK,function(t){if(!i.getCanEdit||0!=i.getCanEdit()){h(t);var e=$(this).attr("id").replace("WBTool_Redo_",""),o=s.RedoPoints(e);if(null!=o&&0!=o.length){s.AddPoints(e,o);var a=s.RedoHistory(e);s.AddHistory(e,a);var l=n("path");l.setAttribute("id",a.id),l.setAttribute("isdraw","true"),l.setAttribute("tp","line"),l.setAttribute("style","fill:white;fill-opacity:0;stroke-linecap:round;"),l.setAttribute("stroke-width",a.width),l.setAttribute("stroke",a.color),l.setAttribute("d",function(t){var e="";if(1==t.length)e="M"+t[0].x+","+t[0].y+" L"+t[0].x+","+t[0].y;else for(var i=0,n=t.length;i<n;i++)0==i?e="M"+t[i].x+","+t[i].y:e+=" L"+t[i].x+","+t[i].y;return e}(o)),l.setAttribute("stroke-opacity",a.isbrush?.4:1),r("svg_"+e).appendChild(l),i.RecordLine(!0,e,l)}}}),$("#WBTool_Pen_"+t).unbind().bind(this.EVENTCLICK,function(t){if(!i.getCanEdit||0!=i.getCanEdit()){var e=$(this).attr("id").replace("WBTool_Pen_","");c(e),$(this).hasClass("selected")?i.ShowSetting(!0):($(this).parent().find("span.selected").removeClass("selected"),$(this).addClass("selected"),i.DrawLine4Board(e,!1))}}),$("#WBTool_Brush_"+t).unbind().bind(this.EVENTCLICK,function(t){if(!i.getCanEdit||0!=i.getCanEdit()){var e=$(this).attr("id").replace("WBTool_Brush_","");c(e),$(this).hasClass("selected")?i.ShowSetting(!0):($(this).parent().find("span.selected").removeClass("selected"),$(this).addClass("selected"),i.DrawLine4Board(e,!0))}}),$("#WBTool_Hand_"+t).unbind().bind(this.EVENTCLICK,function(t){if(!(i.getCanEdit&&0==i.getCanEdit()||$(this).hasClass("selected"))){var e=$(this).attr("id").replace("WBTool_Hand_","");$(this).parent().find("span.selected").removeClass("selected"),$(this).addClass("selected");var n=0,o=0,r=!1;$("#svg_"+e).css({cursor:"move"}),$("#svg_"+e).unbind().bind(i.EVENTSTART,function(t){var i=p(t);n=i.clientY;var s=$("#div_"+e);o=s.scrollTop(),r=!0}).bind(i.EVENTMOVE,function(t){if(r&&d(t)){var i=p(t).clientY-n,s=$("#div_"+e),a=o-i;a=Math.max(a,0),s.scrollTop(a)}else r=!1}).bind(i.EVENTEND,function(t){r=!1})}});var a=0;$("#div_"+t).unbind().bind("scroll",function(e){if(0!=i.canEdit){var n=r("div_"+t).scrollTop,o=Math.abs(n-a);r("div_"+t).scrollHeight-r("div_"+t).scrollTop-r("div_"+t).clientHeight<62&&($("#svg_"+t).height($("#svg_"+t).height()+.5*$("#div_"+t).height()),i.Record_resize("svg_"+t,1)),o<30||(a=n,i.Record_scroll("div_"+t))}}),1==this.canEdit?($("#WBTool_Pen_"+t).parent().find("span.selected").removeClass("selected"),$("#WBTool_Pen_"+t).addClass("selected"),$("#svg_"+t).css({cursor:"default"}),$("#svg_"+t).unbind(),this.DrawLine4Board(t)):$("#WBTool_Hand_"+t).parent().find("span.selected").removeClass("selected")},this.DrawLine4Board=function(t,e){var i=!1,n=this;o=$("#svg_"+t),$("#svg_"+t).unbind().bind(n.EVENTSTART,function(o){if(d(o)){i=!0;var r=f(o,t,n.main,n.container);return n._onEventStart(r.x,r.y,e,t),o.originalEvent.preventDefault(),o.originalEvent.stopPropagation(),!1}}).bind(n.EVENTMOVE,function(o){if(d(o)&&0!=i){var r=f(o,t,n.main,n.container);return n._onEventMove(r.x,r.y,t,e),o.originalEvent.preventDefault(),o.originalEvent.stopPropagation(),!1}}).bind(n.EVENTEND,function(o){if(0!=i){var r=f(o,t,n.main,n.container);return i=!1,n._onEventEnd(r.x,r.y,t,e)?(o.originalEvent.preventDefault(),o.originalEvent.stopPropagation(),!1):void console.log("event end return")}}).bind(n.EVENTOUT,function(o){if(0!=i){var r=f(o,t,n.main,n.container);return i=!1,n._onEventEnd(r.x,r.y,t,e)?(o.originalEvent.preventDefault(),o.originalEvent.stopPropagation(),!1):void console.log("event end return")}})},this.GetWBContainer=function(t){this.getViewWidth(),this.getViewHeight();var e=this.getContainerHeight(),i="<div id='edit_"+t+"' class='boardcontainer' tabindex='11' style='position: absolute;box-sizing:border-box;  z-index:103;top:0px; left:0px;width:100%;height:100%;";return i+="background-color:white; border:1px solid #d3d3d3; border-radius:10px; box-shadow: 5px 5px 3px #d3d3d3;display:none;'>",i+="<div class='boardhead' style='height:50px;border-bottom:1px solid #d3d3d3;border-left:1px solid #d3d3d3;border-right:1px solid #d3d3d3;width:100%; z-index:102;background-color:white;position: fixed;display: inline-block;top: 0px;left:0px;'><div style='float:left;height:100%;line-height:50px;padding-top:3px;'><span id='WBTool_Hand_"+t+"' class='WBTool_btn'><img width='20px;' title='Hand' src='"+this.ImagePath+"wb_hand.png' /></span>",i+="<span id='WBTool_Pen_"+t+"' class='WBTool_btn selected'><img width='20px;' title='Pen' src='"+this.ImagePath+"wb_pen.png' /></span><span id='WBTool_Brush_"+t+"' class='WBTool_btn'><img width='20px;' title='Brush' src='"+this.ImagePath+"wb_brush.png' /></span>",i+="<span id='WBTool_Del_"+t+"' class='WBTool_btn'><img width='20px;' title='Delete' src='"+this.ImagePath+"wb_delete.png' /></span>",i+="<span id='WBTool_Undo_"+t+"' class='WBTool_btn'><img width='20px;' title='Undo' src='"+this.ImagePath+"wb_undo.png' /></span><span id='WBTool_Redo_"+t+"' class='WBTool_btn'><img width='20px;' title='Redo' src='"+this.ImagePath+"wb_redo.png' /></span>",i+="</div>",i+="<div style='float:left;height:100%;line-height:50px;padding:2px 0px 0px 10px;'><span id='WBTool_Close_"+t+"' style='cursor:pointer; padding-right:10px;'><img width='20px;' title='Close' src='"+this.ImagePath+"wb_close.png' /></span></div></div><div style='height: 50px;'></div>",i+="<div id='div_"+t+"' style='height:calc(100% - 50px);width:100%;overflow:hidden;position:relative;padding-top:0px;'>",i+="<svg id='svg_"+t+"' width='100%' height='"+3*e+"px' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>",i+="</div></div>"},this.Record=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.CreateRecordBaseInfo(27);return t&&(i.save=1),i.mode=e,this.ele.getAttributeNode("x")&&(i.x=parseInt(this.ele.getAttributeNode("x").nodeValue)),this.ele.getAttributeNode("y")&&(i.y=parseInt(this.ele.getAttributeNode("y").nodeValue)),this.ele.getAttributeNode("width")&&(i.width=parseInt(this.ele.getAttributeNode("width").nodeValue)),this.ele.getAttributeNode("height")&&(i.height=parseInt(this.ele.getAttributeNode("height").nodeValue)),this.RecordHandle(i),i},this.RecordLine=function(t,e,n){n=n||i;var o=this.CreateRecordBaseInfo(21,{d:"d",w:"stroke-width",color:"stroke",op:"stroke-opacity"},n);return t&&(o.save=1),o.tar="div_"+e,this.RecordHandle(o),o},this.ShowSetting=function(i,n){this.ShowColorSizeSetting(t,e,i,!1,"",n)},this.AfterSelectSizeSetting=function(e){t=e},this.AfterSelectColorSetting=function(t){e=t}}function J(){B.call(this,"ToolVideo");var t=null,e=null,i=this;this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"video.cur'),default"})},this.SetOnSelectVideo=function(e){t=e},this.SetOnVideoPlay=function(t){e=t},this.onClick=function(t,e){var i=o();this.VideoTagAction(i,t,e),this.VideoTagEdit(i,t,e),this.VideoTagSelect(i);var n=this.Record(!0);if(this.onRecordHistory){var s=new Array;s.push(this.RecordHistory_delete(n.id)),s.push(this.RecordHistory_delete("edit_"+n.id)),this.onRecordHistory(s,n)}return this.SetTool(""),this.ele=r(i),!0},this.Delete=function(){if(this.SetActiveTool(null),!this.ele)return!1;var t=this.Record(!0,!1);if(this.onRecordHistory){var e=new Array;e.push(this.RecordHistory_delete(t.id)),e.push(this.RecordHistory_delete("edit_"+t.id)),this.onRecordHistory(t,e)}var i=this.ele.id;return this.Record_delete(i),this.Record_delete("edit_"+i),$("#"+i).remove(),$("#edit_"+i).remove(),!0},this.VideoTagAction=function(t,e,n){var o=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a="";if(0==s)a='  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >';else{var l=JSON.parse(s);a=l.name?'  <div title="'+l.name+'" style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >':'  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >'}0==this.deviceType&&this.target&&this.target.css({cursor:"default"});var d=$("#"+t);if(0==d.length){var h='<div id="'+t+'" class="live-video-tool-container selected" style="left:'+(e-50)+"px;top:"+(n-50)+'px;">';h+=a,h+='    <div class="live-video-tool-icon" style="background:#5553CE">',h+='      <span id="span_'+t+'"><span  class="icon icon-shipin"></span></span>',h+="    </div>",h+='    <div class="media-act-wrapper" title="">',h+='    <div class="live-video-tool-play">',h+='      <span class="icon icon-bofang1"></span>',h+="      <span>Play</span>",h+="    </div>",h+='     <div class="cut-line"></div>',h+='    <div class="live-video-tool-edit">',h+='     <span class="icon icon-bianji1"></span>',h+="      <span>Edit</span>",h+="    </div>",h+='     <div class="cut-line"></div>',h+='    <div class="live-video-tool-delete">',h+='     <span class="icon icon-shanchu "></span>',h+="      <span>Delete</span>",h+="    </div>",h+='     <input type="hidden"></input>',h+="     </div>",h+="    </div >",h+="  </div>",this.container.append(h),d=$("#"+t)}else d.css({left:e-50,top:n-50}),d.show();if(this.SetEle(d[0]),s?$("#"+t).find("INPUT").val(s):$("#"+t).find("INPUT").val(""),d.find("div.live-video-tool-icon").unbind().bind(this.EVENTCLICK,function(t){d.hasClass("selected")?d.removeClass("selected"):d.addClass("selected")}),d.find("div.live-video-tool-play").unbind().bind(this.EVENTCLICK,function(e){var n=$("#"+t).find("INPUT").val();if(null!=n&&""!=n){var o=JSON.parse(n);i.VideoTagPlay(o.id,o.attachmentId)}else i.onError&&i.onError(200,"No video to play!")}),d.find("div.live-video-tool-edit").unbind().bind(this.EVENTCLICK,function(e){i.VideoTagEdit(t,parseInt(i.ele.style.left.replace("px",""))+50,parseInt(i.ele.style.top.replace("px",""))+50)}),d.find("div.live-video-tool-delete").unbind().bind(this.EVENTCLICK,function(t){i.Delete()}),r("span_"+t)){Drag.init(r("span_"+t),d[0],50,null,50,null);var c=null;d[0].onDrag=function(){null==c&&(c=o.Record(!0,!1))},d[0].onDragEnd=function(){var t=o.Record(!0);null!=c&&(o.onRecordHistory(c,t),c=null)},d[0].canDrag=function(){return!i.getCanEdit||0!=i.getCanEdit()}}},this.VideoTagEdit=function(t,e,n){if(!i.getCanEdit||0!=i.getCanEdit()){var o=$("#edit_"+t);if(0==o.length){var r=e+55;e+55+300>this.container.width()&&(r=e-55-300);var s='<div id="edit_'+t+'" class="live-video-tool-editvideo" style="left:'+r+"px;top:"+(n-55)+'px;">';s+='  <div class="live-video-tool-edit-top">',s+='    <span style="font-weight:bold;">Insert Video/Audio<input class="live-video-tool-info" type="hidden"></input></span>',s+="    </div>",s+='  <div style="height:120px; text-align:left;">',s+='    <div class="live-video-tool-edit-listcontainer">',s+="       <ul>",s+='         <li style="width:50px">Name:</li>',s+='         <li class="live-video-tool-edit-name" style="width:230px;text-overflow: ellipsis;overflow: hidden;height:21px;"></li>',s+="       </ul>",s+='       <ul style="clear:both;">',s+='         <li style="width:50px">Size:</li>',s+='         <li class="live-video-tool-edit-length" style="width:230px;height:21px;"></li>',s+="       </ul>",s+='       <ul style="clear:both;">',s+='         <li style="width:50px">Time:</li>',s+='         <li class="live-video-tool-edit-time" style="width:230px;height:21px;"></li>',s+="       </ul>",s+="     </div>",s+='     <div class="live-video-tool-edit-selectcontainer">',s+='      <span class="live-video-tool-edit-selectvideo">Select Video/Audio...</span>',s+="    </div>",s+='    <div class="live-video-tool-edit-changecontainer" style="display:none;">',s+='      <span><img src="'+this.ImagePath+'icon-change.png" /></span>',s+='       <span style="cursor:pointer;">Change Video/Audio</span>',s+='   <span style="margin:0 10px">delete<span> <span style="float:none" class="live-video-tool-edit-del"><img src="'+this.ImagePath+'icon-delete.png" /></span>',s+="     </div>",s+="   </div>",s+='   <div style="height:26px; text-align:center;display:none;">',s+='   <span class="live-video-tool-edit-recording"><label><input onclick="_cancelBubble(event);" type="checkbox"/>Enable voice recording</label></span>',s+="   </div>",s+='   <div style="height:36px; text-align:center;display:none;">',s+='   <span class="live-video-tool-edit-sync">Sync</span>',s+="   </div>",s+='   <div class="live-video-tool-edit-bottom">',s+='    <span class="live-video-tool-edit-cancel">Cancel</span>',s+='    <span class="live-video-tool-edit-save">Save</span>',s+="  </div>",s+="  </div>",this.container.append(s),o=$("#edit_"+t)}else{r=e+55;e+55+300>this.container.width()&&(r=e-55-300),o.css({left:r,top:n-55}),o.show()}var a=$("#"+t).find("INPUT").val();try{if(null!=a&&""!=a){var l=JSON.parse(a);o.find("INPUT.live-video-tool-info").val(JSON.stringify(l)),o.find("li.live-video-tool-edit-name").html(l.name),o.find("li.live-video-tool-edit-length").html(l.size),o.find("li.live-video-tool-edit-time").html(l.time),o.find("div.live-video-tool-edit-selectcontainer").hide(),o.find("div.live-video-tool-edit-changecontainer").show()}}catch(t){}o.find("div.live-video-tool-edit-selectcontainer").unbind().bind(this.EVENTCLICK,function(e){i.VideoTagSelect(t)}),o.find("div.live-video-tool-edit-changecontainer").unbind().bind(this.EVENTCLICK,function(e){i.VideoTagSelect(t)}),o.find("span.live-video-tool-edit-del").unbind().bind(this.EVENTCLICK,function(e){if(i.getCanEdit&&0==i.getCanEdit())return!1;o.remove(),$("#"+t).remove(),i.Record_delete(t,1),i.SetActiveTool(null)}),o.find("span.live-video-tool-edit-save").unbind().bind(this.EVENTCLICK,function(e){$("#"+t).find("INPUT").val(o.find("INPUT.live-video-tool-info").val()),o.remove(),i.Record(!0),i.SetActiveTool(null)}),o.find("span.live-video-tool-edit-cancel").unbind().bind(this.EVENTCLICK,function(t){o.remove(),i.SetActiveTool(null)}),this.SetActiveTool(this)}},this.VideoTagSelect=function(e){i.getCanEdit&&0==i.getCanEdit()||t&&t(e,this.VideoTagAfterSelect)},this.VideoTagAfterSelect=function(t,e){var n=$("#edit_"+t);if(null==e)""==n.find("INPUT.live-video-tool-info").val()&&i.Delete(),n.remove(),i.SetActiveTool(null);else{var o=i.Record(!0,!1),r=new Object;r.id=e.ItemID,r.name=e.Title,r.time=e.VideoDuration,r.size=e.VideoSize,r.type=e.FileType,r.attachmentId=e.AttachmentID,r.fileId=e.AttachmentFileID,n.find("INPUT.live-video-tool-info").val(JSON.stringify(r)),n.find("li.live-video-tool-edit-name").html(r.name),n.find("li.live-video-tool-edit-length").html(r.size),n.find("li.live-video-tool-edit-time").html(r.time),n.find("div.live-video-tool-edit-selectcontainer").hide(),n.find("div.live-video-tool-edit-changecontainer").show(),$("#"+t).find("INPUT").val(JSON.stringify(r)),n.remove();var s=i.Record(!0);i.onRecordHistory(o,s)}},this.VideoTagPlay=function(t,n){i.getCanEdit&&0==i.getCanEdit()||e&&e(t,n)},this.Record=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.CreateRecordBaseInfo(33);return t&&(i.save=1),i.Left=parseInt(this.ele.style.left.replace("px",""))+50,i.Top=parseInt(this.ele.style.top.replace("px",""))+50,""!=$(this.ele).find("INPUT").val()&&(i.Info=JSON.parse($(this.ele).find("INPUT").val())),e&&this.RecordHandle(i),i}}function Z(){B.call(this,"ToolVideoLink");var t=null,e=null,i=this;this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"video.cur'),default"})},this.SetOnSelectVideoLink=function(e){t=e},this.SetOnVideoLinkPlay=function(t){e=t},this.onClick=function(t,e){var i=o();this.VideoLinkTagAction(i,t,e),this.VideoLinkTagEdit(i,t,e,!1),this.VideoLinkTagSelect(i);var n=this.Record(!0);if(this.onRecordHistory){var s=new Array;s.push(this.RecordHistory_delete(n.id)),s.push(this.RecordHistory_delete("edit_"+n.id)),this.onRecordHistory(s,n)}return this.SetTool(""),this.ele=r(i),!0},this.Delete=function(){if(this.SetActiveTool(null),!this.ele)return!1;var t=this.Record(!0,!1);if(this.onRecordHistory){var e=new Array;e.push(this.RecordHistory_delete(t.id)),e.push(this.RecordHistory_delete("edit_"+t.id)),this.onRecordHistory(t,e)}var i=this.ele.id;return this.Record_delete(i),this.Record_delete("edit_"+i),$("#"+i).remove(),$("#edit_"+i).remove(),!0},this.VideoLinkTagAction=function(t,e,n){var o=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a="";if(0==s)a='  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >';else{var l=JSON.parse(s);a=l.name?'  <div title="'+l.name+'" style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >':'  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >'}0==this.deviceType&&this.target&&this.target.css({cursor:"default"});var d=$("#"+t);if(0==d.length){var h='<div id="'+t+'" class="live-video-link-tool-container selected" style="left:'+(e-50)+"px;top:"+(n-50)+'px;">';h+=a,h+='    <div class="live-video-tool-icon" style="background-color:#53CEB6;" >',h+='      <span id="span_'+t+'"><span style="position:relative;top:2px;" class="icon icon-shipinlink"></span></span>',h+="    </div>",h+='    <div class="media-act-wrapper" title="">',h+='    <div class="live-video-tool-play">',h+='      <span class="icon icon-bofang1"></span>',h+="      <span>Play</span>",h+="    </div>",h+='     <div class="cut-line"></div>',h+='    <div class="live-video-tool-edit">',h+='     <span class="icon icon-bianji1"></span>',h+="      <span>Edit</span>",h+="    </div>",h+='     <div class="cut-line"></div>',h+='    <div class="live-video-tool-delete">',h+='     <span class="icon icon-shanchu "></span>',h+="      <span>Delete</span>",h+="    </div>",h+='     <input type="hidden"></input>',h+="     </div>",h+="    </div>",h+="  </div>",this.container.append(h),d=$("#"+t)}else d.css({left:e-50,top:n-50}),d.show();if(this.SetEle(d[0]),s?$("#"+t).find("INPUT").val(s):$("#"+t).find("INPUT").val(""),d.find("div.live-video-tool-icon").unbind().bind(this.EVENTCLICK,function(t){d.hasClass("selected")?d.removeClass("selected"):d.addClass("selected")}),d.find("div.live-video-tool-play").unbind().bind(this.EVENTCLICK,function(e){var n=$("#"+t).find("INPUT").val();if(null!=n&&""!=n){var o=JSON.parse(n);i.VideoLinkTagPlay(o)}else i.onError&&i.onError(200,"No video to play!")}),d.find("div.live-video-tool-edit").unbind().bind(this.EVENTCLICK,function(e){i.VideoLinkTagEdit(t,parseInt(i.ele.style.left.replace("px",""))+50,parseInt(i.ele.style.top.replace("px",""))+50,!0)}),d.find("div.live-video-tool-delete").unbind().bind(this.EVENTCLICK,function(t){i.Delete()}),r("span_"+t)){Drag.init(r("span_"+t),d[0],50,null,50,null);var c=null;d[0].onDrag=function(){null==c&&(c=o.Record(!0,!1))},d[0].onDragEnd=function(){var t=o.Record(!0);null!=c&&(o.onRecordHistory(c,t),c=null)},d[0].canDrag=function(){return!i.getCanEdit||0!=i.getCanEdit()}}},this.VideoLinkTagEdit=function(t,e,n,o){if(!i.getCanEdit||0!=i.getCanEdit()){var r=$("#edit_"+t);if(0==r.length){var s=e+55;e+55+300>this.container.width()&&(s=e-55-300);var a="";o||(a="display: none;");var l='<div id="edit_'+t+'" class="live-video-tool-editvideo" style="left:'+s+"px;top:"+(n-55)+"px;"+a+'">';l+='  <div class="live-video-tool-edit-top">',l+='    <span style="font-weight:bold;">Insert Video Link<input class="live-video-tool-info" type="hidden"></input></span>',l+="    </div>",l+='  <div style="height:120px; text-align:left;">',l+='    <div class="live-video-tool-edit-listcontainer">',l+="       <ul>",l+='         <li style="width:50px">Name:</li>',l+='         <li class="live-video-tool-edit-name" style="width:230px;text-overflow: ellipsis;overflow: hidden;height:21px;"></li>',l+="       </ul>",l+='       <ul style="clear:both;">',l+='         <li style="width:50px">Size:</li>',l+='         <li class="live-video-tool-edit-length" style="width:230px;height:21px;"></li>',l+="       </ul>",l+='       <ul style="clear:both;">',l+='         <li style="width:50px">Time:</li>',l+='         <li class="live-video-tool-edit-time" style="width:230px;height:21px;"></li>',l+="       </ul>",l+="     </div>",l+='     <div class="live-video-tool-edit-selectcontainer">',l+='      <span class="live-video-tool-edit-selectvideo">Select Video Link...</span>',l+="    </div>",l+='    <div class="live-video-tool-edit-changecontainer" style="display:none;">',l+='      <span><img src="'+this.ImagePath+'icon-change.png" /></span>',l+='       <span style="cursor:pointer;">Change Video Link</span>',l+='   <span style="margin:0 10px">delete<span> <span style="float:none" class="live-video-tool-edit-del"><img src="'+this.ImagePath+'icon-delete.png" /></span>',l+="     </div>",l+="   </div>",l+='   <div style="height:26px; text-align:center;display:none;">',l+='   <span class="live-video-tool-edit-recording"><label><input onclick="_cancelBubble(event);" type="checkbox"/>Enable voice recording</label></span>',l+="   </div>",l+='   <div style="height:36px; text-align:center;display:none;">',l+='   <span class="live-video-tool-edit-sync">Sync</span>',l+="   </div>",l+='   <div class="live-video-tool-edit-bottom">',l+='    <span class="live-video-tool-edit-cancel">Cancel</span>',l+='    <span class="live-video-tool-edit-save">Save</span>',l+="  </div>",l+="  </div>",this.container.append(l),r=$("#edit_"+t)}else{s=e+55;e+55+300>this.container.width()&&(s=e-55-300),r.css({left:s,top:n-55}),r.show()}var d=$("#"+t).find("INPUT").val();try{if(null!=d&&""!=d){var h=JSON.parse(d);r.find("INPUT.live-video-tool-info").val(JSON.stringify(h)),r.find("li.live-video-tool-edit-name").html(h.name),r.find("li.live-video-tool-edit-length").html(h.size),r.find("li.live-video-tool-edit-time").html(h.time),r.find("div.live-video-tool-edit-selectcontainer").hide(),r.find("div.live-video-tool-edit-changecontainer").show()}}catch(t){}r.find("div.live-video-tool-edit-selectcontainer").unbind().bind(this.EVENTCLICK,function(e){i.VideoLinkTagEdit2(t,h)}),r.find("div.live-video-tool-edit-changecontainer").unbind().bind(this.EVENTCLICK,function(e){i.VideoLinkTagEdit2(t,h)}),r.find("span.live-video-tool-edit-del").unbind().bind(this.EVENTCLICK,function(e){if(i.getCanEdit&&0==i.getCanEdit())return!1;r.remove(),$("#"+t).remove(),i.Record_delete(t,1),i.SetActiveTool(null)}),r.find("span.live-video-tool-edit-save").unbind().bind(this.EVENTCLICK,function(e){$("#"+t).find("INPUT").val(r.find("INPUT.live-video-tool-info").val()),r.remove(),i.Record(!0),i.SetActiveTool(null)}),r.find("span.live-video-tool-edit-cancel").unbind().bind(this.EVENTCLICK,function(t){r.remove(),i.SetActiveTool(null)}),this.SetActiveTool(this)}},this.VideoLinkTagEdit2=function(e,n){i.getCanEdit&&0==i.getCanEdit()||t&&t(e,n,this.VideoLinkTagAfterSelect)},this.VideoLinkTagSelect=function(e){i.getCanEdit&&0==i.getCanEdit()||t&&t(e,null,this.VideoLinkTagAfterSelect)},this.VideoLinkTagAfterSelect=function(t,e){var n=$("#edit_"+t);if(null==e)""==n.find("INPUT.live-video-tool-info").val()&&i.Delete(),n.remove(),i.SetActiveTool(null);else{var o=i.Record(!0,!1),r=e;n.find("INPUT.live-video-tool-info").val(JSON.stringify(r)),n.find("li.live-video-tool-edit-name").html(r.name),n.find("li.live-video-tool-edit-length").html(r.size),n.find("li.live-video-tool-edit-time").html(r.time),n.find("div.live-video-tool-edit-selectcontainer").hide(),n.find("div.live-video-tool-edit-changecontainer").show(),$("#"+t).find("INPUT").val(JSON.stringify(r)),n.remove();var s=i.Record(!0);i.onRecordHistory(o,s)}},this.VideoLinkTagPlay=function(t){i.getCanEdit&&0==i.getCanEdit()||e&&e(t)},this.Record=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.CreateRecordBaseInfo(37);return t&&(i.save=1),i.Left=parseInt(this.ele.style.left.replace("px",""))+50,i.Top=parseInt(this.ele.style.top.replace("px",""))+50,""!=$(this.ele).find("INPUT").val()&&(i.Info=JSON.parse($(this.ele).find("INPUT").val())),e&&this.RecordHandle(i),i}}function Y(){B.call(this,"ToolSync");var t=null,e=null,i=null,n=this;this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"sync.cur'),default"})},this.SetOnSelectSync=function(e){t=e},this.SetOnSyncPlay=function(t){e=t},this.SetOnSyncEdit=function(t){i=t},this.onClick=function(t,e){var i=o();this.VideoTagAction(i,t,e),this.VideoTagEdit(i,t,e),this.VideoTagSelect(i);var n=this.Record(!0);if(this.onRecordHistory){var s=new Array;s.push(this.RecordHistory_delete(n.id)),s.push(this.RecordHistory_delete("edit_"+n.id)),this.onRecordHistory(s,n)}return this.SetTool(""),this.ele=r(i),!0},this.Delete=function(){if(this.SetActiveTool(null),!this.ele)return!1;var t=this.Record(!0,!1);if(this.onRecordHistory){var e=new Array;e.push(this.RecordHistory_delete(t.id)),e.push(this.RecordHistory_delete("edit_"+t.id)),this.onRecordHistory(t,e)}var i=this.ele.id;return this.Record_delete(i),this.Record_delete("edit_"+i),$("#"+i).remove(),$("#edit_"+i).remove(),!0},this.VideoTagAction=function(t,e,i){var o=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a="";if(0==s)a='  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >';else{var l=JSON.parse(s);a=l.name?"  <div title="+l.name+' style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >':'  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >'}0==this.deviceType&&this.target&&this.target.css({cursor:"default"});var d=$("#"+t);if(0==d.length){var h='<div id="'+t+'" class="live-sync-tool-container selected" style="left:'+(e-50)+"px;top:"+(i-50)+'px;">';h+=a,h+='    <div class="live-video-tool-icon" >',h+='      <span id="span_'+t+'"><span style="font-size:18px" class="icon icon-yinxiang1"></span></span>',h+="    </div>",h+='    <div class="media-act-wrapper" title="">',h+='    <div class="live-video-tool-play">',h+='      <span class="icon icon-bofang1"></span>',h+="      <span>Play</span>",h+="    </div>",h+='     <div class="cut-line"></div>',h+='    <div class="live-video-tool-edit">',h+='     <span class="icon icon-bianji1"></span>',h+="      <span>Edit</span>",h+="    </div>",h+='     <div class="cut-line"></div>',h+='    <div class="live-video-tool-delete">',h+='     <span class="icon icon-shanchu "></span>',h+="      <span>Delete</span>",h+="    </div>",h+='     <input type="hidden"></input>',h+="     </div>",h+="    </div>",h+="  </div>",this.container.append(h),d=$("#"+t)}else d.css({left:e-50,top:i-50}),d.show();if(this.SetEle(d[0]),s?$("#"+t).find("INPUT").val(s):$("#"+t).find("INPUT").val(""),d.find("div.live-video-tool-icon").unbind().bind(this.EVENTCLICK,function(t){d.hasClass("selected")?d.removeClass("selected"):d.addClass("selected")}),d.find("div.live-video-tool-play").unbind().bind(this.EVENTCLICK,function(e){var i=$("#"+t).find("INPUT").val();if(null!=i&&""!=i){var o=JSON.parse(i);n.VideoTagPlay(o.id,o.attachmentId)}else n.onError&&n.onError(201,"No sync to play!")}),d.find("div.live-video-tool-edit").unbind().bind(this.EVENTCLICK,function(e){var i=$("#"+t).find("INPUT").val();if(null!=i&&""!=i){var o=JSON.parse(i);n.SyncTagEdit(o.id,o.attachmentId,t)}else n.onError&&n.onError(202,"No sync to edit!")}),d.find("div.live-video-tool-delete").unbind().bind(this.EVENTCLICK,function(t){n.Delete()}),r("span_"+t)){Drag.init(r("span_"+t),d[0],50,null,50,null);var c=null;d[0].onDrag=function(){null==c&&(c=o.Record(!0,!1))},d[0].onDragEnd=function(){var t=o.Record(!0);null!=c&&(o.onRecordHistory(c,t),c=null)},d[0].canDrag=function(){return!n.getCanEdit||0!=n.getCanEdit()}}},this.VideoTagEdit=function(t,e,i){if(!n.getCanEdit||0!=n.getCanEdit()){var o=$("#edit_"+t);if(0==o.length){var r=e+55;e+55+300>this.container.width()&&(r=e-55-300);var s='<div id="edit_'+t+'" class="live-video-tool-editvideo" style="left:'+r+"px;top:"+(i-55)+'px;">';s+='  <div class="live-video-tool-edit-top">',s+='    <span style="font-weight:bold;">Insert Sync<input class="live-video-tool-info" type="hidden"></input></span>',s+='    <span class="live-video-tool-edit-del"><img src="'+this.ImagePath+'icon-delete.png" /></span>',s+="    </div>",s+='  <div style="height:120px; text-align:left;">',s+='    <div class="live-video-tool-edit-listcontainer">',s+="       <ul>",s+='         <li style="width:50px">Name:</li>',s+='         <li class="live-video-tool-edit-name" style="width:230px;text-overflow: ellipsis;overflow: hidden;height:21px;"></li>',s+="       </ul>",s+='       <ul style="clear:both;">',s+='         <li style="width:50px">Time:</li>',s+='         <li class="live-video-tool-edit-time" style="width:230px;height:21px;"></li>',s+="       </ul>",s+="     </div>",s+='     <div class="live-video-tool-edit-selectcontainer">',s+='      <span class="live-video-tool-edit-selectvideo">Select Sync...</span>',s+="    </div>",s+='    <div class="live-video-tool-edit-changecontainer" style="display:none;">',s+='      <span><img src="'+this.ImagePath+'icon-change.png" /></span>',s+='       <span style="cursor:pointer;">Change Sync</span>',s+="     </div>",s+="   </div>",s+='   <div style="height:26px; text-align:center;display:none;">',s+='   <span class="live-video-tool-edit-recording"><label><input onclick="_cancelBubble(event);" type="checkbox"/>Enable voice recording</label></span>',s+="   </div>",s+='   <div style="height:36px; text-align:center;display:none;">',s+='   <span class="live-video-tool-edit-sync">Sync</span>',s+="   </div>",s+='   <div class="live-video-tool-edit-bottom">',s+='    <span class="live-video-tool-edit-cancel">Cancel</span>',s+='    <span class="live-video-tool-edit-save">Save</span>',s+="  </div>",s+="  </div>",this.container.append(s),o=$("#edit_"+t)}else{r=e+55;e+55+300>this.container.width()&&(r=e-55-300),o.css({left:r,top:i-55}),o.show()}var a=$("#"+t).find("INPUT").val();try{if(null!=a&&""!=a){var l=JSON.parse(a);o.find("INPUT.live-video-tool-info").val(JSON.stringify(l)),o.find("li.live-video-tool-edit-name").html(l.name),o.find("li.live-video-tool-edit-length").html(l.size),o.find("li.live-video-tool-edit-time").html(l.time),o.find("div.live-video-tool-edit-selectcontainer").hide(),o.find("div.live-video-tool-edit-changecontainer").show()}}catch(t){}o.find("div.live-video-tool-edit-selectcontainer").unbind().bind(this.EVENTCLICK,function(e){n.VideoTagSelect(t)}),o.find("div.live-video-tool-edit-changecontainer").unbind().bind(this.EVENTCLICK,function(e){n.VideoTagSelect(t)}),o.find("span.live-video-tool-edit-del").unbind().bind(this.EVENTCLICK,function(e){if(n.getCanEdit&&0==n.getCanEdit())return!1;o.remove(),$("#"+t).remove(),n.Record_delete(t,1),n.SetActiveTool(null)}),o.find("span.live-video-tool-edit-save").unbind().bind(this.EVENTCLICK,function(e){$("#"+t).find("INPUT").val(o.find("INPUT.live-video-tool-info").val()),o.remove(),n.Record(!0),n.SetActiveTool(null)}),o.find("span.live-video-tool-edit-cancel").unbind().bind(this.EVENTCLICK,function(t){o.remove(),n.SetActiveTool(null)}),this.SetActiveTool(this)}},this.VideoTagSelect=function(e){n.getCanEdit&&0==n.getCanEdit()||($("#edit_"+e).remove(),n.SetActiveTool(null),t&&t(e,this.VideoTagAfterSelect))},this.VideoTagAfterSelect=function(t,e){var i=$("#edit_"+t);if(n.ele=r(t),null==e)n.Delete(),i.remove(),n.SetActiveTool(null);else{var o=n.Record(!0,!1),s=new Object;s.id=e.ID,s.name=e.Title,s.time=e.Time,s.attachmentId=e.AttachmentID,i.find("INPUT.live-video-tool-info").val(JSON.stringify(s)),i.find("li.live-video-tool-edit-name").html(s.name),i.find("li.live-video-tool-edit-time").html(s.time),i.find("div.live-video-tool-edit-selectcontainer").hide(),i.find("div.live-video-tool-edit-changecontainer").show(),$("#"+t).find("INPUT").val(JSON.stringify(s)),i.remove();var a=n.Record(!0);n.onRecordHistory(o,a)}},this.VideoTagPlay=function(t,i){n.getCanEdit&&0==n.getCanEdit()||e&&e(t,i)},this.SyncTagEdit=function(t,e,o){n.getCanEdit&&0==n.getCanEdit()||i&&i(t,e,o,this.VideoTagAfterSelect)},this.Record=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=n.CreateRecordBaseInfo(36);return t&&(i.save=1),i.Left=parseInt(n.ele.style.left.replace("px",""))+50,i.Top=parseInt(n.ele.style.top.replace("px",""))+50,""!=$("#"+n.ele.id).find("INPUT").val()&&(i.Info=JSON.parse($("#"+n.ele.id).find("INPUT").val())),e&&n.RecordHandle(i),i}}function X(){B.call(this,"ToolBooksNote");var t=null,e=null,i=null,n=null,s=this;this.Init=function(){},this.SetOnBooksNoteEdit=function(e){t=e},this.SetOnBooksNoteSelect=function(t){i=t},this.SetOnBooksNoteView=function(t){e=t},this.SetOnBooksNoteMove=function(t){n=t},this.onClick=function(t,e){o();return 4==this.deviceType?this.BookNoteEdit({LinkID:0,LinkProperty:{X:t/this.getContainerWidth(),Y:e/this.getContainerHeight()}}):this.BookNoteSelect({LinkID:0,LinkProperty:{X:t/this.getContainerWidth(),Y:e/this.getContainerHeight()}}),this.SetTool(""),!0},this.Delete=function(){if(this.SetActiveTool(null),!this.ele)return!1;var t=this.Record(!0,!1);if(this.onRecordHistory){var e=new Array;e.push(this.RecordHistory_delete(t.id)),this.onRecordHistory(t,e)}var i=this.ele.id;return this.Record_delete(i),$("#"+i).remove(),!0},this.VideoTagAction=function(t){if(t&&t.LinkID&&t.LinkProperty){var e=t.LinkID,i=t.LinkProperty.X*this.getContainerWidth(),n=t.LinkProperty.Y*this.getContainerHeight();i=Math.max(i,15),n=Math.max(n,15),i=Math.min(i,this.getContainerWidth()-20),n=Math.min(n,this.getContainerHeight()-20);var o="";o=t&&t.name?'  <div title="'+_info.name+'" style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >':'  <div  style= "position:relative;width:100%;height:100%;padding:0px;margin:0px;" >',0==this.deviceType&&this.target&&this.target.css({cursor:"default"});var a=$("#BooXNote_"+e);if(0==a.length){var l='<div id="BooXNote_'+e+'" isother="'+(t.IsOther&&1==t.IsOther?"1":"0")+'" class="live-booknote-tool-container selected" style="left:'+(i-15)+"px;top:"+(n-15)+'px;">';l+=o,t.IsOther&&1==t.IsOther?l+='    <div class="live-video-tool-icon" style="background-color:#bd10e0">':l+='    <div class="live-video-tool-icon" style="background-color:#3D74DD">',l+='      <span id="BooXNote_span_'+e+'"><span style="font-size:18px" class="icon icon-meeting1"></span></span>',l+="    </div>",l+='    <div class="media-act-wrapper" title="">',l+='    <div class="live-video-tool-play">',l+="      <span>View</span>",l+="    </div>",4==this.deviceType&&(l+='     <div class="cut-line"></div>',l+='    <div class="live-video-tool-edit">',l+="      <span>Edit</span>",l+="    </div>"),l+='     <div class="cut-line"></div>',l+='    <div class="live-video-tool-select">',l+="      <span>Select</span>",l+='    </div><input type="hidden"></input>',l+="     </div>",l+="    </div >",l+="  </div>",this.container.append(l),a=$("#BooXNote_"+e)}else a.css({left:i-15+"px",top:n-15+"px"});if(this.SetEle(a[0]),a.find("div.live-video-tool-play").unbind().bind(this.EVENTCLICK,function(t){s.BookNoteView({LinkID:e})}),a.find("div.live-video-tool-edit").unbind().bind(this.EVENTCLICK,function(t){s.BookNoteEdit({LinkID:e,LinkProperty:{X:i/s.getContainerWidth(),Y:n/s.getContainerHeight()}})}),a.find("div.live-video-tool-select").unbind().bind(this.EVENTCLICK,function(t){s.BookNoteSelect({LinkID:e,LinkProperty:{X:i/s.getContainerWidth(),Y:n/s.getContainerHeight()}})}),r("BooXNote_span_"+e)){Drag.init(r("BooXNote_span_"+e),a[0],1,null,1,null);a[0].onDrag=function(){},a[0].onDragEnd=function(){i=parseFloat(a[0].style.left.replace("px",""))+15,n=parseFloat(a[0].style.top.replace("px",""))+15,s.BookNoteMove({LinkID:e,LinkProperty:{X:i/s.getContainerWidth(),Y:n/s.getContainerHeight()}})},a[0].canDrag=function(){return!s.getCanEdit||0!=s.getCanEdit()}}}},this.VideoTagEdit=function(t,e,i){if(!s.getCanEdit||0!=s.getCanEdit()){var n=$("#edit_"+t);if(0==n.length){var o=e+55;e+55+300>this.container.width()&&(o=e-55-300);var r='<div id="edit_'+t+'" class="live-video-tool-editvideo" style="left:'+o+"px;top:"+(i-55)+'px;">';r+='  <div class="live-video-tool-edit-top">',r+='    <span style="font-weight:bold;">Insert Video/Audio<input class="live-video-tool-info" type="hidden"></input></span>',r+="    </div>",r+='  <div style="height:120px; text-align:left;">',r+='    <div class="live-video-tool-edit-listcontainer">',r+="       <ul>",r+='         <li style="width:50px">Name:</li>',r+='         <li class="live-video-tool-edit-name" style="width:230px;text-overflow: ellipsis;overflow: hidden;height:21px;"></li>',r+="       </ul>",r+='       <ul style="clear:both;">',r+='         <li style="width:50px">Size:</li>',r+='         <li class="live-video-tool-edit-length" style="width:230px;height:21px;"></li>',r+="       </ul>",r+='       <ul style="clear:both;">',r+='         <li style="width:50px">Time:</li>',r+='         <li class="live-video-tool-edit-time" style="width:230px;height:21px;"></li>',r+="       </ul>",r+="     </div>",r+='     <div class="live-video-tool-edit-selectcontainer">',r+='      <span class="live-video-tool-edit-selectvideo">Select Video/Audio...</span>',r+="    </div>",r+='    <div class="live-video-tool-edit-changecontainer" style="display:none;">',r+='      <span><img src="'+this.ImagePath+'icon-change.png" /></span>',r+='       <span style="cursor:pointer;">Change Video/Audio</span>',r+='   <span style="margin:0 10px">delete<span> <span style="float:none" class="live-video-tool-edit-del"><img src="'+this.ImagePath+'icon-delete.png" /></span>',r+="     </div>",r+="   </div>",r+='   <div style="height:26px; text-align:center;display:none;">',r+='   <span class="live-video-tool-edit-recording"><label><input onclick="_cancelBubble(event);" type="checkbox"/>Enable voice recording</label></span>',r+="   </div>",r+='   <div style="height:36px; text-align:center;display:none;">',r+='   <span class="live-video-tool-edit-sync">Sync</span>',r+="   </div>",r+='   <div class="live-video-tool-edit-bottom">',r+='    <span class="live-video-tool-edit-cancel">Cancel</span>',r+='    <span class="live-video-tool-edit-save">Save</span>',r+="  </div>",r+="  </div>",this.container.append(r),n=$("#edit_"+t)}else{o=e+55;e+55+300>this.container.width()&&(o=e-55-300),n.css({left:o,top:i-55}),n.show()}var a=$("#"+t).find("INPUT").val();try{if(null!=a&&""!=a){var l=JSON.parse(a);n.find("INPUT.live-video-tool-info").val(JSON.stringify(l)),n.find("li.live-video-tool-edit-name").html(l.name),n.find("li.live-video-tool-edit-length").html(l.size),n.find("li.live-video-tool-edit-time").html(l.time),n.find("div.live-video-tool-edit-selectcontainer").hide(),n.find("div.live-video-tool-edit-changecontainer").show()}}catch(t){}n.find("div.live-video-tool-edit-selectcontainer").unbind().bind(this.EVENTCLICK,function(e){s.VideoTagSelect(t)}),n.find("div.live-video-tool-edit-changecontainer").unbind().bind(this.EVENTCLICK,function(e){s.VideoTagSelect(t)}),n.find("span.live-video-tool-edit-del").unbind().bind(this.EVENTCLICK,function(e){if(s.getCanEdit&&0==s.getCanEdit())return!1;n.remove(),$("#"+t).remove(),s.Record_delete(t,1),s.SetActiveTool(null)}),n.find("span.live-video-tool-edit-save").unbind().bind(this.EVENTCLICK,function(e){$("#"+t).find("INPUT").val(n.find("INPUT.live-video-tool-info").val()),n.remove(),s.Record(!0),s.SetActiveTool(null)}),n.find("span.live-video-tool-edit-cancel").unbind().bind(this.EVENTCLICK,function(t){n.remove(),s.SetActiveTool(null)}),this.SetActiveTool(this)}},this.VideoTagSelect=function(t){s.getCanEdit&&0==s.getCanEdit()||_onSelectVideo&&_onSelectVideo(t,this.VideoTagAfterSelect)},this.VideoTagAfterSelect=function(t,e){console.log("After ToolBooksNote edit:"+t);var i=$("#"+t);if(null==e)s.Delete(),i.remove(),s.SetActiveTool(null);else{var n=s.Record(!0,!1),o=new Object;o.ID=e.ID,o.id=e.ID,$("#"+t).find("INPUT").val(JSON.stringify(o));var r=s.Record(!0);s.onRecordHistory(n,r)}},this.BookNoteEdit=function(e){s.getCanEdit&&0==s.getCanEdit()||t&&t(e)},this.BookNoteMove=function(t){s.getCanEdit&&0==s.getCanEdit()||n&&n(t)},this.BookNoteSelect=function(t){s.getCanEdit&&0==s.getCanEdit()||i&&i(t)},this.BookNoteView=function(t){s.getCanEdit&&0==s.getCanEdit()||e&&e(t)},this.Record=function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e=this.CreateRecordBaseInfo(38);e.LinkID=parseInt($(this.ele).attr("id").replace("BooXNote_",""));var i=parseFloat(this.ele.style.left.replace("px",""))+15,n=parseFloat(this.ele.style.top.replace("px",""))+15;return e.LinkProperty={X:i/this.getContainerWidth(),Y:n/this.getContainerHeight()},e.IsOther="1"==$("#BooXNote_"+e.LinkID).attr("isother")?1:0,e}}function Q(){B.call(this,"ToolLinkArea"),this.Init=function(){},this.Record=function(){var t=this.CreateRecordBaseInfo(40,{x:"x",y:"y",width:"width",height:"height"}),e=$("#"+t.id).attr("info");return e&&(t.info=JSON.parse(c(e))),t}}function q(){B.call(this,"ToolClear");var t=null;this.SetOnBooksNoteDelete=function(e){t=e},this.Record=function(t,e){var i=this.CreateRecordBaseInfo(103);return t&&(i.save=1),i.id=e,this.RecordHandle(i),i},this.ClearPath=function(e){if(e&&e.length>0){for(var i=new Array,n=0;n<e.length;n++){var o=this.Record_delete(e[n],1);i.push(o),$("#"+e[n]).remove()}return i}var r=!1,s=this.target.find(">path[isdraw='true'],>g[isdraw='true'],>circle[isdraw='true']");s.length>0&&(s.remove(),r=!0),this.target.find(">rect[isdraw='true'],>image[isdraw='true']").each(function(t){r=!0,"board"==$(this).attr("tp")&&$("#edit_"+$(this).attr("id")).remove(),$(this).remove()});var a=this.container.find("div.live-video-tool-container,div.live-video-link-tool-container,div.live-sync-tool-container");a.length>0&&(a.remove(),r=!0);var l=this.container.find("div.live-booknote-tool-container");if(l.length>0){l.remove(),r=!0;var d=[];l.each(function(t){"0"==$(this).attr("isother")&&(d.push(parseInt($(this).attr("id").replace("BooXNote_",""))),$(this).remove())}),t&&t({LinkIDs:d})}return r?this.Record(!0,"svg"+this.GetFixedPageNumber(this.pagenumber)):null}}function tt(){B.call(this,"ToolSelect");var t=null,e=!1,i=-1,n=-1,o=-1,r=-1,s=-1,a=-1,l=!1;this.SetOnSelectEle=function(e){t=e},this.onStart=function(t,d){return"undefined"!=typeof GLOBAL_DRIVE_TYPE&&3==GLOBAL_DRIVE_TYPE?(i=t,n=d,o=t,r=d,s=this.main.scrollLeft(),a=this.main.scrollTop(),l=!1,!1):0==this.deviceType&&0!=this.canEdit&&(e=!1,this.target.find("rect[tp='select']").remove(),this.ele=this.CreateEle("rect",{isdraw:"true",tp:"select",style:"stroke:blue;stroke-dasharray:5;stroke-width:1;fill-opacity:0;",width:0,height:0}),this.ele.setAttribute("x",t),this.ele.setAttribute("y",d),this.ele.setAttribute("sx",t),this.ele.setAttribute("sy",d),this.Append(),!1)},this.onMove=function(t,d){if("undefined"!=typeof GLOBAL_DRIVE_TYPE&&3==GLOBAL_DRIVE_TYPE){var h=t-i,c=d-n;return 0==l&&Math.abs(t-o)+Math.abs(d-r)>10?(l=!0,this.main.scrollLeft(Math.max(0,Math.min(s-h,this.main[0].scrollWidth))),this.main.scrollTop(Math.max(0,Math.min(a-c,this.main[0].scrollHeight))),o=t,r=d):1==l&&(l=!1),e=!0,!1}if(0!=this.deviceType||0==this.canEdit)return!1;if(!this.ele)return!1;var p=parseInt(this.ele.getAttributeNode("sx").nodeValue),u=parseInt(this.ele.getAttributeNode("sy").nodeValue);c=d-u;return(h=t-p)>=0&&c>=0?(this.ele.setAttribute("width",h),this.ele.setAttribute("height",c)):h<0&&c<0?(this.ele.setAttribute("x",p+h),this.ele.setAttribute("y",u+c),this.ele.setAttribute("width",-h),this.ele.setAttribute("height",-c)):h>=0&&c<0?(this.ele.setAttribute("y",u+c),this.ele.setAttribute("width",h),this.ele.setAttribute("height",-c)):h<0&&c>=0&&(this.ele.setAttribute("x",p+h),this.ele.setAttribute("width",-h),this.ele.setAttribute("height",c)),!1},this.onEnd=function(t,i){if("undefined"!=typeof GLOBAL_DRIVE_TYPE&&3==GLOBAL_DRIVE_TYPE)return!0;if(0!=this.deviceType||0==this.canEdit)return!1;if(!this.ele)return!1;t=parseInt(this.ele.getAttributeNode("x").nodeValue),i=parseInt(this.ele.getAttributeNode("y").nodeValue);var n=parseInt(this.ele.getAttributeNode("width").nodeValue),o=parseInt(this.ele.getAttributeNode("height").nodeValue);return e=n+o>8,$(this.ele).remove(),this.SelectEle(t,i,n,o),e},this.onClick=function(t,i){return e},this.SelectEleQuick=function(e,i,n,o){var r=this;this.target.find(">path[isdraw='true']").each(function(s){var a=$(this).attr("tp");if(a&&("line"==a||"sline"==a||"brush"==a)){var l=$(this)[0].getBoundingClientRect();r.isIntersectRect(e,i,n,o,l)&&t&&t($(this).attr("id"),1)}})},this.SelectEle=function(e,i,n,o){var r=this,s=function(t,e,i,n){var o=new Object;return o.x1=t,o.x2=i,o.y1=e,o.y2=n,o};this.target.find(">path[isdraw='true']").each(function(a){var l=$(this).attr("tp");if(l&&("line"==l||"sline"==l||"brush"==l)){var d=$(this)[0].getBoundingClientRect(),h=r.main.find(">div")[0];d.y+=$(document).scrollTop()+r.main.scrollTop()-h.offsetTop,d.x+=$(document).scrollLeft()+r.main.scrollLeft()-h.offsetLeft;var c,p,u,g,v,f=s(e,i,e,i+o),y=s(e,i,e+n,i),x=s(e,i+o,e+n,i+o),b=s(e+n,i,e+n,i+o);if(r.isIntersectRect(e,i,n,o,d))for(var w=$(this).attr("d").split("L"),C=-1,S=-1,m=0,T=w.length;m<T;m++){var A=w[m].split(","),E=parseFloat(A[0].replace("M","").replace(" ","")),_=parseFloat(A[1].replace("M","").replace(" ",""));if(m>0){var R=(c=C,p=S,u=E,g=_,v=void 0,(v=new Object).x=Math.min(c,u),v.y=Math.min(p,g),v.width=Math.abs(c-u),v.height=Math.abs(p-g),v);if(r.isInsideRect(e,i,n,o,R)){t&&t($(this).attr("id"),1);break}var P=s(C,S,E,_);if(r.isIntersectLine(P,f)||r.isIntersectLine(P,y)||r.isIntersectLine(P,x)||r.isIntersectLine(P,b)){t&&t($(this).attr("id"),1);break}}C=E,S=_}}})},this.Record=function(t,e){var i=this.CreateRecordBaseInfo(104);return t&&(i.save=1),i.id=e,this.RecordHandle(i),i}}function et(){var t=null,e=null;navigator.userAgent.toLowerCase().indexOf("firefox");this.main=null,this.pagenumber=1,this.VerticalInMiddle=!0,this.ShowError=function(e,i){t&&t(e,i)},this.ShowDownload=function(t,i){e&&e(t,i)},this.SetOnError=function(e){t=e},this.SetOnDownload=function(t){e=t},this.SetMain=function(t){this.main=t},this.SetParamter=function(t,e){this.main=t,this.pagenumber=e},this.SetPageNumber=function(t){this.pagenumber=t,1},this.SetSizeMode=function(t){t},this.SetSizeDiff=function(t){t},this.SetDeviceType=function(t){t},this.SetVerticalInMiddle=function(t){this.VerticalInMiddle=t}}function it(){et.call(this);var t=1,e=1,i="",n=0,o=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?20:10;this.SetPageNumber=function(e){this.pagenumber=e,t=1},this.SetSizeMode=function(t){n=t},this.SetSizeDiff=function(t){o=t},this.SetDeviceType=function(t){t},this.SetUrl=function(t){i=t},this.getViewHeight=function(){return this.main.height()},this.getViewWidth=function(){return this.main.width()},this.GetPdfPageUrl=function(t,e){return t.replace(/\<\d+\>/gi,e)},this.GetPdfCount=function(t){var e=t.match(/\<\d+\>/gi);return e&&0!=e.length?parseInt(e[0].replace(/\<|\>/gi,"")):1},this.AdjustURL=function(t){var e=Math.max(screen.width,screen.height);return(e*=window.devicePixelRatio||1)<=1024?t:e>=1920?t.replace(">.",">_4K."):t.replace(">.",">_2K.")},this.ShowPDF=function(n,o,r,s){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.pagenumber=o,n=this.AdjustURL(n),e=this.GetPdfCount(n),i=n,t=1,this.main?(this.main.empty(),this.ShowImagePageEx(o,function(){r&&r(!0,e)},!1,this.GetPdfPageUrl(n,o),!1,s,a)):r&&r(!1,e)},this.ShowPDFPage=function(t,e,n,o){this.pagenumber=t,this.ShowImagePageEx(t,function(t){e&&e(t)},n,this.GetPdfPageUrl(i,t),o)},this.ShowImagePageEx=function(e,r,s,a,l,d){var h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];$("#pageContainer"+e,this.main).length>0&&$("#pageContainer"+e,this.main).remove();var c=document.createElement("div");c.id="pageContainer"+e,c.className="pageContainer",void 0!==s&&1==s?c.style.display="none":(c.style.display="none",s=!1,t=1,this.pagenumber=e),0==n?(c.style.width=this.getViewWidth()-o+"px",c.style.height=this.getViewHeight()+"px",c.setAttribute("CW",this.getViewWidth()-o),c.innerHTML="<div id='canvas"+e+"'  style='position:absolute;width:100%;top:0px;'><img id='img_"+e+"' style='width:100%;'></div><svg id='svg"+e+"'  style='position:relative;top:0px;left:0px;'  width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>"):1==n?(c.style.width=this.getViewWidth()+"px",c.style.height=this.getViewHeight()+"px",c.setAttribute("CH",this.getViewHeight()),c.innerHTML="<div id='canvas"+e+"'  style='position:absolute;height:100%;top:0px;'><img id='img_"+e+"' style='height:100%;'></div><svg id='svg"+e+"'  style='position:relative;top:0px;left:0px;'  width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>"):2==n&&(c.style.width=this.getViewWidth()-o+"px",c.style.height=this.getViewHeight()+"px",c.setAttribute("CW",this.getViewWidth()-o),c.setAttribute("CH",this.getViewHeight()),c.innerHTML="<div id='canvas"+e+"'  style='position:absolute;width:100%;top:0px;'><img id='img_"+e+"' style='width:100%;height:100%;'></div><svg id='svg"+e+"'  style='position:relative;top:0px;left:0px;'  width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>"),this.main.append(c);var p=$("#img_"+e,this.main)[0],u=this;p&&(p.onload=function(){$("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).attr("showerror","0"),u.pagenumber+""!=$(this).attr("id").replace("img_","")?0==n?$("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).height(u.getViewWidth()*this.height/this.width):1==n&&$("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).width(u.getViewHeight()*this.width/this.height):(h&&u.main.css({opacity:0}),$("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).show(),0==n?$("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).height(this.height):1==n&&$("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).width(this.width),u.CheckZoom(),h&&(u.DisplayInCenter(),u.main.css({opacity:1}))),u.ShowDownload(u.pagenumber,100),d&&d()},p.onerror=function(t){this.src&&this.src.indexOf("_4K.")>0?this.src=this.src.replace("_4K.","_2K."):this.src&&this.src.indexOf("_2K.")>0?this.src=this.src.replace("_2K.","."):($("#"+$(this).attr("id").replace("img_","pageContainer"),u.main).attr("showerror","1"),u.pagenumber+""==$(this).attr("id").replace("img_","")&&(u.ShowError(100,{PageUrl:this.src,DocUrl:i}),u.ShowDownload(u.pagenumber,-1)))},p.src=a),this.CheckZoom(),r&&r(!0),this.ShowDownload(e,0)},this.ZoomIn=function(){var e=t;return e=(1.1*e).toFixed(2),e=Math.ceil(10*e)/10,e=Math.min(5,e),t=e,this.SizeChanged(e),e},this.ZoomOut=function(){var e=t;return e=(e/1.1).toFixed(2),e=Math.floor(10*e)/10,e=Math.max(.2,e),t=e,this.SizeChanged(e),e},this.SizeChanged=function(e){if(t=e,this.main){if(0==n){var i=this.getViewWidth()*e;1==e&&(i-=10),$("#pageContainer"+this.pagenumber,this.main).css({width:i}).attr("CW",i),$("#canvas"+this.pagenumber,this.main).width(i),$("#pageContainer"+this.pagenumber,this.main).height($("#img_"+this.pagenumber,this.main).height())}else if(1==n){i=this.getViewHeight()*e;1==e&&(i-=10),$("#pageContainer"+this.pagenumber,this.main).css({height:i}).attr("CH",i),$("#canvas"+this.pagenumber,this.main).height(i),$("#pageContainer"+this.pagenumber,this.main).width($("#img_"+this.pagenumber,this.main).width())}this.CheckZoom()}},this.CheckZoom=function(){if(this.VerticalInMiddle){var t=this.main.height(),e=$("#pageContainer"+this.pagenumber,this.main).height();if(e<t){var i=(t-e)/2;i>10&&i<=20?i-=5:i>20&&i<=50?i-=10:i>50&&(i-=20),$("#pageContainer"+this.pagenumber,this.main).css("top",i+"px"),$("#pageContainer"+this.pagenumber,this.main).find("div.boardhead").css("top",(t-e)/2+"px")}else $("#pageContainer"+this.pagenumber,this.main).css("top",""),$("#pageContainer"+this.pagenumber,this.main).find("div.boardhead").css("top","")}},this.DisplayInCenter=function(){var t=this.main.height(),e=$("#pageContainer"+this.pagenumber,this.main).height();e>t&&this.main.scrollTop((e-t)/2)},this.GetScale=function(){return t}}Object.setPrototypeOf(y.prototype,f.prototype),Object.setPrototypeOf(x.prototype,f.prototype),Object.setPrototypeOf(b.prototype,f.prototype),Object.setPrototypeOf(w.prototype,f.prototype),Object.setPrototypeOf(C.prototype,f.prototype),Object.setPrototypeOf(S.prototype,f.prototype),Object.setPrototypeOf(m.prototype,f.prototype),Object.setPrototypeOf(T.prototype,f.prototype),Object.setPrototypeOf(A.prototype,f.prototype),Object.setPrototypeOf(E.prototype,f.prototype),Object.setPrototypeOf(_.prototype,f.prototype),Object.setPrototypeOf(R.prototype,f.prototype),Object.setPrototypeOf(P.prototype,f.prototype),Object.setPrototypeOf(I.prototype,f.prototype),Object.setPrototypeOf(k.prototype,f.prototype),Object.setPrototypeOf(function(t){f.call(this,"PlayChangePage",t),this.Play=function(){console.log(this.name+":Play not done")}}.prototype,f.prototype),Object.setPrototypeOf(W.prototype,f.prototype),Object.setPrototypeOf(O.prototype,f.prototype),Object.setPrototypeOf(z.prototype,f.prototype),Object.setPrototypeOf(L.prototype,f.prototype),Object.setPrototypeOf(N.prototype,f.prototype),Object.setPrototypeOf(V.prototype,f.prototype),Object.setPrototypeOf(F.prototype,f.prototype),Object.setPrototypeOf(function(){B.call(this,"ToolPen");var t=1,e="#ff0000",i=[0,0];this.Init=function(){0==this.deviceType&&this.target&&this.target.css({cursor:"url('"+this.ImagePath+"pencil.cur'),default"})},this.onStart=function(n,o){this.ele=this.CreateEle("path",{isdraw:"true",tp:"line",style:"fill:white;fill-opacity:0;stroke-linecap:round;","stroke-width":t,stroke:e}),this.ele.setAttribute("d","M"+n+","+o),i=[n,o],this.Append(),this.Record()},this.onMove=function(n,o){if(i[0]==n&&i[1]==o)return!0;i=[n,o];var r=this.ele.getAttributeNode("d").nodeValue;if(r.length>7870){var s=this.Record(!0);this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(s.id),s),this.ele=this.CreateEle("path",{isdraw:"true",tp:"line",style:"fill:white;fill-opacity:0;stroke-linecap:round;","stroke-width":t,stroke:e}),this.ele.setAttribute("d","M"+this.getLastNode(r)+" L"+n+","+o),this.Append(),this.Record()}else this.ele.setAttribute("d",r+" L"+n+","+o);return this.CheckRecordStep(n,o)&&this.Record(),!0},this.onEnd=function(t,e){var i=this.ele.getAttributeNode("d").nodeValue;-1==i.indexOf("L")&&this.ele.setAttribute("d",i+" L"+i.substr(i.indexOf("M")+1));var n=this.Record(!0);return this.onRecordHistory&&this.onRecordHistory(this.RecordHistory_delete(n.id),n),!0},this.Record=function(t){var e=this.CreateRecordBaseInfo(21,{d:"d",w:"stroke-width",color:"stroke",op:"stroke-opacity"});return t&&(e.save=1),e.tar="",this.RecordHandle(e),e},this.SetOption=function(i){i&&(i.Size&&(t=i.Size),i.Color&&(e=i.Color))},this.ShowSetting=function(i,n){this.ShowColorSizeSetting(t,e,i,!1,"",n)},this.AfterSelectSizeSetting=function(e){t=e,this.onToolSetting&&this.onToolSetting({SettingID:5001,Text:e+""})},this.AfterSelectColorSetting=function(t){e=t,this.onToolSetting&&this.onToolSetting({SettingID:5002,Text:t})}}.prototype,B.prototype),Object.setPrototypeOf(H.prototype,B.prototype),Object.setPrototypeOf(D.prototype,B.prototype),Object.setPrototypeOf(M.prototype,B.prototype),Object.setPrototypeOf(G.prototype,B.prototype),Object.setPrototypeOf(U.prototype,B.prototype),Object.setPrototypeOf(j.prototype,B.prototype),Object.setPrototypeOf(K.prototype,B.prototype),Object.setPrototypeOf(J.prototype,B.prototype),Object.setPrototypeOf(Z.prototype,B.prototype),Object.setPrototypeOf(Y.prototype,B.prototype),Object.setPrototypeOf(X.prototype,B.prototype),Object.setPrototypeOf(Q.prototype,B.prototype),Object.setPrototypeOf(q.prototype,B.prototype),Object.setPrototypeOf(tt.prototype,B.prototype),Object.setPrototypeOf(function(){et.call(this);var t=0,e=1,i="",n=null;this.SetSizeMode=function(e){t=e},this.ShowPDF=function(t,o,r,s,a){var l=this;this.pagenumber=o,i=t,this.main?(this.main.empty(),PDFJS.getDocument(t,null,null,function(t){a&&a(t.loaded/t.total)}).then(function(t){n=t,e=t.numPages,l.ShowImagePageEx(o,function(t){0!=t?(AfterLoadPDF&&AfterLoadPDF(o),r&&r(!0)):r&&r(!1)},!1,t,!0,s)},function(t){"Loading aborted"!=t.message&&r&&r(!1)})):r&&r(!1,e)},this.ShowPDFPage=function(t,e,n,o){this.pagenumber=t,this.ShowImagePageEx(t,function(t){e&&e(t)},n,this.GetPdfPageUrl(i,t),o)},this.ShowImagePageEx=function(e,o,r,s,a,l){if(null==n&&s&&(n=s),null!=n){void 0===a&&(a=!1),n.getPage(e).then(function(t){var i=window.devicePixelRatio||1,n=t.getViewport(i),r=document.getElementById("canvas"+e),s=r.getContext("2d");r.height=n.height,r.width=n.width;var l={canvasContext:s,viewport:n};t.render(l).then(function(){1==a&&IsToolBarShow&&Record_view(),o&&o(!0)},function(t){PDFRender=null,"cancelled"!=t&&o&&o(!1)})}),$("#pageContainer"+e).length>0&&$("#pageContainer"+e).remove();var d=document.createElement("div");d.id="pageContainer"+e,d.className="pageContainer",void 0!==r&&1==r?d.style.display="none":(r=!1,this.pagenumber=e),0==t?(d.style.width=this.getViewWidth()-_sizeDiff+"px",d.style.height=this.getViewHeight()+"px",d.setAttribute("CW",this.getViewWidth()-_sizeDiff),d.innerHTML="<canvas id='canvas"+e+"'  style='position:absolute;width:100%;top:0px;'></canvas><svg id='svg"+e+"'  style='position:relative;top:0px;left:0px;'  width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>"):1==t?(d.style.width=this.getViewWidth()+"px",d.style.height=this.getViewHeight()+"px",d.setAttribute("CH",this.getViewHeight()),d.innerHTML="<canvas id='canvas"+e+"'  style='position:absolute;height:100%;top:0px;'></canvas><svg id='svg"+e+"'  style='position:relative;top:0px;left:0px;'  width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>"):2==t&&(d.style.width=this.getViewWidth()-_sizeDiff+"px",d.style.height=this.getViewHeight()+"px",d.setAttribute("CW",this.getViewWidth()-_sizeDiff),d.setAttribute("CH",this.getViewHeight()),d.innerHTML="<canvas id='canvas"+e+"'  style='position:absolute;width:100%;top:0px;'></canvas><svg id='svg"+e+"'  style='position:relative;top:0px;left:0px;'  width='100%' height='100%' version='1.1' xmlns='http://www.w3.org/2000/svg' xlink='http://www.w3.org/1999/xlink'></svg>"),this.main.append(d),this.CheckZoom(),o&&o(!0)}else""!=i&&ShowPDFFile(i,e,null,o,l)}}.prototype,et.prototype),Object.setPrototypeOf(it.prototype,et.prototype),e.default=function(){var t=this,e=null,i="",n=null,o=null,s=null,l=null,d=null,h=null,c=null,p=null,u=null,v=null,f=null,B=null,et=null,nt=null,ot=null,rt=null,st=null,at=null,lt=null,dt=null,ht=0,ct=1,pt="",ut=0,gt="pointerdown",vt="pointermove",ft="mouseup pointerup",yt="pointerleave",xt=null,bt=null,wt=!1,Ct=!1,St=0,mt=new it,Tt=!0,At=!1,Et=new Array,_t=null,$t=null,Rt=[0,0],Pt=!1,It=0,kt=new Array,Wt=new Array,Ot=new Array,zt=null,Lt=new g;function Nt(t){if(!o)return!1;var e=t.originalEvent;if(e.touches&&e.touches.length>1)return!1;if(void 0!==e.isPrimary&&0==e.isPrimary)return!1;var i=$(e.target);return!("media-header"==i.attr("id")||"media-panel-actions"==i.attr("id")||"svg"!=i[0].tagName.toLowerCase()&&"svg"!=i.parent()[0].tagName.toLowerCase()||e.pointerType&&"mouse"==e.pointerType&&(void 0!==e.buttons&&0==e.buttons||1!=e.button&&0!=e.button&&-1!=e.button))}function Vt(t){return t.originalEvent.touches&&t.originalEvent.touches.length>0?t.originalEvent.touches[0]:t.originalEvent}function Ft(){return $(document).scrollTop()-s[0].getBoundingClientRect().top}function Bt(){return $(document).scrollLeft()-s[0].getBoundingClientRect().left}function Ht(t){var e=Vt(t),i=Bt(),n=Ft();return{x:Dt((0|e.clientX)-0+i),y:Dt((0|e.clientY)-0+n)}}function Dt(t){return Math.round(t)}function Mt(t,e){return xt.onMove(t,e)}function Gt(t,e){return xt.onEnd(t,e)}function Ut(){Ct=!1,n&&n.unbind(gt+" "+ft)}function jt(){n&&(Ct=!0,n.unbind(gt+" "+ft).bind(gt,function(t){if(Nt(t)){Pt=!0;var e,i,n=Ht(t);return e=n.x,i=n.y,xt.ShowSetting(!1),xt.onStart(e,i)?(t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),!1):void 0}}).bind(ft,function(t){if(0!=Pt){var e=Ht(t);return Pt=!1,Gt(e.x,e.y)?(t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),!1):void 0}}).bind(vt,function(t){if(Nt(t)&&0!=Pt){var e=Ht(t);return Mt(e.x,e.y)?(t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),!1):void 0}}).bind(yt,function(t){if(0!=Pt){var e=Ht(t);return Pt=!1,Gt(e.x,e.y)?(t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),!1):void 0}}))}function Kt(){zt&&(clearTimeout(zt),zt=null),zt=setTimeout(function(){ae(),xt&&xt.ShowSetting(!1)},200)}function Jt(t){var i=Ht(t);if(d=i.x,h=i.y,$("#WBTool_Setting")&&$("#WBTool_Setting").remove(),xt&&xt.onClick(d,h))return t.originalEvent.preventDefault(),t.originalEvent.stopPropagation(),!1;var r=$(t.originalEvent.target);if(""!=e||!Tt||"true"!=r.attr("isdraw")||"line"!=r.attr("tp")&&"sline"!=r.attr("tp")&&"brush"!=r.attr("tp"))""==e&&Tt&&!r.is("path,rect,image")&&(r.is("svg")&&$("image[tp='note']").trigger("STRINK"),qt());else{var a=r.attr("class");a&&""!=a?(r.removeAttr("class"),Qt(r.attr("id")),de(r.attr("id"),0)):Yt(r.attr("id"))}var l,d,h,c=function(t){if(!wt)return null;var e=$(t.originalEvent.target),i=Ht(t),o=new Object;return o.type=35,o.poz=[i.x,i.y],"svg"==e[0].tagName.toLowerCase()?0==e.attr("id").indexOf("svg_")?o.bd=1:o.bd=0:e.parent()[0]&&"svg"==e.parent()[0].tagName.toLowerCase()&&0==e.parent().attr("id").indexOf("svg_")?o.bd=1:o.bd=0,o.page=ht,o.VW=oe(),o.CW=ee(),o.ST=0|n.scrollTop(),o.SL=0|n.scrollLeft(),re(o),o}(t);""==e&&Tt&&c&&((l=new k(c)).SetParamter(o,s,n,ht,St),l.SetCanEdit(Tt),l.Play())}function Zt(t){var e=null;switch(t){case"ToolPen":e=new H;break;case"ToolLine":e=new M;break;case"ToolBrush":e=new G;break;case"ToolText":e=new U;break;case"ToolNote":e=new j;break;case"ToolBoard":e=new K;break;case"ToolVideo":e=new J;break;case"ToolVideoLink":e=new Z;break;case"ToolBooksNote":e=new X;break;case"ToolSync":e=new Y;break;case"ToolClear":e=new q;break;case"ToolDotPan":e=new D;break;case"ToolLinkArea":e=new Q;break;case"":e=new tt;break;default:e=null}return e}function Yt(t,e){var i=$("#"+t),n=r(t).getBBox();n.width+n.height<10?i.attr("class","WB_SelectPathSmall"):i.attr("class","WB_SelectPath"),Xt(t),de(t,1)}function Xt(t){-1==a(kt,t)&&kt.push(t)}function Qt(t){var e=a(kt,t);e>-1&&kt.splice(e,1)}function qt(){for(var t=0,e=kt.length;t<e;t++)$("#"+kt[t]).removeAttr("class"),de(kt[t],0);kt=[]}function te(){Wt=[],Ot=[]}function ee(){return s.width()}function ie(){return s.height()}function ne(){return n.height()}function oe(){return n.width()}function re(t){wt&&l&&(ut&&0!=ut&&!t.atmid&&(t.atmid=ut),l(t))}function se(t,e){d&&d({Code:t,Data:e})}function ae(){if(s&&n){var t=new Object;t.type=32,t.page=ht,t.CW=ee(),t.CH=ie(),t.VW=oe(),t.VH=ne(),t.ST=0|n.scrollTop(),t.SL=0|n.scrollLeft(),re(t)}}function le(t){var e=new Object;e.type=2,e.page=t,re(e)}function de(t,e){var i=new Object;i.type=104,i.id=t,i.page=ht,i.stat=e,re(i)}function he(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(wt){var i,n,o,r=Ht(t);At=!0,_t&&(clearTimeout(_t),_t=null),$t&&(clearTimeout($t),$t=null),1==e?(Et.push([r.x,r.y]),ce(10,!0,0)):(i=r.x,n=r.y,(o=Math.abs(i-Rt[0])+Math.abs(n-Rt[1])>=60)&&(Rt=[i,n]),o&&(Et.push([r.x,r.y]),ce(10,!0,0)))}}function ce(t,e,i){if(!(Et.length<1)){var o=new Object;if(o.type=34,o.show=1,o.sleep=t,o.bd=i,1==e){var r=Et.splice(0,Et.length);r.length>1&&r.splice(0,r.length-1),o.poz=r,o.delay=1}else o.delay=1,o.poz=Et.splice(0,Et.length);o.page=ht,o.VW=oe(),o.CW=ee(),o.ST=0|n.scrollTop(),o.SL=0|n.scrollLeft(),re(o)}}function pe(t){wt&&At&&($t&&(clearTimeout($t),$t=null),$t=setTimeout(function(){At=!1;var t=new Object;t.type=34,t.show=0,t.page=ht,re(t)},50))}function ue(t){if(null==dt||0==dt.length)return null;if("ToolPen"==t){var e=ge(5001),i=ge(5002);return{Size:e?parseInt(e):null,Color:i}}if("ToolLine"==t){var n=ge(5003),o=ge(5004);return{Size:n?parseInt(n):null,Color:o}}if("ToolBrush"==t){var r=ge(5005),s=ge(5006);return{Size:r?parseInt(r):null,Color:s}}if("ToolText"==t){var a=ge(5007),l=ge(5008),d=ge(5009);return{Size:a?parseInt(a):null,Color:l,Font:d}}if("ToolNote"==t){var h=ge(5010),c=ge(5011),p=ge(5012);return{Size:h?parseInt(h):null,Color:c,Font:p}}return null}function ge(t){if(null==dt||0==dt.length)return null;var e=!0,i=!1,n=void 0;try{for(var o,r=dt[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var s=o.value;if(s.SettingID==t)return s.Text}}catch(t){i=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(i)throw n}}return null}function ve(t){return Lt?Lt.get(t):null}this.ResumeTool=function(){xt&&(jt(),xt.SetParamter(this.OnReocrd,o,s,n,ht,St,this.OnSetTool,this.OnSetActiveTool,this.OnRecordHistory),xt.SetCanEdit(Tt))},this.OnSetTool=function(e){c&&c(e),t.SetDrawTool(e)},this.OnSetActiveTool=function(t){bt=t},this.OnRecordHistory=function(t,e){0==Wt.length&&st&&st(1,Ot.length>0?1:0),Wt.push({Undo:t,Redo:e})},this.OnSelectEle=function(t,e){0==e?($("#"+t).removeAttr("class"),Qt(t),de(t,0)):Yt(t)},this.OnReocrd=function(t){re(t)},this.OnEditText=function(e,i){var r=new U;r.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),r.SetEle(e[0]),r.SetCanEdit(Tt),r.SetCanEditFun(t.GetCanEdit),r.SetOnError(se),r.SetOnToolSetting(t.OnToolSetting),r.SetOption(ue("ToolText")),r.ToEditMode(e.attr("id"),i),t.OnSetTool("")},this.OnEditNote=function(e,i){var a=new j;a.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),a.SetEle(r(e)),a.SetCanEdit(Tt),a.SetCanEditFun(t.GetCanEdit),a.SetOnError(se),a.SetOnToolSetting(t.OnToolSetting),a.SetOption(ue("ToolNote")),a.EditAnnotation($("#g_"+e),i),t.OnSetTool("")},this.OnEditVideo=function(e,i,r,a){var l=new J;l.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),l.SetCanEdit(Tt),l.SetCanEditFun(t.GetCanEdit),l.SetOnError(se),l.SetOnToolSetting(t.OnToolSetting),l.SetOnSelectVideo(t.ToolVideoOnSelectVideo),l.SetOnVideoPlay(t.ToolVideoOnVideoPlay),l.VideoTagAction(e,i,r,a)},this.OnEditVideoLink=function(e,i,r,a){var l=new Z;l.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),l.SetCanEdit(Tt),l.SetCanEditFun(t.GetCanEdit),l.SetOnError(se),l.SetOnToolSetting(t.OnToolSetting),l.SetOnSelectVideoLink(t.ToolVideoLinkOnSelectVideoLink),l.SetOnVideoLinkPlay(t.ToolVideoLinkOnVideoLinkPlay),l.VideoLinkTagAction(e,i,r,a)},this.OnEditBooksNote=function(e){var i=new X;i.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),i.SetCanEdit(Tt),i.SetCanEditFun(t.GetCanEdit),i.SetOnError(se),i.SetOnToolSetting(t.OnToolSetting),i.SetOnBooksNoteEdit(ve("BookNoteEdit")),i.SetOnBooksNoteSelect(ve("BookNoteSelect")),i.SetOnBooksNoteView(ve("BookNoteView")),i.SetOnBooksNoteMove(ve("BookNoteMove")),i.VideoTagAction(e)},this.OnEditSync=function(e,i,r,a){var l=new Y;l.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),l.SetCanEdit(Tt),l.SetCanEditFun(t.GetCanEdit),l.SetOnError(se),l.SetOnToolSetting(t.OnToolSetting),l.SetOnSelectSync(t.ToolSyncOnSelectSync),l.SetOnSyncPlay(t.ToolSyncOnSyncPlay),l.SetOnSyncEdit(t.ToolSyncOnSyncEdit),l.VideoTagAction(e,i,r,a)},this.OnEditBoard=function(e,i,r){var a=new K;a.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),a.SetCanEdit(Tt),a.SetCanEditFun(t.GetCanEdit),a.SetOnError(se),a.SetOnToolSetting(t.OnToolSetting),a.SetEle(e),a.SetOnDisplayChange(B),a.EditWhiteBoard(i,r),t.OnSetTool("")},this.OnRecordNote=function(e){var i=new j;i.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),i.SetEle(e),i.Record(!0)},this.OnRecordBoard=function(e,i,r){var a=new K;a.SetParamter(t.OnReocrd,o,s,n,ht,St,t.OnSetTool,t.OnSetActiveTool,t.OnRecordHistory),a.SetEle(e),a.Record(i,r)},this.OnZoomChange=function(e,i){var n=t.GetPageInfo();t.Clear(),e=mt.SizeChanged(e);var o=!0,r=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var d=a.value;t.Play(d)}}catch(t){r=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}i&&i()},this.OnToolSetting=function(t){if(lt&&lt(t),null==dt&&(dt=[]),0==dt.length)dt.push(t);else{var e=!1,i=!0,n=!1,o=void 0;try{for(var r,s=dt[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;a.SettingID==t.SettingID&&(a.Text=t.Text,e=!0)}}catch(t){n=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}e||dt.push(t)}},this.OnLinkAreaClick=function(t){var e=ve("OnLinkAreaClick");e&&e(t)},this.ToolVideoOnVideoPlay=function(t,e){Tt&&et&&et(t,e)},this.ToolVideoLinkOnVideoLinkPlay=function(t){Tt&&nt&&nt(t)},this.ToolSyncOnSyncPlay=function(t,e){Tt&&ot&&ot(t,e)},this.ToolSyncOnSyncEdit=function(t,e,i,n){Tt&&rt&&rt(t,e,i,n)},this.ToolVideoOnSelectVideo=function(t,e){Tt&&u&&u(t,e)},this.ToolVideoLinkOnSelectVideoLink=function(t,e,i){Tt&&v&&v(t,e,i)},this.ToolSyncOnSelectSync=function(t,e){Tt&&f&&f(t,e)},this.GetCanEdit=function(){return Tt},this.SetRecord=function(t){wt=t},this.SetDeviceType=function(t){St=t,0!=t&&(gt="touchstart",vt="touchmove",ft="touchend",yt="touchcancel",mt.SetSizeDiff(0),mt.SetDeviceType(t))},this.SetSizeMode=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];It=t,mt.SetSizeMode(t),e&&function(t){if(wt){var e=new Object;e.type=4,e.page=ht,e.mode=t,re(e)}}(t),i?this.RefreshDocument(function(){at&&at(t)}):at&&at(t)},this.SetVerticalInMiddle=function(t){mt.SetVerticalInMiddle(t)},this.ShowSetting=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;xt&&xt.ShowSetting(t,e)},this.OnToolStart=function(t,e){xt&&xt.onStart(t-Bt(),e-Ft())},this.OnToolMove=function(t,e){xt&&xt.onMove(t-Bt(),e-Ft())},this.OnToolEnd=function(t,e){xt&&xt.onEnd(t-Bt(),e-Ft())},this.ShowSelectToolSetting=function(t){return!(!bt||bt.name!=t||(bt.ShowSetting(!0),bt.SetActive(),0))},this.ShowDotpenLine=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=new b({Lines:t,Width:e,Height:i});if(a&&d.SetOnClick(this.OnLinkAreaClick),d.SetParamter(o,s,n,ht,St),l?d.PlayLinesEx():d.PlayLines(),r){var h=d.GetLastLine();h&&(n.unbind("scroll",Kt),1==St||2==St?function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var e=t.getBoundingClientRect(),i=n.scrollTop(),o=n.scrollLeft(),r=oe(),s=ne(),a=e.x>0&&e.y>0&&e.x+e.width<r&&e.y+e.height<s;a||(e.x<=0||e.y<=0?(e.x<=0&&n.scrollLeft(Math.max(0,o+e.x-5)),e.y<=0&&n.scrollTop(Math.max(0,i+e.y-5))):(e.x+e.width>=r&&n.scrollLeft(Math.max(ee()-r,o+(e.x+e.width-r)+5)),e.y+e.height>=s&&n.scrollTop(Math.min(ie()-s,i+(e.y+e.height-s)+5))))}(h,!0):h.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),setTimeout(function(){n.bind("scroll",Kt)},10))}},this.PlayDotpenLine=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=new b({Lines:t,Width:e,Height:i});l.SetParamter(o,s,n,ht,St),l.PlayLinesSync(r>0?r/1e3:0,a>0?a/1e3:0)},this.PlayDotpenLineTo=function(t,e,i,r){var a=new b({Lines:t,Width:e,Height:i});a.SetParamter(o,s,n,ht,St),a.PlayLinesSync(r)},this.SetDrawTool=function(t,r){if(Tt&&n&&0!=n.length)if(e=t,""!=t&&(i=t),xt=Zt(t)){xt.SetParamter(this.OnReocrd,o,s,n,ht,St,this.OnSetTool,this.OnSetActiveTool,this.OnRecordHistory),xt.SetCanEdit(Tt),xt.SetCanEditFun(this.GetCanEdit),xt.SetOnError(se),xt.SetOnToolSetting(this.OnToolSetting),xt.SetOption(ue(t)),"ToolVideo"==t?(xt.SetOnSelectVideo(this.ToolVideoOnSelectVideo),xt.SetOnVideoPlay(this.ToolVideoOnVideoPlay)):"ToolVideoLink"==t?(xt.SetOnSelectVideoLink(this.ToolVideoLinkOnSelectVideoLink),xt.SetOnVideoLinkPlay(this.ToolVideoLinkOnVideoLinkPlay)):"ToolSync"==t?(xt.SetOnSelectSync(this.ToolSyncOnSelectSync),xt.SetOnSyncPlay(this.ToolSyncOnSyncPlay),xt.SetOnSyncEdit(this.ToolSyncOnSyncEdit)):"ToolBoard"==t?xt.SetOnDisplayChange(B):"ToolBooksNote"==t?(xt.SetOnBooksNoteEdit(ve("BookNoteEdit")),xt.SetOnBooksNoteSelect(ve("BookNoteSelect")),xt.SetOnBooksNoteView(ve("BookNoteView")),xt.SetOnBooksNoteView(ve("BookNoteMove"))):""==t&&xt.SetOnSelectEle(this.OnSelectEle);var a=!1,l=$._data(n[0],"events");if(l&&l[gt]&&(a=!0),Ct&&a||jt(),"ToolClear"==t){if(kt.length>0){var d=this.GetPageInfo($("#"+kt.join(",#")));null!=(h=xt.ClearPath(kt))&&this.OnRecordHistory(d,h),kt=[]}else if(bt&&1==bt.Delete())bt=null;else{if(!confirm("确定清空页面上所有标注?"))return void this.OnSetTool("");var h;d=this.GetPageInfo(),xt.SetOnBooksNoteDelete(ve("BookNoteDelete")),null!=(h=xt.ClearPath())&&this.OnRecordHistory(d,h)}this.OnSetTool("")}c&&c(t)}else Ut();else Tt||(0==St&&o&&o.css({cursor:"default"}),Ut())},this.Clear=function(){o&&(o.find(">path[isdraw='true'],>g[isdraw='true'],>circle[isdraw='true']").remove(),o.find(">rect[isdraw='true']").each(function(t){"board"==$(this).attr("tp")&&$("#edit_"+$(this).attr("id"),n).remove(),$(this).remove()})),s&&(s.find("div.live-video-tool-container,div.live-booknote-tool-container, div.live-video-link-tool-container, div.live-sync-tool-container").remove(),s.find("div.liveMouseClick,div.liveMouse").remove())},this.ClearAll=function(){this.Clear(),n&&n.find(">div.pageContainer[id!='pageContainer"+ht+"']").remove()},this.Init=function(t,e,i,r){n=e,o=t,s=i,ht=r,mt.SetMain(e)},this.OnReceviceData=function(t){l=t},this.OnError=function(t){d=t,mt.SetOnError(se)},this.OnDownload=function(t){h=t,mt.SetOnDownload(t)},this.OnToolReset=function(t){c=t},this.SwitchLastTool=function(){""==i?e&&""!=e&&(this.SetDrawTool(e),c&&c(e)):e&&""!=e?(this.SetDrawTool(""),c&&c("")):(this.SetDrawTool(i),c&&c(i))},this.Play=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"==typeof t&&(t=JSON.parse(t)),!pt||""==pt)return se(6,t),6;if(0!=ut&&t.atmid&&0!=t.atmid&&t.atmid!=ut)return e&&se(3,t),3;if(2!=t.type&&t.page&&0!=t.page&&t.page!=ht)return e&&se(1,t),1;e&&2!=t.type&&!$("#pageContainer"+ht,n).is(":visible")&&("1"==$("#pageContainer"+ht,n).attr("showerror")?se(4,t):se(5,t));var i=null;switch(t.type){case 1:break;case 2:return void this.ToPage(t.page,null,!0);case 3:break;case 4:return void this.SetSizeMode(t.mode,!1);case 21:i=new y(t);break;case 22:i=new x(t);break;case 24:i=new C(t);break;case 25:i=new S(t);break;case 26:(i=new T(t)).SetOnEdit(this.OnEditNote),i.SetOnRecord(this.OnRecordNote);break;case 27:(i=new A(t)).SetOnEdit(this.OnEditBoard),i.SetOnRecord(this.OnRecordBoard);break;case 28:(i=new m(t)).SetOnEdit(this.OnEditText);break;case 32:(i=new W(t,mt.GetScale(),It)).SetOnZoom(this.OnZoomChange);break;case 33:(i=new E(t)).SetOnEdit(this.OnEditVideo);break;case 34:i=new I(t);break;case 35:i=new k(t);break;case 36:(i=new P(t)).SetOnEdit(this.OnEditSync);break;case 37:(i=new R(t)).SetOnEdit(this.OnEditVideoLink);break;case 38:(i=new _(t)).SetOnEdit(this.OnEditBooksNote);break;case 39:i=new b(t);break;case 40:(i=new w(t)).SetOnClick(this.OnLinkAreaClick);break;case 101:i=new O(t);break;case 102:i=new z(t);break;case 103:i=new L(t);break;case 104:i=new N(t),1==t.stat?Xt(t.id):Qt(t.id);break;case 201:i=new V(t);break;case 202:i=new F(t)}return i?(i.SetParamter(o,s,n,ht,St),i.SetCanEdit(Tt),32==t.type?(n.unbind("scroll",Kt),i.Play(),setTimeout(function(){n.bind("scroll",Kt)},10)):i.Play(),0):(se(2,t),2)},this.ShowDocument=function(t,e,i,r){var a=this,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e&&""!=e?(Ut(),te(),n=t,ht=parseInt(i),mt.SetMain(t),mt.ShowPDF(e,i,function(t,d){pt=e,ut=parseInt(l),ct=d,o=$("#svg"+i,n),s=$("#pageContainer"+i,n),a.SetDrawTool(""),r&&r(t,d),t&&p&&p(i,2)},null,d),n.unbind("scroll",Kt).unbind("mousemove",he).unbind("mouseout",pe).unbind("click",Jt),n.bind("scroll",Kt).bind("mousemove",he).bind("mouseout",pe).bind("click",Jt)):r&&r(!1,1)},this.RefreshDocument=function(t){var e=this;if(""!=pt&&s&&n){var i=ht;qt(),Ut();var r=this.GetPageInfo();mt.ShowPDF(pt,i,function(t,r){o=$("#svg"+i,n),s=$("#pageContainer"+i,n),e.ResumeTool();var a=ve("AfterRefreshDocument");a&&a(ut)},function(){var n=!0,o=!1,s=void 0;try{for(var a,l=r[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var d=a.value;e.Play(d)}}catch(t){o=!0,s=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw s}}t&&t(!0,i)})}else t&&t(!1,ht)},this.ClearDocument=function(){""!=pt&&s&&n&&n.html("")},this.GetPageInfo=function(t){var e=o,i=new Array;if(!t){if(!e)return i;t=e.find(">path,>rect,>circle")}return t.each(function(t){var e=$(this).attr("tp"),r=null,a=null;if("line"==e)a=Zt("ToolPen");else if("sline"==e)a=Zt("ToolLine");else if("dotpan"==e)a=Zt("ToolDotPan");else if("brush"==e)a=Zt("ToolBrush");else if("text"==e)a=Zt("ToolText");else if("note"==e)a=Zt("ToolNote");else if("board"==e)a=Zt("ToolBoard");else{if("linkarea"!=e)return;a=Zt("ToolLinkArea")}if(a.SetEle($(this)[0]),a.SetParamter(null,o,s,n,ht,null),"board"==e){var l=$(this).attr("id");r=$("#edit_"+l,n).is(":visible")?a.Record(!1,1):a.Record(!1)}else r=a.Record(!1);a.Destroy(),i.push(r),"board"==e&&(l=$(this).attr("id"),$("#div_"+l,n).find(">svg").find(">path").each(function(t){if("line"==$(this).attr("tp")){var e=Zt("ToolPen");e.SetEle($(this)[0]),e.SetParamter(null,o,s,n,ht,null);var r=e.Record(!1);e.Destroy(),r.tar="div_"+l,i.push(r)}}))}),s.find("div.live-video-tool-container").each(function(t){var e=Zt("ToolVideo");e.SetEle($(this)[0]),e.SetParamter(null,o,s,n,ht,null);var r=e.Record(!1);i.push(r)}),s.find("div.live-booknote-tool-container").each(function(t){var e=Zt("ToolBooksNote");e.SetEle($(this)[0]),e.SetParamter(null,o,s,n,ht,null);var r=e.Record(!1);i.push(r)}),s.find("div.live-video-link-tool-container").each(function(t){var e=Zt("ToolVideoLink");e.SetEle($(this)[0]),e.SetParamter(null,o,s,n,ht,null);var r=e.Record(!1);i.push(r)}),s.find("div.live-sync-tool-container").each(function(t){var e=Zt("ToolSync");e.SetEle($(this)[0]),e.SetParamter(null,o,s,n,ht,null);var r=e.Record(!1);i.push(r)}),i},this.ClearBookNote=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s&&(0==t&&0==e||(1==t&&1==e?s.find("div.live-booknote-tool-container").remove():t?s.find("div.live-booknote-tool-container[isother='0']").remove():s.find("div.live-booknote-tool-container[isother='1']").remove()))},this.ClearByType=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;40==t?o&&o.find(">rect[tp='linkarea']").remove():39==t&&o&&o.find(">path[tp='dotpan']").remove()},this.TwinkleBookNote=function(t){0!=$("#BooXNote_"+t,n).length&&($("#BooXNote_"+t,n)[0].scrollIntoView({behavior:"auto",block:"center",inline:"nearest"}),$("#BooXNote_"+t,n).addClass("WB_BookNoteTwinkle"),setTimeout(function(){$("#BooXNote_"+t,n).removeClass("WB_BookNoteTwinkle")},1e3))},this.GetAtmID=function(){return ut},this.NextPage=function(t){var e=this;if(!s||ht>=ct)t&&t(!1,-1);else{if(s.hide(),ht>1&&"0"!=$("#pageContainer"+(ht-1),n).attr("showerror")){var i=$("#img_"+(ht-1),n);i[0]&&(i[0].onload=null,i[0].onerror=null),i.attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg"),$("#pageContainer"+(ht-1),n).remove()}var r=parseInt(ht)+1;if(Ut(),qt(),te(),$("#pageContainer"+r,n).length>0){mt.SetPageNumber(r),ht=r,o=$("#svg"+r,n);var a=-1;if("0"==(s=$("#pageContainer"+r,n)).attr("showerror"))a=100,s.show();else{var l=mt.GetPdfPageUrl(mt.AdjustURL(pt),r);$("#img_"+r,n).attr("src",l),a=0}var d=!1;if(0==It?Math.abs(oe()-ee())>100&&(d=!0):1==It&&Math.abs(ne()-ie())>100&&(d=!0),d){var c=this.GetPageInfo();this.Clear(),mt.SizeChanged(1);var u=!0,g=!1,v=void 0;try{for(var f,y=c[Symbol.iterator]();!(u=(f=y.next()).done);u=!0){var x=f.value;this.Play(x)}}catch(t){g=!0,v=t}finally{try{!u&&y.return&&y.return()}finally{if(g)throw v}}}n.scrollTop(0),this.ResumeTool(),le(r),t&&t(!0,r),p&&p(r,3),h&&h(r,a)}else mt.ShowImagePageEx(r,function(i){ht=r,o=$("#svg"+r,n),s=$("#pageContainer"+r,n),n.scrollTop(0),e.ResumeTool(),i&&le(r),t&&t(i,r),i&&p&&p(r,3)},!1,mt.GetPdfPageUrl(mt.AdjustURL(pt),r),!1)}},this.PreviewPage=function(t){var e=this;if(!s||ht<=1)t&&t(!1,-1);else{if(s.hide(),ht<ct&&"0"!=$("#pageContainer"+(ht+1),n).attr("showerror")){var i=$("#img_"+(ht+1),n);i[0]&&(i[0].onload=null,i[0].onerror=null),i.attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg"),$("#pageContainer"+(ht+1),n).remove()}Ut(),qt(),te();var r=parseInt(ht)-1;if($("#pageContainer"+r,n).length>0){mt.SetPageNumber(r),ht=r,o=$("#svg"+r,n);var a=-1;if("0"==(s=$("#pageContainer"+r,n)).attr("showerror"))a=100,s.show();else{var l=mt.GetPdfPageUrl(mt.AdjustURL(pt),r);$("#img_"+r,n).attr("src",l),a=0}var d=!1;if(0==It?Math.abs(oe()-ee())>100&&(d=!0):1==It&&Math.abs(ne()-ie())>100&&(d=!0),d){var c=this.GetPageInfo();this.Clear(),mt.SizeChanged(1);var u=!0,g=!1,v=void 0;try{for(var f,y=c[Symbol.iterator]();!(u=(f=y.next()).done);u=!0){var x=f.value;this.Play(x)}}catch(t){g=!0,v=t}finally{try{!u&&y.return&&y.return()}finally{if(g)throw v}}}n.scrollTop(0),this.ResumeTool(),le(r),t&&t(!0,r),p&&p(r,4),h&&h(r,a)}else mt.ShowImagePageEx(r,function(i){ht=r,o=$("#svg"+r,n),s=$("#pageContainer"+r,n),n.scrollTop(0),e.ResumeTool(),i&&le(r),t&&t(i,r),i&&p&&p(r,4)},!1,mt.GetPdfPageUrl(mt.AdjustURL(pt),r),!1)}},this.ToPage=function(t,e){var i,r=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((t=parseInt(t))>ct||t<1)e&&e(!1,-1);else if(s.hide(),t>2&&"0"!=$("#pageContainer"+(t-2),n).attr("showerror")&&((i=$("#img_"+(t-2),n))[0]&&(i[0].onload=null,i[0].onerror=null),i.attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg"),$("#pageContainer"+(t-2),n).remove()),t+1<ct&&"0"!=$("#pageContainer"+(t+2),n).attr("showerror")&&((i=$("#img_"+(t+2),n))[0]&&(i[0].onload=null,i[0].onerror=null),i.attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg"),$("#pageContainer"+(t+2),n).remove()),Ut(),qt(),te(),$("#pageContainer"+t,n).length>0){mt.SetPageNumber(t),ht=t,o=$("#svg"+t,n);var l=-1;if("0"==(s=$("#pageContainer"+t,n)).attr("showerror"))l=100,s.show();else{var d=mt.GetPdfPageUrl(mt.AdjustURL(pt),t);$("#img_"+t,n).attr("src",d),l=0}var c=!1;if(0==It?Math.abs(oe()-ee())>100&&(c=!0):1==It&&Math.abs(ne()-ie())>100&&(c=!0),c){var u=this.GetPageInfo();this.Clear(),mt.SizeChanged(1);var g=!0,v=!1,f=void 0;try{for(var y,x=u[Symbol.iterator]();!(g=(y=x.next()).done);g=!0){var b=y.value;this.Play(b)}}catch(t){v=!0,f=t}finally{try{!g&&x.return&&x.return()}finally{if(v)throw f}}}n.scrollTop(0),this.ResumeTool(),a||le(t),e&&e(!0,t),p&&p(t,a?1:5),h&&h(t,l)}else mt.ShowImagePageEx(t,function(i,l){ht=t,o=$("#svg"+t,n),s=$("#pageContainer"+t,n),n.scrollTop(0),r.ResumeTool(),i&&!a&&le(t),e&&e(i,t),i&&p&&p(t,a?1:5)},!1,mt.GetPdfPageUrl(mt.AdjustURL(pt),t),!1)},this.PreLoadPage=function(t,e){!n||t>ct||t<1||$("#pageContainer"+t,n).length>0?e&&e(!1,-1):mt.ShowImagePageEx(t,function(i,n){e&&e(i,t)},!0,mt.GetPdfPageUrl(mt.AdjustURL(pt),t),!1)},this.ShowPageImage=function(t,e,i){""==pt&&(pt=e,mt.SetUrl(e)),$("#img_"+t,n).attr("src",mt.GetPdfPageUrl(e,t)),i&&i(1)},this.SetDoumentUrl=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if((0==ut||0==i||i==ut)&&(pt=e,mt.SetUrl(e),ht==t)){var o=$("#pageContainer"+t,n);if(o.length>0&&"0"!=o.attr("showerror")){var r=mt.GetPdfPageUrl(mt.AdjustURL(pt),t);$("#img_"+t,n).attr("src")!=r&&$("#img_"+t,n).attr("src",r)}}},this.DisplayInCenter=function(){var t=this.main.height(),e=$("#pageContainer"+this.pagenumber,n).height();e>t&&$("#pageContainer"+this.pagenumber,n).scrollTop((e-t)/2)},this.ZoomIn=function(t){var e=mt.ZoomIn();t&&t(e),ae()},this.ZoomOut=function(t){var e=mt.ZoomOut();t&&t(e),ae()},this.ZoomTo=function(t,e){mt.SizeChanged(t),e&&e(t),ae()},this.Undo=function(t){if(0!=Wt.length){var e=Wt.pop();if(Array.isArray(e.Undo))for(var i=0,n=e.Undo.length;i<n;i++)re(e.Undo[i]),this.Play(e.Undo[i]);else re(e.Undo),this.Play(e.Undo);Ot.push(e),st&&(0==Wt.length?st(0,1):1==Ot.length&&st(Wt.length>0?1:0,1))}else t&&t(!1)},this.Redo=function(t){if(0!=Ot.length){var e=Ot.pop();if(Array.isArray(e.Redo))for(var i=0,n=e.Redo.length;i<n;i++)re(e.Redo[i]),this.Play(e.Redo[i]);else re(e.Redo),this.Play(e.Redo);Wt.push(e),st&&(0==Ot.length?st(1,0):1==Wt.length&&st(1,Ot.length>0?1:0))}else t&&t(!1)},this.OnPageChange=function(t){p=t},this.OnSelectVideo=function(t){u=t},this.OnSelectVideoLink=function(t){v=t},this.OnSelectSync=function(t){f=t},this.OnBoardDisplayChange=function(t){B=t},this.OnVideoPlay=function(t){et=t},this.OnVideoLinkPlay=function(t){nt=t},this.OnSyncPlay=function(t){ot=t},this.OnSyncEdit=function(t){rt=t},this.OnBookNoteEdit=function(t){},this.OnBookNoteSelect=function(t){},this.OnBookNoteView=function(t){},this.SetCallBack=function(t,e){Lt||(Lt=new g),Lt.set(t,e)},this.OnUndoRedoStatChange=function(t){st=t},this.OnSizeMode=function(t){at=t},this.OnSettingChange=function(t){lt=t},this.SetUserSetting=function(t){dt=t},this.SetCanEdit=function(t){Tt=t,xt&&xt.SetCanEdit(t),t||Ut()},this.TriggerPageChange=function(){le(ht)},this.TriggerViewChange=function(){ae()},this.Reset=function(){n=null,s=null,ht=0,ct=1,pt="",ut=0,e=null,i="",o=null,l=null,d=null,h=null,c=null,p=null,B=null,et=null,nt=null,st=null,xt=null,bt=null,wt=!1,Ct=!1,St=0,Tt=!0,At=!1,Et=new Array,Rt=[0,0],Pt=!1,It=0,kt=new Array,Wt=new Array,Ot=new Array,rt=null,ot=null,Lt=new g}}}]);